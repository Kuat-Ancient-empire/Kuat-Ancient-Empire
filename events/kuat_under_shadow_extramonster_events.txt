namespace = kuat_extramonster
#Notification: Approaching rim system. #通知：危机前奏，通知后危机生成
country_event = { 
	id = kuat_extramonster.8
	title = "kuat_extramonster.8.name"
	desc = "kuat_extramonster.8.desc"
	diplomatic = yes
	picture_event_data = { room = Eternal_Empire5_room }
	custom_gui = "kuat_event_window"
	custom_gui_option = "kuat_event_option"
	show_sound = event_yellow_alert
	location = root.capital_scope
	is_triggered_only = yes
	immediate = { 
		set_global_flag = kuat_extramonster_7_fired 
		random_system = {
			limit = { has_star_flag = myst_system_5 }
			every_fleet_in_system = { destroy_fleet = { target = this destroy_template = yes kill_leader = yes } }
			star = {
				create_ambient_object = { type = "star_explosion" play_animation_once = yes location = this }
				last_created_ambient_object = { set_location = { target = prev distance = 0 angle = random } }
				create_ambient_object = { type = "destroyed_system" location = this }
				last_created_ambient_object = { set_ambient_object_flag = destroyed_system_effect set_location = { target = prev  distance = 0  angle = random  } }
				set_planet_entity = { entity = starforge_avoid_entity }
				set_planet_size = -1
			}
			create_country = {
				name = "Name_Kuat_DeD_Contractor"
				name_list = Eternal_Fleet_1
				type = kuat_contractor_hostile
				flag = {
					icon = {
						category = "Drft"
						file = "Logo_faction_drifters.dds"
					}
					background = {
						category = "backgrounds"
						file = "00_solid.dds"
					}
					colors = { "blue" "black" "null" "null" }
				}
				ignore_initial_colony_error = yes
			}
			remove_megastructure = event_target:exe_outer_gate_G_facility
			last_created_country = {
				set_country_flag = protected_from_queen_storm
				save_global_event_target_as = kuat_contractor_support
				add_modifier = { modifier = Elternal_creating }
			}
			kuat_ded_contractor_create_elternal_system_warbase = yes
			set_star_flag = kuat_ded_white_hole_clock
			isolate_system = yes set_star_flag = ag_no_jump_in_system
		}
		while = { count = 3 random_system = {
			limit = {
				has_star_flag = kuat_ded_white_hole_star
				NOT = { has_star_flag = kuat_white_hole_star_in_system }
			}
			kuat_ded_contractor_create_elternal_system_warbase = yes
			system_star = {
				planet_event = { id = kuat_extramonster.111 days = 180 }
				planet_event = { id = kuat_extramonster.111 days = 360 }
				planet_event = { id = kuat_extramonster.111 days = 720 }
			}
			event_target:global_event_country = { change_variable = { which = kuat_ded_white_hole_var value = 1 } }
			system_event = { id = kuat_extramonster.241 days = 1800 }
			set_timed_star_flag = { flag = kuat_white_hole_star_in_system days = 30 }
		} }
		every_country = {
			limit = { NOT = { is_kuat_contractor_faction = yes } }
			country_event = { id = kuat_extramonster.101 }
		}
	}
	option = { name = "kuat_extramonster.8.a" }
}
# on_entering_system Check system fleet
ship_event = {
	id = kuat_extramonster.81
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		owner = { is_kuat_contractor_faction = no }
		exists = event_target:kuat_contractor_support
		from = { has_star_flag = kuat_ded_white_hole_clock }
	}

	immediate = {
		fleet = { destroy_fleet = { target = this destroy_template = yes kill_leader = no } }
	}
}

#Invasion begin.  on_monthly
event = {
	id = kuat_extramonster.9
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_global_flag = kuat_extramonster_7_fired
		NOT = { has_global_flag = kuat_extramonster_begin }
	}
	immediate = {
		set_global_flag = kuat_extramonster_begin
		create_country = {
			name = "Name_Kuat_Contractor"
			name_list = Eternal_Fleet_1
			type = kuat_contractor_hostile
			flag = {
				icon = {
					category = "Drft"
					file = "Logo_faction_drifters.dds"
				}
				background = {
					category = "backgrounds"
					file = "00_solid.dds"
				}
				colors = { "green" "black" "null" "null" }
			}
			ignore_initial_colony_error = yes
		}
		last_created_country = {
			set_country_flag = protected_from_queen_storm
			save_global_event_target_as = kuat_contractor_hostile
			add_modifier = { modifier = Elternal_creating }
		}
		while = { count = 6 random_system = {
			limit = {
				has_star_flag = kuat_white_hole_star
				NOT = { has_star_flag = kuat_white_hole_star_in_system }
			}
			kuat_contractor_create_elternal_system_warbase = yes
			system_star = { 
				planet_event = { id = kuat_extramonster.11 days = 10 }
				planet_event = { id = kuat_extramonster.11 days = 20 }
				planet_event = { id = kuat_extramonster.11 days = 30 }
				planet_event = { id = kuat_extramonster.11 days = 40 }
				planet_event = { id = kuat_extramonster.11 days = 50 }
				planet_event = { id = kuat_extramonster.11 days = 60 }
			}
			event_target:global_event_country = { change_variable = { which = kuat_white_hole_var value = 1 } }
			system_event = { id = kuat_extramonster.24 days = 180 }
			set_timed_star_flag = { flag = kuat_white_hole_star_in_system days = 30 }
		} }
		event_target:kuat_contractor_hostile = {
			if = {
				limit = { count_owned_fleet = { limit = { has_fleet_flag = kuat_contractor_starbase_hull_control } count > 0 } }
				no_events = yes
			}
			else = { every_country = { limit = { is_ai = no } country_event = { id = kuat_extramonster.91 scopes = { from = prev } } } }
		}
		every_country = {
			limit = { NOT = { is_kuat_contractor_faction = yes } }
			establish_communications_no_message = event_target:kuat_contractor_support
			establish_communications_no_message = event_target:kuat_contractor_hostile
			country_event = { id = kuat_extramonster.10 }
		}
		every_country = {
			limit = { is_ai = no }
			country_event = { id = kuat_extramonster.25 days = 5 }
		}
	}
}

country_event = {
	id = kuat_extramonster.91
	title = "kuat_extramonster.91.name"
	desc = {
		trigger = {
			success_text = {
				from = { is_same_value = event_target:kuat_contractor_hostile }
				text = "kuat_extramonster.91.0.desc"
			}
			success_text = {
				from = { is_same_value = event_target:eternal_fleet_country }
				text = "kuat_extramonster.91.1.desc"
			}
			success_text = {
				from = { is_same_value = event_target:Kuat_Galatic_Empire_invasion_country }
				text = "kuat_extramonster.91.2.desc"
			}
		}
	}
	is_triggered_only = yes
	is_advisor_event = yes
	immediate = { set_variable = { which = kuat_extramonster_91_trigger value = 2 } }
	option = { name = "kuat_extramonster.91.a" }
	after = { if = {
		limit = { check_variable = { which = kuat_extramonster_91_trigger value > 0 } }
		subtract_variable = { which = kuat_extramonster_91_trigger value = 1 }
		country_event = { id = kuat_extramonster.91 days = 1 scopes = { from = from } }
	} }
}

#Notification: Extra crisis begin.#通知：危机向银河宣告发生（通知事件）
country_event = {
	id = kuat_extramonster.10
	title = "kuat_extramonster.10.name"
	desc = "kuat_extramonster.10.a.desc"
	diplomatic = yes
	picture_event_data = { room = Eternal_Empire4_room }
	custom_gui = "kuat_event_window"
	custom_gui_option = "kuat_event_option"
	show_sound = event_red_alert
	location = event_target:will_be_add_habitable_plague
	is_triggered_only = yes
	option = {
		name = "kuat_extramonster.10.a"
		hidden_effect = { country_event = { id = kuat_extramonster.102 days = 1 } }
	}
}

#Notification: Extra crisis talking. #通知：危机向银河宣告发生（通知事件）
country_event = {
	id = kuat_extramonster.101
	title = "kuat_extramonster.101.name"
	desc = "kuat_extramonster.101.desc"
	diplomatic = yes
	picture_event_data = { room = Eternal_Empire4_room }
	custom_gui = "kuat_event_window"
	custom_gui_option = "kuat_event_option"
	show_sound = event_red_alert
	location = event_target:will_be_add_habitable_plague
	is_triggered_only = yes
	option = { name = "kuat_extramonster.101.a" }
}

#Notification: Extra crisis talking. #外交：流浪者发表通告
country_event = {
	id = kuat_extramonster.102
	title = "kuat_extramonster.102.name"
	desc = { trigger = {
		success_text = {
			NOR = {
				has_country_flag = fired_kuat_extramonster.102.b
				has_country_flag = fired_kuat_extramonster.102.c
			}
			text = "kuat_extramonster.102.desc"
		}
		success_text = {
			has_country_flag = fired_kuat_extramonster.102.b
			text = "kuat_extramonster.102.b.desc"
		}
		success_text = {
			has_country_flag = fired_kuat_extramonster.102.c
			text = "kuat_extramonster.102.c.desc"
		}
	} }
	diplomatic = yes
	picture_event_data = { room = no_video_feed_room }
	custom_gui = "kuat_event_diplomacy_window"
	custom_gui_option = "kuat_event_diplomacy_option"
	show_sound = event_red_alert
	location = root.capital_scope
	is_triggered_only = yes
	immediate = {  
		if = {
			limit = { NOR = {
				has_country_flag = fired_kuat_extramonster.102.b
				has_country_flag = fired_kuat_extramonster.102.c
			} }
			begin_event_chain = { event_chain = kuat_contractor_exe_invasion_chain }
			create_point_of_interest = {
				id = sc_kuat_white_hole.1
				name = sc_kuat_white_hole.1.active
				desc = sc_kuat_white_hole.1.active.desc
				event_chain = kuat_contractor_exe_invasion_chain
				location = event_target:kuat_white_hole_system_1
			}
			create_point_of_interest = {
				id = sc_kuat_white_hole.2
				name = sc_kuat_white_hole.2.active
				desc = sc_kuat_white_hole.2.active.desc
				event_chain = kuat_contractor_exe_invasion_chain
				location = event_target:kuat_white_hole_system_2
			}
			create_point_of_interest = {
				id = sc_kuat_white_hole.3
				name = sc_kuat_white_hole.3.active
				desc = sc_kuat_white_hole.3.active.desc
				event_chain = kuat_contractor_exe_invasion_chain
				location = event_target:kuat_white_hole_system_3
			}
			create_point_of_interest = {
				id = sc_kuat_white_hole.4
				name = sc_kuat_white_hole.4.active
				desc = sc_kuat_white_hole.4.active.desc
				event_chain = kuat_contractor_exe_invasion_chain
				location = event_target:kuat_white_hole_system_4
			}
			create_point_of_interest = {
				id = sc_kuat_white_hole.5
				name = sc_kuat_white_hole.5.active
				desc = sc_kuat_white_hole.5.active.desc
				event_chain = kuat_contractor_exe_invasion_chain
				location = event_target:kuat_white_hole_system_5
			}
			create_point_of_interest = {
				id = sc_kuat_white_hole.6
				name = sc_kuat_white_hole.6.active
				desc = sc_kuat_white_hole.6.active.desc
				event_chain = kuat_contractor_exe_invasion_chain
				location = event_target:kuat_white_hole_system_6
			}
		}
	}
	option = {
		name = kuat_extramonster.102.b
		hidden_effect = { 
			set_country_flag = fired_kuat_extramonster.102.b
			remove_country_flag = fired_kuat_extramonster.102.c
			country_event = { id = kuat_extramonster.102 } 
		}
	}
	option = {
		name = kuat_extramonster.102.c
		hidden_effect = { 
			set_country_flag = fired_kuat_extramonster.102.c
			remove_country_flag = fired_kuat_extramonster.102.b
			country_event = { id = kuat_extramonster.102 } 
		}
	}
	option = { 
		name = kuat_extramonster.102.a 
		hidden_effect = { country_event = { id = kuat_extramonster.103 days = 1 } }
		ai_chance = { weight = 100 } 
	}
}
country_event = {
	id = kuat_extramonster.103
	title = "kuat_extramonster.103.name"
	desc = "kuat_extramonster.103.desc"
	diplomatic = yes
	picture_event_data = { room = Eternal_Empire4_room }
	custom_gui = "kuat_event_window"
	custom_gui_option = "kuat_event_option"
	show_sound = event_red_alert
	location = root.capital_scope
	is_triggered_only = yes
	option = { name = "kuat_extramonster.103.a" }
}

#Invasion fleet arrived. 
planet_event = {
	id = kuat_extramonster.11
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		exists = event_target:kuat_contractor_hostile
		NOT = { has_global_flag = kuat_extramonster_ended }
	}
	immediate = {
		kuat_contractor_create_retrun_invasion_fleet_detail = yes
		every_country = {
			limit = { has_event_chain = kuat_contractor_exe_invasion_chain }
			add_event_chain_counter = { 
				event_chain = kuat_contractor_exe_invasion_chain 
				counter = kuat_contractor_exe_invasion_fleet amount = 1 
			}
		}
		event_target:kuat_contractor_hostile = { every_owned_fleet = {
			limit = { has_fleet_flag = kuat_contractor_invasion_fleet is_fleet_idle = yes }
			fleet_event = { id = kuat_extramonster.12 days = 1 random = 2 }
		} }
	}
}
planet_event = {
	id = kuat_extramonster.111
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		exists = event_target:kuat_contractor_support
		NOT = { has_global_flag = kuat_ded_contractor_hostile_destroyed }
	}
	immediate = {
		kuat_ded_contractor_create_retrun_invasion_fleet_detail = yes
		event_target:kuat_contractor_support = { every_owned_fleet = {
			limit = { has_fleet_flag = kuat_contractor_invasion_fleet is_fleet_idle = yes }
			fleet_event = { id = kuat_extramonster.12 days = 1 random = 2 }
		} }
	}
}

#white hole convertion rainforcement
system_event = {
	id = kuat_extramonster.24
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_star_flag = kuat_white_hole_star
		exists = event_target:kuat_contractor_hostile
		NOT = { has_star_flag = kuat_white_hole_rainforce_disable }
	}
	immediate = {
		system_star = { kuat_contractor_create_retrun_invasion_fleet_detail = yes }
		every_country = {
			limit = { has_event_chain = kuat_contractor_exe_invasion_chain }
			add_event_chain_counter = { 
				event_chain = kuat_contractor_exe_invasion_chain 
				counter = kuat_contractor_exe_invasion_fleet amount = 1 
			}
		}
		system_event = { id = kuat_extramonster.24 days = 720 random = 360 }
	}
}
system_event = {
	id = kuat_extramonster.241
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_star_flag = kuat_ded_white_hole_star
		exists = event_target:kuat_contractor_support
		NOT = { has_star_flag = kuat_ded_white_hole_star_rainforce_dsiable }
		NOT = { has_global_flag = kuat_ded_contractor_hostile_destroyed }
	}
	immediate = {
		system_star = { kuat_ded_contractor_create_retrun_invasion_fleet_detail = yes }
		system_event = { id = kuat_extramonster.241 days = 1870 random = 720 }
	}
}

#Notification: white hole convertion #流浪者开始建设恒星那什么器
country_event = {
	id = kuat_extramonster.25
	title = "kuat_extramonster.25.title"
	desc = "kuat_extramonster.25.desc"
	diplomatic = yes
	picture_event_data = { room = astral_rift_microverse_room }
	custom_gui = "kuat_event_window"
	custom_gui_option = "kuat_event_option"
	show_sound = event_wind_ruins
	is_triggered_only = yes
	trigger = { NOT = { has_event_chain = kuat_contractor_exe_invasion_chain } }
	option = { name = kuat_extramonster.25.a }
}

#Invasion fleet action.  attack player
fleet_event = {
	id = kuat_extramonster.12
	hide_window = yes
	is_triggered_only = yes
	trigger = { 
		exists = owner
		OR = {
			AND = {
				owner = { is_same_value = event_target:kuat_contractor_hostile }
				exists = event_target:kuat_contractor_hostile
				NOT = { has_global_flag = kuat_extramonster_ended }
			}
			AND = {
				owner = { is_same_value = event_target:kuat_contractor_support }
				exists = event_target:kuat_contractor_support
				NOT = { has_global_flag = kuat_ded_contractor_hostile_destroyed }
			}
		}
	}
	immediate = {
		if = {
			limit = { exists = owner owner = { is_same_value = event_target:kuat_contractor_hostile } }
			kuat_exe_invasion_fleet_action = { ID = kuat_extramonster TYPE = kuat_contractor OWNER = kuat_contractor_hostile }
		}
		else_if = {
			limit = { exists = owner owner = { is_same_value =  event_target:kuat_contractor_support } }
			kuat_exe_invasion_fleet_action = { ID = kuat_extramonster TYPE = kuat_ded_contractor OWNER = kuat_contractor_support }
		}
	}
}

#Invasion fleet action on win a space battle. 
country_event = { 
	id = kuat_extramonster.13
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		OR = {
			AND = {
				is_same_value = event_target:kuat_contractor_hostile
				exists = event_target:kuat_contractor_hostile
				NOT = { has_global_flag = kuat_extramonster_ended }
			}
			AND = {
				is_same_value = event_target:kuat_contractor_support
				exists = event_target:kuat_contractor_support
				NOT = { has_global_flag = kuat_ded_contractor_hostile_destroyed }
			}
		}
		fromfrom = { fleet = { has_fleet_flag = kuat_contractor_invasion_fleet } }
		fromfromfrom = { OR = {
			is_ship_class = shipclass_starbase
			is_ship_class = shipclass_military
		} }
	}
	immediate = {
		fromfrom = {
			clear_orders = yes
			clear_fleet_actions = this
			fleet_event = { id = kuat_extramonster.12 days = 3 random = 2 }
		}
	}
}

#Invasion fleet action on orbit planet. 
country_event = { 
	id = kuat_extramonster.14
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		OR = {
			AND = {
				is_same_value = event_target:kuat_contractor_hostile
				exists = event_target:kuat_contractor_hostile
				NOT = { has_global_flag = kuat_extramonster_ended }
			}
			AND = {
				is_same_value = event_target:kuat_contractor_support
				exists = event_target:kuat_contractor_support
				NOT = { has_global_flag = kuat_ded_contractor_hostile_destroyed }
			}
		}
		from = { has_fleet_flag = kuat_contractor_invasion_fleet }
		fromfrom = { OR = {
			is_star = yes
			NOT = { exists = owner }
		} }
	}
	immediate = {
		from = {
			clear_orders = yes
			clear_fleet_actions = this
			fleet_event = { id = kuat_extramonster.12 days = 3 random = 2 }
		}
	}
}

#Reset invasion fleet action if two fleet in same system. 
fleet_event = {
	id = kuat_extramonster.15
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		exists = owner
		OR = {
			AND = {
				owner = { is_same_value = event_target:kuat_contractor_hostile }
				exists = event_target:kuat_contractor_hostile
				NOT = { has_global_flag = kuat_extramonster_ended }
			}
			AND = {
				owner = { is_same_value = event_target:kuat_contractor_support }
				exists = event_target:kuat_contractor_support
				NOT = { has_global_flag = kuat_ded_contractor_hostile_destroyed }
			}
		}
		has_fleet_flag = kuat_contractor_invasion_fleet
		from = {
			NOR = {
				kuat_is_kuat_system = yes
				has_star_flag = kuat_military_base_local_home
				has_star_flag = kuat_military_sublocal_home
			}
			any_fleet_in_system = {
				NOT = { is_same_value = root }
				has_fleet_flag = kuat_contractor_invasion_fleet
			}
		}
	}
	immediate = {
		clear_orders = yes
		clear_fleet_actions = this
		from = {
			random_neighbor_system = {
				system_star = { root = { auto_move_to_planet = { target = prev clear_auto_move_on_arrival = yes } } }
			}
		}
	}
}

#Check every month to prevent bugs.
event = {
	id = kuat_extramonster.16
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		OR = {
			AND = {
				exists = event_target:kuat_contractor_hostile
				NOT = { has_global_flag = kuat_extramonster_ended }
				event_target:kuat_contractor_hostile = {
					any_owned_fleet = {
						exists = this
						is_fleet_idle = yes
						has_fleet_flag = kuat_contractor_invasion_fleet
						NAND = {
							exists = orbit
							orbit = {
								NOT = { is_star = yes }
								exists = owner
								owner = { is_hostile = event_target:kuat_contractor_hostile }
							}
						}
					}
				}
			}
			AND = {
				exists = event_target:kuat_contractor_support
				NOT = { has_global_flag = kuat_ded_contractor_hostile_destroyed }
				event_target:kuat_contractor_support = {
					any_owned_fleet = {
						exists = this
						is_fleet_idle = yes
						has_fleet_flag = kuat_contractor_invasion_fleet
						NAND = {
							exists = orbit
							orbit = {
								NOT = { is_star = yes }
								exists = owner
								owner = { is_hostile = event_target:kuat_contractor_support }
							}
						}
					}
				}
			}
		}
	}
	immediate = {
		if = {
			limit = { exists = event_target:kuat_contractor_hostile }
			event_target:kuat_contractor_hostile = {
				every_owned_fleet = {
					limit = {
						exists = this
						is_fleet_idle = yes
						has_fleet_flag = kuat_contractor_invasion_fleet
						NAND = {
							exists = orbit
							orbit = {
								NOT = { is_star = yes }
								exists = owner
								owner = { is_hostile = event_target:kuat_contractor_hostile }
							}
						}
					}
					clear_orders = yes
					clear_fleet_actions = this
					fleet_event = { id = kuat_extramonster.12 days = 3 random = 2 }
				}
			}
		}
		if = {
			limit = { exists = event_target:kuat_contractor_support }
			event_target:kuat_contractor_support = {
				every_owned_fleet = {
					limit = {
						exists = this
						is_fleet_idle = yes
						has_fleet_flag = kuat_contractor_invasion_fleet
						NAND = {
							exists = orbit
							orbit = {
								NOT = { is_star = yes }
								exists = owner
								owner = { is_hostile = event_target:kuat_contractor_support }
							}
						}
					}
					clear_orders = yes
					clear_fleet_actions = this
					fleet_event = { id = kuat_extramonster.12 days = 3 random = 2 }
				}
			}
		}
	}
}

#Invasion fleet bombard a planet. counter
planet_event = {
	id = kuat_extramonster.21
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		exists = owner
		has_global_flag = kuat_extramonster_begin
		NOT = { has_global_flag = kuat_extramonster_ended }
		planet_devastation = 100
		from = { is_kuat_contractor_faction = yes }
	}
	immediate = { 
		reset_planet = yes
		destroy_colony = yes
		if = {
			limit = { exists = owner }
			owner = { country_event = { id = kuat_extramonster.34 } } 
		}
		every_country = {
			limit = {
				NOT = { is_same_value = event_target:kuat_contractor_hostile }
				has_event_chain = kuat_contractor_exe_invasion_chain
			}
			add_event_chain_counter = { event_chain = kuat_contractor_exe_invasion_chain counter = kuat_contractor_exe_invasion_planet_destroyed amount = 1 }
			if = {
				limit = { has_event_chain = kuat_contractor_exe_invasion_chain }
				add_event_chain_counter = { event_chain = kuat_contractor_exe_invasion_chain counter = kuat_contractor_exe_invasion_planet_destroyed amount = 1 }
			}
		}
		if = {
			limit = { from = { count_owned_fleet = { limit = { has_fleet_flag = kuat_contractor_invasion_fleet } count < 24 } } }
			planet_event = { id = kuat_extramonster.11 }
		}
		# solar_system = {
		# 	every_fleet_in_system = {
		# 		limit = {
		# 			exists = owner
		# 			owner = { is_kuat_contractor_faction = yes }
		# 			has_fleet_flag = kuat_contractor_invasion_fleet
		# 			OR = {
		# 				AND = { exists = orbit orbit = { is_same_value = root } }
		# 				AND = {
		# 					is_fleet_idle = yes
		# 					NAND = {
		# 						exists = orbit
		# 						orbit = {
		# 							NOT = { is_star = yes }
		# 							exists = owner
		# 							owner = { is_hostile = event_target:kuat_contractor_hostile }
		# 						}
		# 					}
		# 				}
		# 			}
		# 		}
		# 		clear_orders = yes
		# 		clear_fleet_actions = this
		# 		fleet_event = { id = kuat_extramonster.12 days = 1 random = 2 }
		# 	}
		# }	
	}
}

#Notification: bombarment #星球被轰炸转化为舰队
country_event = {
	id = kuat_extramonster.34
	title = "kuat_extramonster.21.name"
	desc = "kuat_extramonster.21.a.desc"
	diplomatic = yes
	picture_event_data = { room = astral_rift_siege_on_paradise_grunur_room }
	custom_gui = "kuat_event_m_window"
	custom_gui_option = "kuat_event_m_option"
	show_sound = event_super_explosion
	is_triggered_only = yes
	option = { name = "kuat_extramonster.21.a" ai_chance = { weight = 100 } }
}

#Invasion fleet killed counter. 
country_event = {
	id = kuat_extramonster.22
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_global_flag = kuat_extramonster_begin
		is_kuat_contractor_faction = yes
	}
	immediate = {
		from = {
			add_event_chain_counter = { event_chain = kuat_contractor_exe_invasion_chain counter = kuat_contractor_exe_invasion_ship_kill_by_us amount = 1 }
			if = {
				limit = { has_event_chain = kuat_contractor_exe_invasion_chain }
				add_event_chain_counter = { event_chain = kuat_contractor_exe_invasion_chain counter = kuat_contractor_exe_invasion_ship_kill_by_us amount = 1 }
			}
		}
		every_country = {
			limit = {
				has_event_chain = kuat_contractor_exe_invasion_chain
				NOT = { is_same_value = from }
			}
			add_event_chain_counter = { event_chain = kuat_contractor_exe_invasion_chain counter = kuat_contractor_exe_invasion_ship_kill_by_other amount = 1 }
			if = {
				limit = { has_event_chain = kuat_contractor_exe_invasion_chain }
				add_event_chain_counter = { event_chain = kuat_contractor_exe_invasion_chain counter = kuat_contractor_exe_invasion_ship_kill_by_other amount = 1 }
			}
		}
	}
}

#Invasion fleet victim counter. 
country_event = {
	id = kuat_extramonster.23
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_global_flag = kuat_extramonster_begin
		is_kuat_contractor_faction = yes
		from = { NOT = { is_kuat_contractor_faction = yes } }
	}
	immediate = {
		every_country = {
			limit = {
				NOT = { is_same_value = event_target:kuat_contractor_hostile }
				has_event_chain = kuat_contractor_exe_invasion_chain
			}
			add_event_chain_counter = { event_chain = kuat_contractor_exe_invasion_chain counter = kuat_contractor_exe_invasion_victim amount = 1 }
			if = {
				limit = { has_event_chain = kuat_contractor_exe_invasion_chain }
				add_event_chain_counter = { event_chain = kuat_contractor_exe_invasion_chain counter = kuat_contractor_exe_invasion_victim amount = 1 }
			}
		}
		from = { change_variable = { which = eternal_bornus_var value = 1 } }
	}
}

#An invasion fleet has been destroyed.  counter
country_event = {
	id = kuat_extramonster.31
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_global_flag = kuat_extramonster_begin
		from = { is_kuat_contractor_faction = yes }
		fromfromfrom = { has_fleet_flag = kuat_contractor_invasion_fleet }
	}
	immediate = {
		fromfromfrom = { if = {
			limit = { NOT = { has_fleet_flag = fire_only_once_temple } }
			set_timed_fleet_flag = { flag = fire_only_once_temple days = 1 }
			every_country = {
				limit = { has_event_chain = kuat_contractor_exe_invasion_chain }
				add_event_chain_counter = { event_chain = kuat_contractor_exe_invasion_chain counter = kuat_contractor_exe_invasion_fleet amount = -1 }
			}
			event_target:global_event_country = { change_variable = { which = count_destroy_exm_kuat_fleet value = 1 } }
		} }
		if = {
			limit = { 
				exists = event_target:situation_white_hole_system_disable 
				NOT = { has_global_flag = kuat_white_hole_star_unlock_temple }
			}
			event_target:situation_white_hole_system_disable = { add_situation_progress = 10 }
		}
	}
}

situation_event = {
	id = kuat_extramonster.32
	title = "kuat_extramonster.32.name"
	desc = {
		trigger = {
			success_text = {
				NOR = {
					has_global_flag = kuat_white_hole_star_enable_1
					has_global_flag = kuat_white_hole_star_enable_2
					has_global_flag = kuat_white_hole_star_enable_3
					has_global_flag = kuat_white_hole_star_enable_4
					has_global_flag = kuat_white_hole_star_enable_5
					has_global_flag = kuat_white_hole_star_enable_6
					has_global_flag = kuat_white_hole_star_enable_infinite
				}
				text = kuat_extramonster.32.1.desc
			}
			success_text = {
				has_global_flag = kuat_white_hole_star_enable_1
				NOR = {
					has_global_flag = kuat_white_hole_star_enable_2
					has_global_flag = kuat_white_hole_star_enable_3
					has_global_flag = kuat_white_hole_star_enable_4
					has_global_flag = kuat_white_hole_star_enable_5
					has_global_flag = kuat_white_hole_star_enable_6
					has_global_flag = kuat_white_hole_star_enable_infinite
				}
				text = kuat_extramonster.32.2.desc
			}
			success_text = {
				has_global_flag = kuat_white_hole_star_enable_2
				NOR = {
					has_global_flag = kuat_white_hole_star_enable_3
					has_global_flag = kuat_white_hole_star_enable_4
					has_global_flag = kuat_white_hole_star_enable_5
					has_global_flag = kuat_white_hole_star_enable_6
					has_global_flag = kuat_white_hole_star_enable_infinite
				}
				text = kuat_extramonster.32.3.desc
			}
			success_text = {
				has_global_flag = kuat_white_hole_star_enable_3
				NOR = {
					has_global_flag = kuat_white_hole_star_enable_4
					has_global_flag = kuat_white_hole_star_enable_5
					has_global_flag = kuat_white_hole_star_enable_6
					has_global_flag = kuat_white_hole_star_enable_infinite
				}
				text = kuat_extramonster.32.4.desc
			}
			success_text = {
				has_global_flag = kuat_white_hole_star_enable_4
				NOR = {
					has_global_flag = kuat_white_hole_star_enable_5
					has_global_flag = kuat_white_hole_star_enable_6
					has_global_flag = kuat_white_hole_star_enable_infinite
				}
				text = kuat_extramonster.32.5.desc
			}
			success_text = {
				has_global_flag = kuat_white_hole_star_enable_5
				NOR = {
					has_global_flag = kuat_white_hole_star_enable_6
					has_global_flag = kuat_white_hole_star_enable_infinite
				}
				text = kuat_extramonster.32.6.desc
			}
			success_text = {
				has_global_flag = kuat_white_hole_star_enable_6
				text = kuat_extramonster.32.7.desc
			}
		}
	}
	diplomatic = yes
	picture_event_data = { room = astral_rift_backrooms_room }
	custom_gui = "kuat_event_m_window"
	custom_gui_option = "kuat_event_m_option"
	show_sound = event_celebration
	is_triggered_only = yes
	immediate = {
		change_variable = { which = situation_white_hole_system_disable_count value = 1 }
		if = {
			limit = { check_variable = { which = situation_white_hole_system_disable_count value = 1 } }
			set_global_flag = kuat_white_hole_star_enable_1
			owner = { country_event = { id = kuat_extramonster.33 } }
		}
		else_if = {
			limit = { check_variable = { which = situation_white_hole_system_disable_count value = 2 } }
			set_global_flag = kuat_white_hole_star_enable_2
			owner = { country_event = { id = kuat_extramonster.331 } }
		}
		else_if = {
			limit = { check_variable = { which = situation_white_hole_system_disable_count value = 3 } }
			set_global_flag = kuat_white_hole_star_enable_3
			owner = { country_event = { id = kuat_extramonster.332 } }
		}
		else_if = {
			limit = { check_variable = { which = situation_white_hole_system_disable_count value = 4 } }
			set_global_flag = kuat_white_hole_star_enable_4
			owner = { country_event = { id = kuat_extramonster.333 } }
		}
		else_if = {
			limit = { check_variable = { which = situation_white_hole_system_disable_count value = 5 } }
			set_global_flag = kuat_white_hole_star_enable_5
			owner = { country_event = { id = kuat_extramonster.334 } }
		}
		else_if = {
			limit = { check_variable = { which = situation_white_hole_system_disable_count value = 6 } }
			set_global_flag = kuat_white_hole_star_enable_6
			owner = { country_event = { id = kuat_extramonster.335 } }
		}
		else_if = {
			limit = { check_variable = { which = situation_white_hole_system_disable_count value > 6 } }
			set_global_flag = kuat_white_hole_star_enable_infinite
			owner = { country_event = { id = kuat_extramonster.335 } }
		}
	}
	option = {
		name = kuat_extramonster.32.A
		custom_tooltip = approach_outcome_tooltip
	}
	after = { if = { limit = { check_variable = { which = situation_white_hole_system_disable_count value > 5 } } destroy_situation = this } }
}

#第一个白洞设施可以进行研究的通知事件，尽量写多点这个
country_event = {
	id = kuat_extramonster.33
	title = "kuat_extramonster.33.name"
	desc = "kuat_extramonster.33.desc"
	diplomatic = yes
	picture_event_data = { room = astral_rift_crystal_3_room }
	custom_gui = "kuat_event_window"
	custom_gui_option = "kuat_event_option"
	show_sound = event_red_alert
	is_triggered_only = yes
	fire_only_once = yes
	location = event_target:kuat_white_hole_star
	trigger = {
		is_ai = no
		has_global_flag = kuat_extramonster_begin
		NOT = { has_global_flag = kuat_extramonster_ended }
		exists = event_target:kuat_contractor_hostile
		any_system = {
			has_star_flag = kuat_white_hole_star
			NOT = { has_star_flag = kuat_white_hole_rainforce_disable }
		}
		event_target:global_event_country = { 
			check_variable = { which = kuat_white_hole_var value > 0 }
		}
		NOT = { is_variable_set = kuat_white_hole_star_enable }
		NOT = { has_global_flag = kuat_white_hole_star_unlock_temple }
	}
	immediate = { 
		set_global_flag = kuat_white_hole_star_unlock_temple 
		random_system = {
			limit = {
				has_star_flag = kuat_white_hole_star
				NOT = { has_star_flag = kuat_white_hole_rainforce_disable }
			}
			save_event_target_as = kuat_white_hole_star
		}
	}
	option = {
		name = "kuat_extramonster.33.a"
		enable_special_project = {
			name = exe_rebuild_control_whitehole_facility
			owner = root location = event_target:kuat_white_hole_star
		}
	}
}

#第二个白洞设施可以进行研究的通知事件，尽量写多点这个
country_event = {
	id = kuat_extramonster.331
	title = "kuat_extramonster.331.name"
	desc = "kuat_extramonster.331.desc"
	diplomatic = yes
	fire_only_once = yes
	is_triggered_only = yes
	picture_event_data = { room = astral_rift_crystal_2_room }
	custom_gui = "kuat_event_m_window"
	custom_gui_option = "kuat_event_m_option"
	show_sound = event_red_alert
	location = event_target:kuat_white_hole_star
	trigger = {
		is_ai = no
		has_global_flag = kuat_extramonster_begin
		NOT = { has_global_flag = kuat_extramonster_ended }
		exists = event_target:kuat_contractor_hostile
		any_system = {
			has_star_flag = kuat_white_hole_star
			NOT = { has_star_flag = kuat_white_hole_rainforce_disable }
		}
		event_target:global_event_country = { 
			check_variable = { which = kuat_white_hole_var value > 0 }
		}
		check_variable = { which = kuat_white_hole_star_enable value = 1 }
		NOT = { has_global_flag = kuat_white_hole_star_unlock_temple }
	}
	immediate = { 
		set_global_flag = kuat_white_hole_star_unlock_temple 
		random_system = {
			limit = {
				has_star_flag = kuat_white_hole_star
				NOT = { has_star_flag = kuat_white_hole_rainforce_disable }
			}
			save_event_target_as = kuat_white_hole_star
		}
	}
	option = {
		name = "kuat_extramonster.331.a"
		enable_special_project = {
			name = exe_rebuild_control_whitehole_facility
			owner = root location = event_target:kuat_white_hole_star
		}
	}
}

##第三个白洞设施可以进行研究的通知事件，尽量写多点这个
country_event = {
	id = kuat_extramonster.332
	title = "kuat_extramonster.332.name"
	desc = "kuat_extramonster.332.desc"
	diplomatic = yes
	picture_event_data = { room = astral_rift_clock_room }
	custom_gui = "kuat_event_window"
	custom_gui_option = "kuat_event_option"
	show_sound = event_red_alert
	fire_only_once = yes
	is_triggered_only = yes
	location = event_target:kuat_white_hole_star
	trigger = {
		is_ai = no
		has_global_flag = kuat_extramonster_begin
		NOT = { has_global_flag = kuat_extramonster_ended }
		exists = event_target:kuat_contractor_hostile
		any_system = {
			has_star_flag = kuat_white_hole_star
			NOT = { has_star_flag = kuat_white_hole_rainforce_disable }
		}
		event_target:global_event_country = { 
			check_variable = { which = kuat_white_hole_var value > 0 }
		}
		check_variable = { which = kuat_white_hole_star_enable value = 2 }
		NOT = { has_global_flag = kuat_white_hole_star_unlock_temple }
	}
	immediate = { 
		set_global_flag = kuat_white_hole_star_unlock_temple 
		random_system = {
			limit = {
				has_star_flag = kuat_white_hole_star
				NOT = { has_star_flag = kuat_white_hole_rainforce_disable }
			}
			save_event_target_as = kuat_white_hole_star
		}
	}
	option = {
		name = "kuat_extramonster.332.a"
		enable_special_project = {
			name = exe_rebuild_control_whitehole_facility
			owner = root location = event_target:kuat_white_hole_star
		}
	}
}

##第四个白洞设施可以进行研究的通知事件，尽量写多点这个
country_event = {
	id = kuat_extramonster.333
	title = "kuat_extramonster.333.name"
	desc = "kuat_extramonster.333.desc"
	diplomatic = yes
	picture_event_data = { room = astral_rift_desert_ruins_third_chamber_room }
	custom_gui = "kuat_event_m_window"
	custom_gui_option = "kuat_event_m_option"
	show_sound = event_red_alert
	fire_only_once = yes
	is_triggered_only = yes
	location = event_target:kuat_white_hole_star
	trigger = {
		is_ai = no
		has_global_flag = kuat_extramonster_begin
		NOT = { has_global_flag = kuat_extramonster_ended }
		exists = event_target:kuat_contractor_hostile
		any_system = {
			has_star_flag = kuat_white_hole_star
			NOT = { has_star_flag = kuat_white_hole_rainforce_disable }
		}
		event_target:global_event_country = { 
			check_variable = { which = kuat_white_hole_var value > 0 }
		}
		check_variable = { which = kuat_white_hole_star_enable value = 3 }
		NOT = { has_global_flag = kuat_white_hole_star_unlock_temple }
	}
	immediate = { 
		set_global_flag = kuat_white_hole_star_unlock_temple 
		random_system = {
			limit = {
				has_star_flag = kuat_white_hole_star
				NOT = { has_star_flag = kuat_white_hole_rainforce_disable }
			}
			save_event_target_as = kuat_white_hole_star
		}
	}
	option = {
		name = "kuat_extramonster.333.a"
		enable_special_project = {
			name = exe_rebuild_control_whitehole_facility
			owner = root location = event_target:kuat_white_hole_star
		}
	}
}

##第五个白洞设施可以进行研究的通知事件，尽量写多点这个
country_event = {
	id = kuat_extramonster.334
	title = "kuat_extramonster.334.name"
	desc = "kuat_extramonster.334.desc"
	diplomatic = yes
	picture_event_data = { room = astral_rift_entangled_dark_matter_2_room }
	custom_gui = "kuat_event_window"
	custom_gui_option = "kuat_event_option"
	show_sound = event_red_alert
	fire_only_once = yes
	is_triggered_only = yes
	location = event_target:kuat_white_hole_star
	trigger = {
		is_ai = no
		has_global_flag = kuat_extramonster_begin
		NOT = { has_global_flag = kuat_extramonster_ended }
		exists = event_target:kuat_contractor_hostile
		any_system = {
			has_star_flag = kuat_white_hole_star
			NOT = { has_star_flag = kuat_white_hole_rainforce_disable }
		}
		event_target:global_event_country = { 
			check_variable = { which = kuat_white_hole_var value > 0 }
		}
		check_variable = { which = kuat_white_hole_star_enable value = 4 }
		NOT = { has_global_flag = kuat_white_hole_star_unlock_temple }
	}
	immediate = { 
		set_global_flag = kuat_white_hole_star_unlock_temple 
		random_system = {
			limit = {
				has_star_flag = kuat_white_hole_star
				NOT = { has_star_flag = kuat_white_hole_rainforce_disable }
			}
			save_event_target_as = kuat_white_hole_star
		}
	}
	option = {
		name = "kuat_extramonster.334.a"
		enable_special_project = {
			name = exe_rebuild_control_whitehole_facility
			owner = root location = event_target:kuat_white_hole_star
		}
	}
}

##最后一个白洞设施可以进行研究的通知事件，尽量写多点这个
country_event = {
	id = kuat_extramonster.335
	title = "kuat_extramonster.335.name"
	desc = "kuat_extramonster.335.desc"
	diplomatic = yes
	picture_event_data = { room = astral_rift_genesis_2_room }
	custom_gui = "kuat_event_m_window"
	custom_gui_option = "kuat_event_m_option"
	show_sound = event_red_alert
	is_triggered_only = yes
	location = event_target:kuat_white_hole_star
	trigger = {
		is_ai = no
		has_global_flag = kuat_extramonster_begin
		NOT = { has_global_flag = kuat_extramonster_ended }
		exists = event_target:kuat_contractor_hostile
		any_system = {
			has_star_flag = kuat_white_hole_star
			NOT = { has_star_flag = kuat_white_hole_rainforce_disable }
		}
		event_target:global_event_country = { 
			check_variable = { which = kuat_white_hole_var value > 0 }
		}
		check_variable = { which = kuat_white_hole_star_enable value >= 5 }
		check_variable = { which = kuat_white_hole_star_enable value <= 11 }
		NOT = { has_global_flag = kuat_white_hole_star_unlock_temple }
	}
	immediate = { 
		set_global_flag = kuat_white_hole_star_unlock_temple 
		random_system = {
			limit = {
				has_star_flag = kuat_white_hole_star
				NOT = { has_star_flag = kuat_white_hole_rainforce_disable }
			}
			save_event_target_as = kuat_white_hole_star
		}
	}
	option = {
		name = "kuat_extramonster.335.a"
		enable_special_project = {
			name = exe_rebuild_control_whitehole_facility
			owner = root location = event_target:kuat_white_hole_star
		}
	}
}

#special project finished
ship_event = {
	id = kuat_extramonster.37
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		exists = owner
		owner = { is_player_country = yes }
		has_global_flag = kuat_extramonster_begin
		NOT = { has_global_flag = kuat_extramonster_ended }
		exists = solar_system
		solar_system = {
			has_star_flag = kuat_white_hole_star
			NOT = { has_star_flag = kuat_white_hole_rainforce_disable }
		}
	}
	immediate = {
		solar_system = {
			set_star_class = sc_black_hole
			star = {
				create_ambient_object = { type = "star_explosion" play_animation_once = yes location = this }
				last_created_ambient_object = { set_location = { target = prev distance = 0 angle = random } }
				create_ambient_object = { type = "destroyed_system" location = this }
				last_created_ambient_object = { set_ambient_object_flag = destroyed_system_effect set_location = { target = prev  distance = 0  angle = random  } }
				change_pc = pc_black_hole
			}
			set_star_flag = kuat_white_hole_rainforce_disable
		}
		owner = {
			if = {
				limit = { NOT = { is_variable_set = kuat_white_hole_star_enable } }
				remove_point_of_interest = sc_kuat_white_hole.1
			}
			else_if = {
				limit = { check_variable = { which = kuat_white_hole_star_enable value = 1 } }
				remove_point_of_interest = sc_kuat_white_hole.2
			}
			else_if = {
				limit = { check_variable = { which = kuat_white_hole_star_enable value = 2 } }
				remove_point_of_interest = sc_kuat_white_hole.3
			}
			else_if = {
				limit = { check_variable = { which = kuat_white_hole_star_enable value = 3 } }
				remove_point_of_interest = sc_kuat_white_hole.4
			}
			else_if = {
				limit = { check_variable = { which = kuat_white_hole_star_enable value = 4 } }
				remove_point_of_interest = sc_kuat_white_hole.5
			}
			else_if = {
				limit = { check_variable = { which = kuat_white_hole_star_enable value = 5 } }
				remove_point_of_interest = sc_kuat_white_hole.6
			}
			else = { remove_point_of_interest = sc_kuat_white_hole.6 }
		}
		owner = {
			change_variable = { which = kuat_white_hole_star_enable value = 1 }
			country_event = { id = kuat_extramonster.39 }
		}
	}
}

#Notificaton: White hole is eliminate 通知：白洞被关闭转化的集成外交事件
country_event = {
	id = kuat_extramonster.39
	title = "kuat_extramonster.39.title"
	desc = {
		trigger = { check_variable = { which = kuat_white_hole_star_enable value = 1 } }
		text = "kuat_extramonster.39.a.desc"
	}
	desc = {
		trigger = { check_variable = { which = kuat_white_hole_star_enable value = 2 } }
		text = "kuat_extramonster.39.b.desc"
	}
	desc = {
		trigger = { check_variable = { which = kuat_white_hole_star_enable value = 3 } }
		text = "kuat_extramonster.39.c.desc"
	}
	desc = {
		trigger = { check_variable = { which = kuat_white_hole_star_enable value = 4 } }
		text = "kuat_extramonster.39.d.desc"
	}
	desc = {
		trigger = { check_variable = { which = kuat_white_hole_star_enable value = 5 } }
		text = "kuat_extramonster.39.e.desc"
	}
	desc = {
		trigger = { check_variable = { which = kuat_white_hole_star_enable value > 5 } }
		text = "kuat_extramonster.39.f.desc"
	}
	diplomatic = yes
	picture_event_data = { room = no_video_feed_room }
	custom_gui = "kuat_event_diplomacy_window"
	custom_gui_option = "kuat_event_diplomacy_option"
	show_sound = event_wind_ruins
	is_triggered_only = yes
	trigger = { 
		is_player_country = yes
		has_global_flag = kuat_extramonster_begin
		NOT = { has_global_flag = kuat_extramonster_ended }
	}

	#1
	option = { 
		name = kuat_extramonster.39.a.1 
		trigger = { check_variable = { which = kuat_white_hole_star_enable value = 1 } }
		response_text = kuat_extramonster.39.a.1.resp
	}

	#2
	option = { 
		name = kuat_extramonster.39.b.1
		trigger = { check_variable = { which = kuat_white_hole_star_enable value = 2 } } 
		response_text = kuat_extramonster.39.b.1.resp
	}

	#3
	option = { 
		name = kuat_extramonster.39.c.1 
		trigger = { check_variable = { which = kuat_white_hole_star_enable value = 3 } }
		response_text = kuat_extramonster.39.c.1.resp
	}

	#4
	option = { 
		name = kuat_extramonster.39.d.1 
		trigger = { check_variable = { which = kuat_white_hole_star_enable value = 4 } }
		response_text = kuat_extramonster.39.d.1.resp 
	}

	#5
	option = { 
		name = kuat_extramonster.39.e.1
		trigger = { check_variable = { which = kuat_white_hole_star_enable value = 5 } }
		response_text = kuat_extramonster.39.e.1.resp 
	}

	#6
	option = { 
		name = kuat_extramonster.39.f.1
		trigger = { check_variable = { which = kuat_white_hole_star_enable value > 5 } }
		hidden_effect = { 
			set_spawn_system_batch = begin
			root.capital_scope = { solar_system = {
				spawn_system = { initializer = kuat_white_hole_system_7 min_distance >= 45 max_distance <= 15 }
			}}
			event_target:kuat_white_hole_system_7 = {
				set_star_flag = kuat_white_hole_star_final
				kuat_contractor_super_create_elternal_system_warbase = yes
				system_event = { id = kuat_extramonster.24 days = 30 }
				set_timed_star_flag = { flag = kuat_white_hole_star_in_system days = 30 }
			}
			country_event = { id = kuat_extramonster.391 days = 1 }
			set_spawn_system_batch = end
		}
		response_text = kuat_extramonster.39.f.1.resp 
	}

	after = {
		remove_global_flag = kuat_white_hole_star_unlock_temple
	}
}

#通知最终要塞出现
country_event = {
	id = kuat_extramonster.391
	title = "kuat_extramonster.391.title"
	desc = "kuat_extramonster.391.desc"
	diplomatic = yes
	picture_event_data = { room = astral_rift_siege_on_paradise_grunur_room }
	custom_gui = "kuat_event_m_window"
	custom_gui_option = "kuat_event_m_option"
	is_triggered_only = yes
	trigger = {
		is_player_country = yes
		has_global_flag = kuat_extramonster_begin
		NOT = { has_global_flag = kuat_extramonster_ended }
	}
	option = { name = "kuat_extramonster.391.a" }
}

#摧毁最终要塞，允许进入
country_event = {
	id = kuat_extramonster.392
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_global_flag = kuat_extramonster_begin
		from = { is_kuat_contractor_faction = yes }
		fromfromfrom = {
			has_ship_flag = kuat_contractor_super_capital_fleet
		}
	}
	immediate = {
		set_global_flag = kuat_extra_contractor_wined_target 
		event_target:kuat_white_hole_system_7 = {
			set_star_class = sc_black_hole
			star = {
				create_ambient_object = { type = "star_explosion" play_animation_once = yes location = this }
				last_created_ambient_object = { set_location = { target = prev distance = 0 angle = random } }
				create_ambient_object = { type = "destroyed_system" location = this }
				last_created_ambient_object = { set_ambient_object_flag = destroyed_system_effect set_location = { target = prev  distance = 0  angle = random  } }
				change_pc = pc_black_hole
			}
			set_star_flag = kuat_white_hole_rainforce_disable
		}
		if = {
			limit = { exists = event_target:kuat_contractor_support }
			event_target:kuat_contractor_support = {
				set_global_flag = kuat_ded_contractor_hostile_destroyed
				set_country_type = kuat_contractor_support
				set_faction_hostility = {
					target = event_target:kuat_contractor_hostile
					set_friendly = no set_hostile = yes set_neutral = no
				}
				if = {
					limit = { NOT = { exists = event_target:kuat_contractor_hostile } }
					every_owned_fleet = {
						limit = { has_fleet_flag = kuat_contractor_invasion_fleet }
						clear_orders = yes
						clear_fleet_actions = this
					}
				}
			}
			every_country = {
				limit = { NOR = {
					is_same_value = event_target:kuat_contractor_hostile
					has_country_flag = trigger_kuat_contractor_hostile_event_temple
				} }
				set_timed_country_flag = { flag = trigger_kuat_contractor_hostile_event_temple days = 1 }
				country_event = { id = kuat_extramonster.352 }
			}
		}
		if = {
			limit = { event_target:kuat_contractor_hostile = {
				count_owned_fleet = { count = 0 limit = { OR = { 
					has_fleet_flag = kuat_contractor_defenced_fleet 
					has_fleet_flag = kuat_contractor_invasion_fleet 
				} } }
			} }
			every_country = {
				limit = { NOR = { 
					is_same_value = event_target:kuat_contractor_hostile 
					has_country_flag = trigger_ended_event_temple
				} }
				set_timed_country_flag = { flag = trigger_ended_event_temple days = 1 }
				country_event = { id = kuat_extramonster.35 }
			}
			add_threat = { who = root amount = 50 }
			set_global_flag = kuat_extramonster_ended
			event_target:kuat_contractor_hostile  = { destroy_country = yes }
		}
		else = { country_event = { id = kuat_extramonster.393 days = 2 } }
	}
}

#乘胜追击！
country_event = {
	id = kuat_extramonster.393
	title = "kuat_extramonster.393.title"
	desc = "kuat_extramonster.393.desc"
	diplomatic = yes
	picture_event_data = { room = astral_rift_crystal_2_room }
	custom_gui = "kuat_event_m_window"
	custom_gui_option = "kuat_event_m_option"
	is_triggered_only = yes
	trigger = {
		NOT = { has_country_flag = kuat_extramonster.393.fired }
		is_player_country = yes
		has_global_flag = kuat_extramonster_begin
		NOT = { has_global_flag = kuat_extramonster_ended }
	}
	immediate = {
		set_country_flag = kuat_extramonster.393.fired
	}
	option = { name = "kuat_extramonster.393.a" }
}

#A defense fleet destroyed, white hole research enable.   
country_event = {
	id = kuat_extramonster.301
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_global_flag = kuat_extramonster_begin
		from = { is_kuat_contractor_faction = yes }
		fromfromfrom = { 
			has_ship_flag = kuat_contractor_capital_fleet
			exists = solar_system
			solar_system = {
				has_star_flag = kuat_white_hole_star
				NOR = { 
					has_star_flag = kuat_white_hole_star_final
					has_star_flag = kuat_white_hole_rainforce_disable 
					has_star_flag = kuat_white_hole_rainforce_attack_active
				}
			}
		}
	}
	immediate = {
		every_country = {
			limit = { NOR = { 
				is_same_value = event_target:kuat_contractor_hostile 
				has_country_flag = trigger_ended_event_temple
			} }
			set_timed_country_flag = { flag = trigger_ended_event_temple days = 1 }
			country_event = { id = kuat_extramonster.302 }
		}
		fromfromfrom.solar_system = { set_star_flag = kuat_white_hole_rainforce_attack_active }
		if = {
			limit = { NOT = { has_global_flag = kuat_set_forcetrigger_order_enable_crisis_eve_system } }
			if = {
				limit = { NOT = { exists = event_target:situation_white_hole_system_disable } }
				start_situation = { type = situation_white_hole_system_disable }
			}
		}
		else = {
			change_variable = { which = kuat_white_hole_star_enable value = 1 }
			if = {
				limit = { check_variable = { which = kuat_white_hole_star_enable value > 4 } }
				set_spawn_system_batch = begin
				random_rim_system = {
					limit = { NOT = { exists = space_owner } }
					spawn_system = { initializer = kuat_white_hole_system_7 min_distance >= 45 max_distance <= 15 }
				}
				event_target:kuat_white_hole_system_7 = {
					set_star_flag = kuat_white_hole_star_final
					kuat_contractor_super_create_elternal_system_warbase = yes
					system_event = { id = kuat_extramonster.24 days = 30 }
					set_timed_star_flag = { flag = kuat_white_hole_star_in_system days = 30 }
				}
				country_event = { id = kuat_extramonster.391 days = 1 }
				set_spawn_system_batch = end
			}
		}
	}
}
country_event = {
	id = kuat_extramonster.3011
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		from = { is_kuat_contractor_faction = yes }
		fromfromfrom = {
			has_ship_flag = kuat_ded_contractor_capital_fleet
			exists = solar_system
			solar_system = { has_star_flag = kuat_ded_white_hole_star }
		}
	}
	immediate = {
		every_country = {
			limit = { NOR = {
				is_same_value = event_target:kuat_contractor_support
				has_country_flag = trigger_ended_event_temple
			} }
			set_timed_country_flag = { flag = trigger_ended_event_temple days = 1 }
			country_event = { id = kuat_extramonster.3021 }
		}
		event_target:global_event_country = { subtract_variable = { which = kuat_ded_white_hole_var value = 1 } }
		fromfromfrom.solar_system = { set_star_flag = kuat_ded_white_hole_star_rainforce_dsiable }
	}
}

#Notification: Invasion end.  白洞星系被攻破，白洞允许进行转化研究
country_event = {
	id = kuat_extramonster.302
	title = "kuat_extramonster.302.name"
	desc = "kuat_extramonster.302.desc"
	diplomatic = yes
	picture_event_data = { room = astral_rift_genesis_3_room }
	custom_gui = "kuat_event_m_window"
	custom_gui_option = "kuat_event_m_option"
	show_sound = event_wind_ruins
	is_triggered_only = yes
	option = { 
		name = "kuat_extramonster.302.b" 
		ai_chance = { weight = 5 }
	}
}
country_event = {
	id = kuat_extramonster.3021
	title = "kuat_extramonster.3021.name"
	desc = {
		trigger = { event_target:global_event_country = {
			check_variable = { which = kuat_ded_white_hole_var value > 0 }
		} }
		text = "kuat_extramonster.3021.desc"
	}
	desc = {
		trigger = { event_target:global_event_country = {
			check_variable = { which = kuat_ded_white_hole_var value <= 0 }
		} }
		text = "kuat_extramonster.3021.finial_desc"
	}
	diplomatic = yes
	picture_event_data = { room = astral_rift_clock_room }
	custom_gui = "kuat_event_m_window"
	custom_gui_option = "kuat_event_m_option"
	show_sound = event_wind_ruins
	is_triggered_only = yes
	immediate = { if = {
		limit = { event_target:global_event_country = {
			check_variable = { which = kuat_ded_white_hole_var value <= 0 }
		} }
		every_system = {
			limit = { has_star_flag = myst_system_5 }
			remove_star_flag = ag_no_jump_in_system
			remove_star_flag = kuat_ded_white_hole_clock
		}
	} }
	option = { name = "kuat_extramonster.3021.b" ai_chance = { weight = 5 } }
}

#All invasion fleet destroyed, invasion end.  
country_event = {
	id = kuat_extramonster.30
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_global_flag = kuat_extramonster_begin
		from = {
			is_kuat_contractor_faction = yes
			count_owned_fleet = {
				limit = { 
					has_fleet_flag = kuat_contractor_invasion_fleet 
					NOT = { is_same_value = root.fromfromfrom } 
				}
				count = 0
			}
		}
		fromfromfrom = { has_fleet_flag = kuat_contractor_invasion_fleet }
		has_global_flag = kuat_extra_contractor_wined_target
	}
	immediate = {
		every_country = {
			limit = { NOR = { 
				is_same_value = event_target:kuat_contractor_hostile 
				has_country_flag = trigger_ended_event_temple
			} }
			set_timed_country_flag = { flag = trigger_ended_event_temple days = 1 }
			country_event = { id = kuat_extramonster.35 }
		}
		add_threat = { who = root amount = 50 }
		set_global_flag = kuat_extramonster_ended
		from = { destroy_country = yes }
	}
}
country_event = {
	id = kuat_extramonster.305
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		from = { is_kuat_contractor_faction = yes }
		fromfromfrom = {
			has_ship_flag = kuat_ded_contractor_super_capital_fleet
			exists = solar_system
			solar_system = { has_star_flag = myst_system_5 }
		}
	}
	immediate = {
		if = {
			limit = { NOT = { has_country_flag = trigger_ended_event_temple } }
			set_timed_country_flag = { flag = trigger_ended_event_temple days = 1 }
			country_event = { id = kuat_extramonster.351 }
		}
		every_system = {
			limit = { has_star_flag = myst_system_5 }
			spawn_megastructure = {
				type = exe_outer_gate_f_facility
				planet = system_star
				init_effect = { save_global_event_target_as = exe_outer_gate_f_facility }
			}
		}
		destroy_country = yes
	}
}

#on monthly purly
country_event = {
	id = kuat_extramonster.303
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_global_flag = kuat_extramonster_begin
		is_same_value = event_target:kuat_contractor_hostile
		count_owned_fleet = {
			limit = { has_fleet_flag = kuat_contractor_invasion_fleet }
			count = 0
		}
		has_global_flag = kuat_extra_contractor_wined_target
	}
	immediate = {
		every_country = {
			limit = { NOR = { 
				is_same_value = event_target:kuat_contractor_hostile
				has_country_flag = trigger_ended_event_temple
			} }
			set_timed_country_flag = { flag = trigger_ended_event_temple days = 1 }
			country_event = { id = kuat_extramonster.35 }
		}
		set_global_flag = kuat_extramonster_ended
		destroy_country = yes
	}
}
country_event = {
	id = kuat_extramonster.304
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_global_flag = kuat_extramonster_begin
		from = { is_kuat_contractor_faction = yes }
		fromfromfrom = {
			is_ship_size = Drift_megastructure_starbase
			NOT = { has_fleet_flag = kuat_enable_bossbar }
			solar_system = { is_same_value = event_target:kuat_white_hole_system_7 }
		}
		NOT = { has_global_flag = kuat_set_forcetrigger_order_enable_crisis_eve_system }
	}
	immediate = {
		fromfromfrom = {
			set_fleet_flag = kuat_enable_bossbar
			random_owned_ship = {
				limit = { is_ship_size = Drift_megastructure_starbase }
				prevprev = { country_event = { id =  kuat_extramonster.400 scopes = { from = prev } } }
			}
		}
	}
}

#Notification: Invasion end create award.  #白洞设施完全关闭，允许关闭F设施星门，获得奖品
country_event = {
	id = kuat_extramonster.35
	title = "kuat_extramonster.35.name"
	desc = "kuat_extramonster.35.desc"
	diplomatic = yes
	picture_event_data = { room = astral_rift_clock_room }
	custom_gui = "kuat_event_window"
	custom_gui_option = "kuat_event_option"
	show_sound = event_wind_ruins
	is_triggered_only = yes
	option = { 
		name = "kuat_extramonster.35.b" 
		ai_chance = { weight = 5 }
	}
	after = { if = {
		limit = { is_ai = no }
		enable_special_project = {
			name = kuat_contractor_return_invasion_reward_project
			owner = root location = capital_scope
		}
	} }
}

country_event = {
	id = kuat_extramonster.351
	title = "kuat_extramonster.351.name"
	desc = "kuat_extramonster.351.desc"
	diplomatic = yes
	picture_event_data = { room = astral_rift_clock_room }
	custom_gui = "kuat_event_window"
	custom_gui_option = "kuat_event_option"
	is_triggered_only = yes
	option = { name = "kuat_extramonster.351.b" }
}

#after crisis #关闭F星域以后,冬眠者苏醒
country_event = {
	id = kuat_extramonster.352
	title = "kuat_extramonster.352.name"
	desc = "kuat_extramonster.352.desc"
	diplomatic = yes
	picture_event_data = { room = galactic_community_room }
	custom_gui = "kuat_event_window"
	custom_gui_option = "kuat_event_option"
	is_triggered_only = yes
	option = {
		name = "kuat_extramonster.352.b"
		ai_chance = { weight = 5 }
	}
	after = { if = { limit = { is_ai = no } country_event = { id = kuat_extramonster.353 days = 15 random = 10 } } }
}

#after crisis #关闭F星域以后，冬眠者外交事件
country_event = {
	id = kuat_extramonster.353
	title = "kuat_extramonster.353.title"
	desc = {
		trigger = { has_country_flag = fire_once_contact_ded }
		text = "kuat_extramonster.353.fdesc"
	}
	desc = {
		trigger = { NOT = { has_country_flag = fire_once_contact_ded } }
		text = "kuat_extramonster.353.desc"
	}
	diplomatic = yes
	picture_event_data = { room = no_video_feed_room }
	custom_gui = "kuat_event_diplomacy_window"
	custom_gui_option = "kuat_event_diplomacy_option"
	show_sound = event_wind_ruins
	is_triggered_only = yes
	trigger = { is_ai = no }
	option = {
		name = kuat_extramonster.353.a
		is_dialog_only = yes
		hidden_effect = { set_country_flag = fire_once_contact_ded }
		response_text = kuat_extramonster.353.a.resp
	}
	option = {
		name = kuat_extramonster.353.b
		is_dialog_only = yes
		hidden_effect = { set_country_flag = fire_once_contact_ded }
		response_text = kuat_extramonster.353.b.resp
	}
	option = {
		name = kuat_extramonster.353.c
		hidden_effect = {
			set_faction_hostility = {
				target = event_target:kuat_contractor_support
				set_friendly = yes set_hostile = no set_neutral = no
			}
			set_global_flag = kuat_contractor_support_friendly_path
			every_galaxy_fleet = {
				limit = { has_fleet_flag = kuat_contractor_invasion_fleet }
				clear_orders = yes clear_fleet_actions = this
				set_location = event_target:will_be_add_habitable_plague
			}
			country_event = { id = kuat_extramonster.354 days = 360 random = 720 }
		}
		response_text = kuat_extramonster.353.c.resp
	}
	option = {
		name = kuat_extramonster.353.d
		hidden_effect = {
			set_faction_hostility = {
				target = event_target:kuat_contractor_support
				set_friendly = no set_hostile = yes set_neutral = no
			}
			remove_global_flag = kuat_ded_contractor_hostile_destroyed
			set_global_flag = kuat_contractor_support_hostile_path
			every_system = {
				limit = {
					has_star_flag = kuat_ded_white_hole_star
					NOT = { has_star_flag = kuat_ded_white_hole_star_rainforce_dsiable }
				}
				system_star = { kuat_ded_contractor_create_retrun_invasion_fleet_detail = yes }
				system_event = { id = kuat_extramonster.241 days = 360 random = 720 }
			}
			every_galaxy_fleet = {
				limit = { has_fleet_flag = kuat_contractor_invasion_fleet }
				fleet_event = { id  = kuat_extramonster.12 days = 1 random = 5 }
			}
		}
		response_text = kuat_extramonster.353.d.resp
	}
}

#后裔
country_event = {
	id = kuat_extramonster.354
	title = "kuat_extramonster.354.title"
	desc = "kuat_extramonster.354.desc"
	diplomatic = yes
	picture_event_data = { room = no_video_feed_room }
	custom_gui = "kuat_event_diplomacy_window"
	custom_gui_option = "kuat_event_diplomacy_option"
	is_triggered_only = yes
	trigger = { is_ai = no }
	option = {
		name = "kuat_extramonster.354.a"
		response_text = kuat_extramonster.354.a.resp
	}
	after = {
		event_target:kuat_contractor_support = { destroy_country = yes }
		every_system = {
			limit = { has_star_flag = myst_system_5 }
			remove_star_flag = ag_no_jump_in_system
			remove_star_flag = kuat_ded_white_hole_clock
			every_ambient_object = { destroy_ambient_object = this }
		}
		enable_special_project = {
			name = "kuat_unlock_abssye_extramonster_tech"
			owner = root location = root.capital_scope
		}
		set_global_flag = kuat_ded_contractor_support_destroyed
	}
}

country_event = {
	id = kuat_extramonster.355
	title = "kuat_extramonster.355.title"
	desc = {
		trigger = {
			success_text = {
				text = "kuat_extramonster.355.desc"
				NOR = {
					has_country_flag = kuat_extramonster.355.a
					has_country_flag = kuat_extramonster.355.b
					has_country_flag = kuat_extramonster.355.c
					has_country_flag = kuat_extramonster.355.d
					has_country_flag = kuat_extramonster.355.e
				}
			}
			success_text = {
				text = "kuat_extramonster.355.a.desc"
				has_country_flag = kuat_extramonster.355.a
			}
			success_text = {
				text = "kuat_extramonster.355.b.desc"
				has_country_flag = kuat_extramonster.355.b
			}
			success_text = {
				text = "kuat_extramonster.355.c.desc"
				has_country_flag = kuat_extramonster.355.c
			}
			success_text = {
				text = "kuat_extramonster.355.d.desc"
				has_country_flag = kuat_extramonster.355.d
			}
			success_text = {
				text = "kuat_extramonster.355.e.desc"
				has_country_flag = kuat_extramonster.355.e
			}
		}
	}
	diplomatic = yes
	picture_event_data = { room = no_video_feed_room }
	custom_gui = "kuat_event_diplomacy_window"
	custom_gui_option = "kuat_event_diplomacy_option"
	show_sound = event_wind_ruins
	is_triggered_only = yes
	trigger = { has_global_flag = kuat_ded_contractor_support_destroyed is_ai = no }
	option = {
		name = kuat_extramonster.355.a
		hidden_effect = {
			remove_country_flag = kuat_extramonster.355.b
			remove_country_flag = kuat_extramonster.355.c
			remove_country_flag = kuat_extramonster.355.d
			remove_country_flag = kuat_extramonster.355.e
			set_country_flag = kuat_extramonster.355.a
			country_event = { id  = kuat_extramonster.355 }
		}
	}
	option = {
		name = kuat_extramonster.355.b
		hidden_effect = {
			remove_country_flag = kuat_extramonster.355.a
			remove_country_flag = kuat_extramonster.355.c
			remove_country_flag = kuat_extramonster.355.d
			remove_country_flag = kuat_extramonster.355.e
			set_country_flag = kuat_extramonster.355.b
			country_event = { id  = kuat_extramonster.355 }
		}
	}
	option = {
		name = kuat_extramonster.355.c
		hidden_effect = {
			remove_country_flag = kuat_extramonster.355.b
			remove_country_flag = kuat_extramonster.355.a
			remove_country_flag = kuat_extramonster.355.d
			remove_country_flag = kuat_extramonster.355.e
			set_country_flag = kuat_extramonster.355.c
			country_event = { id  = kuat_extramonster.355 }
		}
	}
	option = {
		name = kuat_extramonster.355.d
		hidden_effect = {
			remove_country_flag = kuat_extramonster.355.b
			remove_country_flag = kuat_extramonster.355.c
			remove_country_flag = kuat_extramonster.355.a
			remove_country_flag = kuat_extramonster.355.e
			set_country_flag = kuat_extramonster.355.d
			country_event = { id  = kuat_extramonster.355 }
		}
	}
	option = {
		name = kuat_extramonster.355.e
		hidden_effect = {
			remove_country_flag = kuat_extramonster.355.b
			remove_country_flag = kuat_extramonster.355.c
			remove_country_flag = kuat_extramonster.355.d
			remove_country_flag = kuat_extramonster.355.a
			set_country_flag = kuat_extramonster.355.e
			country_event = { id  = kuat_extramonster.355 }
		}
	}
	option = {
		name = "kuat_extramonster.355.f"
		hidden_effect = {
			set_country_flag = kuat_research_Name_boss_crisis_SPF_BOSS_building_research
			set_country_flag = kuat_research_Name_boss_crisis_SPC_BOSS_building_research
			set_country_flag = kuat_research_Name_boss_crisis_SP_BOSS_building_research
			remove_country_flag = kuat_extramonster.355.b
			remove_country_flag = kuat_extramonster.355.c
			remove_country_flag = kuat_extramonster.355.d
			remove_country_flag = kuat_extramonster.355.a
			remove_country_flag = kuat_extramonster.355.e
		}
	}
}

#after crisis #关闭F星域以后，流浪者外交事件
country_event = {
	id = kuat_extramonster.38
	title = "kuat_extramonster.38.title"
	desc = {
		trigger = { has_country_flag = fire_once_contact }
		text = "kuat_extramonster.38.fdesc"
	}
	desc = {
		trigger = { NOT = { has_country_flag = fire_once_contact } }
		text = "kuat_extramonster.38.desc"
	}
	diplomatic = yes
	picture_event_data = { room = no_video_feed_room }
	custom_gui = "kuat_event_diplomacy_window"
	custom_gui_option = "kuat_event_diplomacy_option"
	show_sound = event_wind_ruins
	is_triggered_only = yes
	trigger = { is_ai = no }
	option = { 
		name = kuat_extramonster.38.a 
		is_dialog_only = yes
		hidden_effect = { set_country_flag = fire_once_contact }
		response_text = kuat_extramonster.38.a.resp 
	}
	option = { 
		name = kuat_extramonster.38.b 
		is_dialog_only = yes
		hidden_effect = { set_country_flag = fire_once_contact }
		response_text = kuat_extramonster.38.b.resp 
	}
	option = { 
		name = kuat_extramonster.38.c 
		is_dialog_only = yes
		hidden_effect = { set_country_flag = fire_once_contact }
		response_text = kuat_extramonster.38.c.resp 
	}
	option = { 
		name = kuat_extramonster.38.d 
		is_dialog_only = yes
		hidden_effect = { set_country_flag = fire_once_contact }
		response_text = kuat_extramonster.38.d.resp 
	}
	option = { 
		name = kuat_extramonster.38.e
		custom_tooltip = "kuat_extramonster.38.e.tooltip"
		hidden_effect = { 
			set_country_flag = kuat_research_Name_boss_crisis_DF_BOSS_building_research
			remove_country_flag = fire_once_contact 
			end_event_chain = kuat_contractor_exe_invasion_chain
			random_system = {
				limit = { has_star_flag = myst_system_5 }
				every_system_megastructure = { remove_megastructure = this }
				star = {
					create_ambient_object = { type = "star_explosion" play_animation_once = yes location = this }
					last_created_ambient_object = { set_location = { target = prev distance = 0 angle = random } }
					create_ambient_object = { type = "destroyed_system" location = this }
					last_created_ambient_object = { set_ambient_object_flag = destroyed_system_effect set_location = { target = prev  distance = 0  angle = random  } }
					set_planet_entity = { entity = starforge_avoid_entity }
					set_planet_size = -1
				}
				remove_modifier = Kuat_contractor_F_faclitlty_Forbidden
				every_system_ambient_object = { destroy_ambient_object = this }
			}
			set_global_flag = kuat_extramonster_all_over
		}
	}
}

# 血条ui
# this = country
# from = ship
country_event = {
	id = kuat_extramonster.400
	title = Drift_megastructure_starbase
	desc = Drift_megastructure_starbase
	is_triggered_only = yes
	immediate = {
		from = { save_global_event_target_as = is_kuat_boss }
	}
	auto_opens = yes
	major = yes
	diplomatic = yes
	custom_gui = kuat_bossbar
	diplomatic_title = kuat_get_boss_name
	abort_trigger = { OR = {
		NOT = { exists = event_target:is_kuat_boss }
		event_target:is_kuat_boss = { OR = { is_in_combat = no has_hp = 0 } }
	} }
	abort_effect = {
		if = {
			limit = { exists = from }
			from.fleet = { remove_fleet_flag = kuat_enable_bossbar }
		}
		clear_global_event_target = is_kuat_boss
	}
}