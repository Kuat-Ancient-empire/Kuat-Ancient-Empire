namespace = exe_kuat_return
#阶段一
event = {
	id = exe_kuat_return.1
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_global_flag = fire_the_kuat_return
		NOT = { has_global_flag = fire_facility_return }
		NOR = {
			has_global_flag = exe_kuat_return_seed
			exists = event_target:eternal_fleet_country
		}
	}
	immediate = {
		set_global_flag = exe_kuat_return_seed
		set_timed_global_flag = {
			flag = exe_invasion_signs_kuat_return_cooldown
			days = 360
		}
		random_system = {
			limit = { kuat_is_kuat_system = yes }
			every_playable_country = {
				limit = {
					intel_level = {
						level >= medium
						system = prev
					}
				}
				country_event = { id = exe_kuat_return.2 days = 1 random = 2 }
			}
		}
	}
}

country_event = {
	id = exe_kuat_return.2
	title = "exe_kuat_return.2.name"
	desc = "exe_kuat_return.2.desc"
	diplomatic = yes
	picture_event_data = { room = satellite_in_orbit_room }
	custom_gui = "kuat_event_m_window"
	custom_gui_option = "kuat_event_m_option"
	show_sound = event_sensor_ping
	location = root.capital_scope
	is_triggered_only = yes
	option = { name = "exe_kuat_return.2.a" }
}

#阶段二
event = {
	id = exe_kuat_return.3
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_global_flag = fire_the_kuat_return
		NOT = { has_global_flag = fire_facility_return }
		has_global_flag = exe_kuat_return_seed
		NOR = {
			has_global_flag = exe_kuat_return_2_fired
			has_global_flag = exe_invasion_signs_kuat_return_cooldown
		}
	}
	immediate = {
		set_global_flag = exe_kuat_return_2_fired
		set_timed_global_flag = {
			flag = exe_invasion_signs_kuat_return_cooldown
			days = 360
		}
		every_playable_country = { country_event = { id = exe_kuat_return.4 days = 1 random = 2 } }
	}
}

country_event = {
	id = exe_kuat_return.4
	title = "exe_kuat_return.4.name"
	desc = "exe_kuat_return.4.desc"
	diplomatic = yes
	picture_event_data = { room = Eternal_Empire2_room }
	custom_gui = "kuat_event_m_window"
	custom_gui_option = "kuat_event_m_option"
	show_sound = event_yellow_alert
	location = root.capital_scope
	is_triggered_only = yes
	option = { name = "exe_kuat_return.4.a" }
}

#阶段三
event = {
	id = exe_kuat_return.5
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_global_flag = fire_the_kuat_return
		NOT = { has_global_flag = fire_facility_return }
		has_global_flag = exe_kuat_return_2_fired
		NOR = {
			has_global_flag = exe_invasion_signs_kuat_return_cooldown
			has_global_flag = exe_kuat_return_3_fired
		}
	}
	immediate = {
		set_global_flag = exe_kuat_return_3_fired
		set_timed_global_flag = { flag = exe_invasion_signs_kuat_return_cooldown days = 10 }
		every_playable_country = { country_event = { id = exe_kuat_return.6 days = 2 } }
		random_country = {
			limit = { is_ai = no }
			country_event = { id = exe_kuat_return.61 days = 1 }
		}
	}
}

country_event = {
	id = exe_kuat_return.61
	hide_window = yes
	fire_only_once = yes
	is_triggered_only = yes
	immediate = {
		set_update_modifiers_batch = begin
		#国家
		create_country = {
			name = "Name_kuat"
			species = event_target:kuat_player_target_species
			name_list = "MAM3"
			type = kuat_awakened_returned_empire
			flag = {
				icon = {
					category = "Kuat"
					file = "Kuat_flags_01.dds"
				}
				background = {
					category = "backgrounds"
					file = "00_solid.dds"
				}
				colors = { "blue" "blue" "null" "null" }
			}
			ignore_initial_colony_error = yes
			authority = auth_imperial
			civics = {
				civic = civic_revanchist_fervor_kuat
				civic = civic_ancient_caches_of_technology_kuat
			}
			origin = "origin_fallen_empire"
			ethos = { ethic = ethic_fanatic_materialist }
			effect = {
				save_global_event_target_as = return_kuat_awakening_country
				set_graphical_culture = fallen_empire_kuat_01
				set_country_flag = return_fallen_empire_kuat
				add_resource = {
					minerals = 1000000
					energy = 1000000
					food = 1000000
					influence = 1000000
					sr_dark_matter = 1000000
					sr_living_metal = 100000
					sr_zro = 1000000
					consumer_goods = 1000000
				}
				# must initialize global designs here
				add_global_ship_design = "NAME_Enforcer"
				add_global_ship_design = "NAME_Savant"
				add_global_ship_design = "NAME_Scholar"
				add_global_ship_design = "NAME_Sage"
				add_global_ship_design = "NAME_Cloaker"
				add_global_ship_design = "NAME_Librarian"
				add_global_ship_design = "NAME_Seeker"
				add_global_ship_design = "NAME_FE_Starbase"
				add_global_ship_design = "Name_boss_crisis_EMPIRE_0"
				add_global_ship_design = "Name_boss_crisis_Venganza_0"
				add_global_ship_design = "Name_boss_CRISIS_Dominance_0"
				add_global_ship_design = "Name_criss_boss_Horriwer_0"
				add_global_ship_design = "Name_boss_eclipse"
				add_modifier = { modifier = awaken_ship }
				create_ship_design = { design = "NAME_KUAT_Starbase" }
				add_ship_design = last_created_design
				create_kuat_return_starbase = yes
			}
		}
		#舰队
		every_system = {
			limit = { kuat_is_kuat_system = yes }
			every_system_planet = {
				if = {
					limit = { is_colony = yes }
					every_owned_pop = { kill_pop = yes }
					destroy_colony = yes
				}
				if = {
					limit = { is_planet_class = pc_gaia }
					every_owned_pop = { kill_pop = yes }
					set_controller = event_target:return_kuat_awakening_country
					set_owner = event_target:return_kuat_awakening_country
					create_pop = { species = event_target:return_kuat_awakening_country.owner_main_species }
					add_district = district_city
				}
				if = {
					limit = {
						is_star = no
						is_asteroid = no
						is_ringworld = no
						NOR = {
							has_planet_flag = has_megastructure
							is_planet_class = pc_gaia
							is_planet_class = pc_ringworld_habitable
							is_planet_class = pc_ringworld_seam
							is_planet_class = pc_ringworld_tech
							is_planet_class = pc_ringworld_habitable_damaged
							is_planet_class = pc_ringworld_seam_damaged
							is_planet_class = pc_ringworld_tech_damaged
							is_planet_class = pc_ringworld_shielded
						}
					}
					change_pc = pc_gaia
					set_controller = event_target:return_kuat_awakening_country
					set_owner = event_target:return_kuat_awakening_country
					create_pop = { species = event_target:return_kuat_awakening_country.owner_main_species }
					add_district = district_city
				}
			}
			every_fleet_in_system = {
				limit = { exists = owner NOT = { owner = { is_same_value = event_target:return_kuat_awakening_country } } }
				destroy_fleet = { target = this destroy_template = yes kill_leader = yes }
			}
		}
		set_update_modifiers_batch = end
	}
}

country_event = {
	id = exe_kuat_return.6
	title = "exe_kuat_return.6.name"
	desc = "exe_kuat_return.6.desc"
	diplomatic = yes
	picture_event_data = { room = fallen_empire_awakes_room }
	custom_gui = "kuat_event_m_window"
	custom_gui_option = "kuat_event_m_option"
	show_sound = event_yellow_alert
	location = root.capital_scope
	is_triggered_only = yes
	immediate = { establish_communications_no_message = event_target:return_kuat_awakening_country }
	option = { name = "exe_kuat_return.6.a" }
}

#阶段四
event = {
	id = exe_kuat_return.7
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_global_flag = fire_the_kuat_return
		NOT = { has_global_flag = fire_facility_return }
		has_global_flag = exe_kuat_return_3_fired
		NOR = {
			has_global_flag = exe_invasion_signs_kuat_return_cooldown
			has_global_flag = exe_kuat_return_4_fired
		}
	}
	immediate = {
		set_global_flag = exe_kuat_return_4_fired
		set_timed_global_flag = {
			flag = exe_invasion_signs_kuat_return_cooldown
			days = 20
		}
		every_playable_country = { country_event = { id = exe_kuat_return.8 days = 2 } }
		random_country = {
			limit = { is_ai = no }
			country_event = { id = exe_kuat_return.81 days = 1 }
		}
	}
}

country_event = {
	id = exe_kuat_return.81
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes
	immediate = {
		event_target:return_kuat_awakening_country = { create_kuat_return_fleet_defender = yes }
		remove_country_flag = can_pass_by
		remove_country_flag = can_pass_inner_by
	}
}

country_event = {
	id = exe_kuat_return.8
	hide_window = no
	diplomatic = yes
	title = "exe_kuat_return.8.title"
	desc = "exe_kuat_return.8.desc"
	diplomatic_title = "exe_kuat_return.8.title"
	custom_gui = "kuat_event_diplomacy_window"
	custom_gui_option = "kuat_event_diplomacy_option"
	picture_event_data = {
		city_level = event_target:return_kuat_awakening_country
		portrait = event_target:return_kuat_awakening_country
		room = event_target:return_kuat_awakening_country.ruler
		planet_background = event_target:return_kuat_awakening_country
		graphical_culture = event_target:return_kuat_awakening_country
	}
	is_triggered_only = yes
	option = { name = "exe_kuat_return.8.a" }
}

#阶段五
event = {
	id = exe_kuat_return.9
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_global_flag = fire_the_kuat_return
		NOT = { has_global_flag = fire_facility_return }
		has_global_flag = exe_kuat_return_4_fired
		NOR = {
			has_global_flag = exe_invasion_signs_kuat_return_cooldown
			has_global_flag = exe_kuat_return_5_fired
		}
	}
	immediate = {
		set_global_flag = exe_kuat_return_5_fired
		set_timed_global_flag = {
			flag = exe_invasion_signs_kuat_return_cooldown
			days = 20
		}
		every_playable_country = { country_event = { id = exe_kuat_return.10 days = 2 random = 2 } }
	}
}

country_event = {
	id = exe_kuat_return.10
	hide_window = no
	is_triggered_only = yes
	title = "exe_kuat_return.10.title"
	desc = "exe_kuat_return.10.desc"
	diplomatic = yes
	picture_event_data = { room = l-gateway_room }
	custom_gui = "kuat_event_m_window"
	custom_gui_option = "kuat_event_m_option"
	immediate = { 
		set_country_flag = can_pass_by 
		set_country_flag = can_pass_inner_by
	}
	option = { name = "exe_kuat_return.10.a" }
}

#泛银河同盟
event = {
	id = exe_kuat_return.111
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_global_flag = fire_the_kuat_return
		NOT = { has_global_flag = fire_facility_return }
		has_global_flag = exe_kuat_return_5_fired
		NOR = {
			has_global_flag = exe_invasion_signs_kuat_return_cooldown
			has_global_flag = exe_kuat_return_6_fired
		}
	}
	immediate = {
		set_global_flag = exe_kuat_return_6_fired
		every_playable_country = {
			limit = { is_ai = no }
			country_event = { id = exe_kuat_return.11 days = 2 }
		}
	}
}

country_event = {
	id = exe_kuat_return.11
	hide_window = no
	title = "exe_kuat_return.11.title"
	desc = "exe_kuat_return.11.desc"
	diplomatic = yes
	picture_event_data = { room = galactic_community_room }
	custom_gui = "kuat_event_window"
	custom_gui_option = "kuat_event_option"
	fire_only_once = yes
	is_triggered_only = yes
	trigger = {
		any_country = { is_country_type = kuat_awakened_returned_empire }
		is_ai = no
		has_global_flag = exe_kuat_return_6_fired
	}
	immediate = { save_global_event_target_as = player_declare_warer }
	#建立同盟
	option = {
		name = "exe_kuat_return.11.a"
		set_global_flag = build_the_galaxy_guardiance_alliance
		hidden_effect = { country_event = { id = exe_kuat_return.12 days = 30 } }
	}
	#不建立
	option = {
		name = "exe_kuat_return.11.b"
		set_global_flag = ban_the_galaxy_guardiance_alliance
		hidden_effect = { event_target:return_kuat_awakening_country = { country_event = { id = exe_kuat_return.121 days = 30 } } }
	}
	option = {
		name = "exe_kuat_return.11.c"
		set_global_flag = only_one_the_galaxy_guardiance_alliance
		hidden_effect = { country_event = { id = exe_kuat_return.17 days = 30 } }
	}
}

#不建立，则夸特建立
country_event = {
	id = exe_kuat_return.121
	fire_only_once = yes
	hide_window = yes
	is_triggered_only = yes
	trigger = { 
		has_global_flag = fire_the_kuat_return
		NOT = { has_global_flag = fire_facility_return }
		has_global_flag = ban_the_galaxy_guardiance_alliance 
	}
	immediate = {
		set_update_modifiers_batch = begin
		join_alliance = {
			who = root
			name = "Galactic Empire"
			override_requirements = yes
		}
		set_federation_leader = root
		every_playable_country = {
			limit = { has_federation = no is_ai = yes }
			join_alliance = { who = root override_requirements = yes }
		}
		federation = {
			add_cohesion = 200
			add_federation_experience = 1000
			set_federation_flag = galactic_alliance_for_kuat
			set_federation_type = imperial_loyalists_federation
			set_federation_law = centralization_imperial_loyalists
			set_federation_law = succession_type_none
			set_federation_law = succession_term_perpetual
			set_federation_law = fleet_contribution_none
			set_federation_law = treaties_separate_no_imperial_loyalists
			set_federation_law = declare_war_president_vote_imperial_loyalists
			set_federation_law = invite_members_president_vote_imperial_loyalists
			set_federation_law = kick_members_president_vote_imperial_loyalists
			set_federation_law = vote_weight_diplomatic_imperial_loyalists
			set_federation_law = allow_subjects_to_join_yes_imperial_loyalists
		}
		event_target:player_declare_warer = { country_event = { id = exe_kuat_return.131 } }
		set_update_modifiers_batch = end
	}
}

country_event = {
	id = exe_kuat_return.131
	hide_window = no
	title = "exe_kuat_return.13.title"
	desc = "exe_kuat_return.131.desc"
	diplomatic = yes
	picture_event_data = { room = Eternal_Empire2_room }
	custom_gui = "kuat_event_m_window"
	custom_gui_option = "kuat_event_m_option"
	fire_only_once = yes
	is_triggered_only = yes
	trigger = {
		has_global_flag = fire_the_kuat_return
		NOT = { has_global_flag = fire_facility_return }
	}
	option = {
		name = "exe_kuat_return.13.a"
		hidden_effect = {
			save_global_event_target_as = kuat_Annihilate_country
			set_country_flag = kuat_Annihilate_country
			declare_war = {
				target = event_target:return_kuat_awakening_country
				name = "Galactic Civil War"
				attacker_war_goal = Kuat_total_war
			}
			event_target:return_kuat_awakening_country = {
				country_event = { id = exe_kuat_return.14 days = 45 }
				country_event = { id = exe_kuat_return.14 days = 90 }
				country_event = { id = exe_kuat_return.18 days = 180 }
			}
		}
	}
}

#玩家建立
country_event = {
	id = exe_kuat_return.12
	fire_only_once = yes
	hide_window = yes
	is_triggered_only = yes
	trigger = { 
		has_global_flag = build_the_galaxy_guardiance_alliance 
		has_global_flag = fire_the_kuat_return
		NOT = { has_global_flag = fire_facility_return }
	}
	immediate = {
		set_update_modifiers_batch = begin
		if = {
			limit = { has_federation = yes }
			set_federation_leader = root
			every_playable_country = {
				limit = { has_federation = no }
				join_alliance = { who = root override_requirements = yes }
			}
			federation = {
				set_name = "Name_DEFNECE"
				add_cohesion = 200
				add_federation_experience = 1000
				set_federation_flag = galactic_alliance_for_kuat
				set_federation_type = imperial_loyalists_federation
				set_federation_law = centralization_imperial_loyalists
				set_federation_law = succession_type_none
				set_federation_law = succession_term_perpetual
				set_federation_law = fleet_contribution_none
				set_federation_law = treaties_separate_no_imperial_loyalists
				set_federation_law = declare_war_president_vote_imperial_loyalists
				set_federation_law = invite_members_president_vote_imperial_loyalists
				set_federation_law = kick_members_president_vote_imperial_loyalists
				set_federation_law = vote_weight_diplomatic_imperial_loyalists
				set_federation_law = allow_subjects_to_join_yes_imperial_loyalists
			}
		} 
		else = {
			join_alliance = {
				who = root
				name = "Name_DEFNECE"
				override_requirements = yes
			}
			set_federation_leader = root
			every_playable_country = {
				limit = { has_federation = no }
				join_alliance = { who = root override_requirements = yes }
			}
			federation = {
				add_cohesion = 200
				add_federation_experience = 1000
				set_federation_flag = galactic_alliance_for_kuat
				set_federation_type = imperial_loyalists_federation
				set_federation_law = centralization_imperial_loyalists
				set_federation_law = succession_type_none
				set_federation_law = succession_term_perpetual
				set_federation_law = fleet_contribution_none
				set_federation_law = treaties_separate_no_imperial_loyalists
				set_federation_law = declare_war_president_vote_imperial_loyalists
				set_federation_law = invite_members_president_vote_imperial_loyalists
				set_federation_law = kick_members_president_vote_imperial_loyalists
				set_federation_law = vote_weight_diplomatic_imperial_loyalists
				set_federation_law = allow_subjects_to_join_yes_imperial_loyalists
			}
		}
		set_update_modifiers_batch = end
		country_event = { id = exe_kuat_return.13 }
	}
}

country_event = {
	id = exe_kuat_return.13
	hide_window = no
	title = "exe_kuat_return.13.title"
	desc = "exe_kuat_return.13.desc"
	diplomatic = yes
	picture_event_data = { room = Eternal_Empire2_room }
	custom_gui = "kuat_event_m_window"
	custom_gui_option = "kuat_event_m_option"
	fire_only_once = yes
	is_triggered_only = yes
	trigger = {
		has_global_flag = fire_the_kuat_return
		NOT = { has_global_flag = fire_facility_return }
	}
	option = {
		name = "exe_kuat_return.13.a"
		custom_tooltip = "exe_kuat_return.13.a.tooltip"
		hidden_effect = {
			save_global_event_target_as = kuat_Annihilate_country
			set_country_flag = kuat_Annihilate_country
			declare_war = {
				target = event_target:return_kuat_awakening_country
				name = "Galactic Civil War"
				attacker_war_goal = Kuat_total_war
			}
			event_target:return_kuat_awakening_country = {
				country_event = { id = exe_kuat_return.14 days = 45 }
				country_event = { id = exe_kuat_return.14 days = 90 }
				country_event = { id = exe_kuat_return.18 days = 180 }
			}
		}
	}
}

#独自面对
country_event = {
	id = exe_kuat_return.17
	hide_window = no
	title = "exe_kuat_return.17.title"
	desc = "exe_kuat_return.17.desc"
	diplomatic = yes
	picture_event_data = { room = Eternal_Empire2_room }
	custom_gui = "kuat_event_m_window"
	custom_gui_option = "kuat_event_m_option"
	fire_only_once = yes
	is_triggered_only = yes
	trigger = {
		has_global_flag = fire_the_kuat_return
		NOT = { has_global_flag = fire_facility_return }
	}
	option = {
		name = "exe_kuat_return.13.a"
		custom_tooltip = "exe_kuat_return.13.a.tooltip"
		hidden_effect = {
			save_global_event_target_as = kuat_Annihilate_country
			set_country_flag = kuat_Annihilate_country
			declare_war = {
				target = event_target:return_kuat_awakening_country
				name = "Galactic Civil War"
				attacker_war_goal = Kuat_total_war
			}
			event_target:return_kuat_awakening_country = {
				country_event = { id = exe_kuat_return.14 days = 60 }
				country_event = { id = exe_kuat_return.14 days = 120 }
				country_event = { id = exe_kuat_return.18 days = 180 }
			}
		}
	}
}

#战争补船
country_event = {
	id = exe_kuat_return.14
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_global_flag = fire_the_kuat_return
		NOT = { has_global_flag = fire_facility_return }
		is_at_war = yes
		is_country_type = kuat_awakened_returned_empire
	}
	immediate = { create_kuat_return_fleet_attacker = yes }
}

country_event = {
	id = exe_kuat_return.18
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		is_country_type = kuat_awakened_returned_empire
		is_at_war = yes
		has_global_flag = fire_the_kuat_return
		NOT = { has_global_flag = fire_facility_return }
	}
	immediate = {
		if = {
			limit = { num_ships > 360 }
			country_event = { id = exe_kuat_return.18 days = 120 random = 240 }
		} else = {
			create_kuat_return_fleet_attacker = yes
			country_event = { id = exe_kuat_return.18 days = 120 random = 240 }
		}
	}
}

#击败复兴夸特
country_event = {
	id = exe_kuat_return.15
	hide_window = yes
	is_triggered_only = yes
	trigger = { 
		if = {
			limit = { has_global_flag = has_origin_eternalthrone }
			has_global_flag = enable_attack_facility_Area
			is_country_type = kuat_awakened_returned_empire
		}
		else = { is_country_type = kuat_awakened_returned_empire }
	}
	immediate = {
		every_country = {
			limit = { is_ai = no }
			country_event = { id = exe_kuat_return.16 }
		}
		if = {
			limit = { has_federation = yes }
			federation = { every_member = { leave_alliance = { override_requirements = yes } } }
		}
		clear_global_event_target = kuat_Annihilate_country
		remove_country_flag = kuat_Annihilate_country
	}
}

country_event = {
	id = exe_kuat_return.16
	hide_window = no
	is_triggered_only = yes
	title = "exe_kuat_return.16.title"
	desc = {
		trigger = { kuat_is_enable_shadow_origin = yes }
		text = "exe_kuat_return.16.desc"
	}
	desc = {
		trigger = { has_origin = origin_eternalthrone }
		text = "kuat_facility_return_invasion.27.desc"
	}
	diplomatic = yes
	picture_event_data = { room = galactic_community_room }
	custom_gui = "kuat_event_m_window"
	custom_gui_option = "kuat_event_m_option"
	immediate = { set_global_flag = winer_gamer_kuat }
	option = {
		name = "exe_kuat_return.16.a"
		tooltip = { win = yes }
		hidden_effect = {
			win = yes
			if = {
				limit = { kuat_is_enable_shadow_origin = yes }
				if = {
					limit = { has_federation = yes }
					federation = { every_member = { leave_alliance = { override_requirements = yes } } }
					every_war = { end_war_effect = yes }
				}
				country_event = { id = exe_kuat_return.161 days = 30 }
			}
			if = {
				limit = { has_country_flag = eternal_fleet_ennded_A }
				country_event = { id = kuat_facility_return_invasion.23 days = 2 random = 2 }
			}
			else_if = {
				limit = { has_country_flag = eternal_fleet_ennded_B }
				country_event = { id = kuat_facility_return_invasion.25 days = 2 random = 2 }
			}
		}
	}
	option = {
		name = "exe_kuat_return.16.b"
		trigger = { has_global_flag = finish_five_stage_legacy_kuat kuat_is_enable_shadow_origin = yes }
		hidden_effect = {
			if = {
				limit = { has_federation = yes }
				federation = { every_member = { leave_alliance = { override_requirements = yes } } }
				every_war = { end_war_effect = yes }
			}
			every_system = {
				limit = { kuat_is_kuat_system = yes }
				every_system_planet = {
					limit = { is_planet_class = pc_gaia }
					change_pc = pc_broken
				}
			}
			set_global_flag = special_exe_invasion
			set_timed_global_flag = { flag = fire_the_research_pain days = 60 }
			country_event = { id = exe_kuat_return.19 days = 30 }
		}
	}
}

#中继站激活
country_event = {
	id = exe_kuat_return.161
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		remove_global_flag = exe_invasion_ended
		remove_global_flag = exe_invasion_begin
		remove_global_flag = can_win_the_fleet
		country_event = { id = exe_kuat_return.162 days = 30 }
	}
}

country_event = {
	id = exe_kuat_return.162
	title = "exe_kuat_return.162.title"
	desc = {
		trigger = { has_country_flag = fire_once_contact }
		text = "exe_kuat_return.162.fdesc"
	}
	desc = {
		trigger = { NOT = { has_country_flag = fire_once_contact } }
		text = "exe_kuat_return.162.desc"
	}
	diplomatic = yes
	picture_event_data = {
		portrait = event_target:kuat_player_target_species
		room = kuat_mega_shipyard_room
	}
	custom_gui = "kuat_event_diplomacy_window"
	custom_gui_option = "kuat_event_diplomacy_option"
	show_sound = event_wind_ruins
	is_triggered_only = yes
	option = { 
		name = exe_kuat_return.162.a 
		is_dialog_only = yes
		hidden_effect = { set_country_flag = fire_once_contact }
		response_text = exe_kuat_return.162.a.resp 
	}
	option = { 
		name = exe_kuat_return.162.b 
		is_dialog_only = yes
		hidden_effect = { set_country_flag = fire_once_contact }
		response_text = exe_kuat_return.162.b.resp 
	}
	#你们为什么阴魂不散
	option = { 
		name = exe_kuat_return.162.c 
		is_dialog_only = yes
		hidden_effect = { set_country_flag = fire_once_contact }
		response_text = exe_kuat_return.162.c.resp 
	}
	#你们究竟要做什么
	option = { 
		name = exe_kuat_return.162.d 
		is_dialog_only = yes
		hidden_effect = { set_country_flag = fire_once_contact }
		response_text = exe_kuat_return.162.d.resp 
	}
	#我们会记住这一切的
	option = { 
		name = exe_kuat_return.162.e
		response_text = exe_kuat_return.162.e.resp 
		play_sound = swfo_starkillerbase_fire
		hidden_effect = { country_event = { id = exe_kuat_return.163 days = 1 } }
	}
}

country_event = {
	id = exe_kuat_return.163
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		every_playable_country = {
			limit = {
				is_ai = no
				NOT = { is_same_value = root }
			}
			country_event = { id = crisis.6051 }
		}
		event_target:eternal_fleet_country = {
			set_global_flag = exe_invasion_ended
			set_global_flag = can_win_the_fleet
			destroy_country = yes
		}
		set_update_modifiers_batch = begin
		every_system = { destroy_star_system = yes }
		set_update_modifiers_batch = end
	}
}

country_event = {
	id = exe_kuat_return.19
	is_triggered_only = yes
	hide_window = no
	title = "exe_kuat_return.19.title"
	desc = "exe_kuat_return.19.desc"
	diplomatic = yes
	picture_event_data = { room = clocks_room }
	custom_gui = "kuat_event_window"
	custom_gui_option = "kuat_event_option"
	trigger = { has_global_flag = fire_the_research_pain }
	immediate = {
		every_system = {
			limit = { kuat_is_kuat_system = yes }
			every_system_planet = {
				limit = {
					is_star = no
					NOR = {
						is_planet_class = pc_gaia
						is_planet_class = pc_ringworld_habitable
						is_planet_class = pc_ringworld_seam
						is_planet_class = pc_ringworld_tech
						is_planet_class = pc_ringworld_habitable_damaged
						is_planet_class = pc_ringworld_seam_damaged
						is_planet_class = pc_ringworld_tech_damaged
						is_planet_class = pc_ringworld_shielded
					}
				}
				enable_special_project = {
					name = exe_return_kuat_recover_planet
					location = THIS
					owner = root
				}
				set_planet_flag = recover_begin
			}
			set_star_flag = recover_system
		}
	}
	option = { name = "exe_kuat_return.19.a" }
}

ship_event = {
	id = exe_kuat_return.20
	is_triggered_only = yes
	hide_window = no
	title = "exe_kuat_return.20.title"
	desc = "exe_kuat_return.20.desc"
	diplomatic = yes
	picture_event_data = { room = metropolis_room }
	custom_gui = "kuat_event_m_window"
	custom_gui_option = "kuat_event_m_option"
	immediate = {
		owner = { change_variable = { which = finish_recover value = 1 } }
		solar_system = {
			every_system_planet = {
				if = {
					limit = { has_planet_flag = recover_begin }
					change_pc = pc_gaia
					remove_planet_flag = recover_begin
				}
			}
			if = {
				limit = { NOT = { exists = starbase } }
				create_starbase = {
					size = starbase_citadel
					owner = root.owner
					module = "gun_battery"
					module = "gun_battery"
					module = "gun_battery"
					module = "gun_battery"
					module = "gun_battery"
					module = "gun_battery"
				}
			} else = { starbase = { set_owner = root.owner } }
			remove_star_flag = recover_system
		}
	}
	option = {
		name = "exe_kuat_return.20.a"
		hidden_effect = { owner = { if = {
			limit = { check_variable = { which = finish_recover value = 4 } }
			country_event = { id = exe_kuat_return.21 }
		} } }
	}
}

country_event = {
	id = exe_kuat_return.21
	is_triggered_only = yes
	title = "exe_kuat_return.21.title"
	desc = "exe_kuat_return.21.desc"
	diplomatic = yes
	picture_event_data = { room = gaia_planet_room }
	custom_gui = "kuat_event_m_window"
	custom_gui_option = "kuat_event_m_option"
	trigger = { check_variable = { which = finish_recover value = 4 } }
	option = {
		name = "exe_kuat_return.21.a"
		hidden_effect = { every_system_within_border = {
			limit = { kuat_is_kuat_system = yes }
			random_system_planet = {
				limit = { is_planet_class = pc_gaia }
				create_archaeological_site = kuat_lagacy_6
			}
		} }
	}
}

fleet_event = {
	id = exe_kuat_return.22
	hide_window = no
	title = "exe_kuat_return.22.title"
	desc = "exe_kuat_return.22.desc"
	show_sound = event_wind_ruins
	picture = GFX_evt_mining_operations
	is_triggered_only = yes
	archaeology = yes
	immediate = { from = { set_site_progress_locked = yes } }

	after = { from = { set_site_progress_locked = no } }
	
	option = { name = exe_kuat_return.22.a }
}

fleet_event = {
	id = exe_kuat_return.23
	hide_window = no
	title = "exe_kuat_return.23.title"
	desc = "exe_kuat_return.23.desc"
	show_sound = event_wind_ruins
	picture = GFX_evt_hidden_door
	is_triggered_only = yes
	archaeology = yes
	immediate = { from = { set_site_progress_locked = yes } }

	after = { from = { set_site_progress_locked = no } }
	
	option = {
		name =exe_kuat_return.23.a
		small_artifact_reward = yes
	}
}

fleet_event = {
	id = exe_kuat_return.24
	hide_window = no
	title = "exe_kuat_return.24.title"
	desc = "exe_kuat_return.24.desc"
	show_sound = event_wind_ruins
	picture = GFX_evt_huge_monument
	is_triggered_only = yes
	archaeology = yes
	immediate = { from = { set_site_progress_locked = yes } }

	after = { from = { set_site_progress_locked = no } }
	
	option = {
		name = exe_kuat_return.24.a
		medium_artifact_reward = yes
	}
}

fleet_event = {
	id = exe_kuat_return.25
	hide_window = no
	title = "exe_kuat_return.25.title"
	desc = "exe_kuat_return.25.desc"
	show_sound = event_wind_ruins
	picture = GFX_evt_habitable_dig_site
	is_triggered_only = yes
	archaeology = yes
	immediate = { from = { set_site_progress_locked = yes } }

	after = { from = { set_site_progress_locked = no } }
	
	option = {
		name = exe_kuat_return.25.a
		large_artifact_reward = yes
	}
}

fleet_event = {
	id = exe_kuat_return.26
	hide_window = no
	title = "exe_kuat_return.26.title"
	desc = "exe_kuat_return.26.desc"
	show_sound = event_wind_ruins
	picture = GFX_evt_strategic_coordination_center
	is_triggered_only = yes
	archaeology = yes
	immediate = { from = { set_site_progress_locked = yes } }

	after = { from = { set_site_progress_locked = no } }
	
	option = {
		name = exe_kuat_return.26.a
		large_artifact_reward = yes
		hidden_effect = {
			owner = { country_event = { id = exe_kuat_return.27 days = 30 } }
			leader = { save_global_event_target_as = dig_scientist }
		}
	}
}

country_event = {
	id = exe_kuat_return.27
	hide_window = no
	title = "exe_kuat_return.27.title"
	desc = "exe_kuat_return.27.desc"
	is_triggered_only = yes
	diplomatic = yes
	picture_event_data = {
		room = engineering_research_room
	}
	custom_gui = "kuat_event_window"
	custom_gui_option = "kuat_event_option"
	immediate = { set_global_flag = final_stage }
	option = {
		name = exe_kuat_return.27.a
		hidden_effect = { random_list = {
			5 = {
				if = {
					limit = { is_multiplayer = yes }
					every_playable_country = {
						limit = { is_ai = no }
						give_technology = { tech = tech_eternal_fleet }
						country_event = { id = exe_kuat_return.28 }
					}
				}
				else = {
					give_technology = { tech = tech_eternal_fleet }
					country_event = { id = exe_kuat_return.28 }
				}
			}
			5 = { win = yes country_event = { id = exe_kuat_return.161 days = 30 } }
		} }
	}
	option = {
		name = exe_kuat_return.27.b
		hidden_effect = {
			event_target:dig_scientist = { kill_leader = { show_notification = yes } }
			if = {
				limit = { is_multiplayer = yes }
				every_playable_country = {
					limit = { is_ai = no }
					give_technology = { tech = tech_eternal_fleet }
					country_event = { id = exe_kuat_return.28 }
				}
			}
			else = {
				give_technology = { tech = tech_eternal_fleet }
				country_event = { id = exe_kuat_return.28 }
			}
		}
	}
}

country_event = {
	id = exe_kuat_return.28
	hide_window = no
	is_triggered_only = yes
	title = "exe_kuat_return.28.title"
	desc = "exe_kuat_return.28.desc"
	picture_event_data = {
		room = kuat_council_fleet_room
	}
	show_sound = event_mystic_reveal
	diplomatic = yes
	custom_gui = "kuat_event_m_window"
	custom_gui_option = "kuat_event_m_option"
	immediate = {
		create_ship_design = { design = Name_boss_Venganza }
		add_ship_design = last_created_design
		create_ship_design = { design = Name_boss_Dominance }
		add_ship_design = last_created_design
	}
	option = {
		name = "exe_kuat_return.28.a"
		hidden_effect = {
			enable_special_project = {
				name = exe_return_kuat_reload_exe_invasion
				location = this.capital_star
				owner = root
			}
		}
		custom_tooltip = "exe_kuat_return.28.begin_tooltip"
	}
	option = {
		name = "exe_kuat_return.28.b"
		custom_tooltip = "exe_kuat_return.28.ban_tooltip"
		tooltip = { win = yes }
		hidden_effect = { win = yes country_event = { id = exe_kuat_return.161 days = 30 } }
	}
}

ship_event = {
	id = exe_kuat_return.29
	title = "exe_kuat_return.29.title"
	desc = "exe_kuat_return.29.desc"
	diplomatic = yes
	picture_event_data = {
		room = clones_room
	}
	custom_gui = "kuat_event_m_window"
	custom_gui_option = "kuat_event_m_option"
	show_sound = event_mystic_reveal
	is_triggered_only = yes

	option = {
		name = exe_kuat_return.29.a
		owner = { country_event = { id = exe_kuat_return.30 } }
	}
}

country_event = {
	id = exe_kuat_return.30
	is_triggered_only = yes
	hide_window = no
	title = exe_kuat_return.30.title
	desc = {
		trigger = { has_global_flag = will_be_upgrade_starforge }
		text = exe_kuat_return.30.response
	}
	desc = {
		trigger = { NOT = { has_global_flag = will_be_upgrade_starforge } }
		text = exe_kuat_return.30.desc
	}
	diplomatic = yes
	diplomatic_title = exe_kuat_return.30.title
	picture_event_data = { room = no_video_feed_room }
	custom_gui = "kuat_event_diplomacy_window"
	custom_gui_option = "kuat_event_diplomacy_option"
	option = {
		name = exe_kuat_return.30.c
		trigger = { NOT = { has_global_flag = will_be_upgrade_starforge } }
		hidden_effect = { 
			remove_global_flag = special_exe_invasion
			set_global_flag = will_be_upgrade_starforge 
			country_event = { id = exe_kuat_return.30 }
		}
	}
	option = {
		name = {
			trigger = { NOT = { has_global_flag = will_be_upgrade_starforge } }
			text = exe_kuat_return.30.a
		}
		name = {
			trigger = { has_global_flag = will_be_upgrade_starforge }
			text = exe_kuat_return.30.b
		}
		hidden_effect = {
			if = {
				limit = { NOT = { has_global_flag = will_be_upgrade_starforge } }
				remove_global_flag = exe_invasion_ended
				remove_global_flag = exe_invasion_begin
				remove_global_flag = can_win_the_fleet
				set_global_flag = exe_second_invasion_begin
			}
		}
	}
}


namespace = kuat_facility_return_invasion
#阶段一
event = {
	id = kuat_facility_return_invasion.1
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		NOT = { has_global_flag = fire_the_kuat_return }
		has_global_flag = fire_facility_return
		NOT = { has_global_flag = exe_kuat_return_seed }
	}
	immediate = {
		set_global_flag = exe_kuat_return_seed
		set_timed_global_flag = {
			flag = exe_invasion_signs_kuat_return_cooldown
			days = 360
		}
		every_playable_country = { country_event = { id = kuat_facility_return_invasion.2 days = 1 random = 2 } }
	}
}

country_event = {
	id = kuat_facility_return_invasion.2
	title = "kuat_facility_return_invasion.2.name"
	desc = "kuat_facility_return_invasion.2.desc"
	diplomatic = yes
	picture_event_data = { room = satellite_in_orbit_room }
	custom_gui = "kuat_event_m_window"
	custom_gui_option = "kuat_event_m_option"
	show_sound = event_sensor_ping
	location = root.capital_scope
	is_triggered_only = yes
	option = { name = "kuat_facility_return_invasion.2.a" }
}

#阶段二(星域变动）
event = {
	id = kuat_facility_return_invasion.3
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		NOT = { has_global_flag = fire_the_kuat_return }
		has_global_flag = fire_facility_return
		has_global_flag = exe_kuat_return_seed
		NOR = {
			has_global_flag = exe_kuat_return_2_fired
			has_global_flag = exe_invasion_signs_kuat_return_cooldown
		}
	}
	immediate = {
		set_global_flag = exe_kuat_return_2_fired
		set_timed_global_flag = {
			flag = exe_invasion_signs_kuat_return_cooldown
			days = 360
		}
		set_spawn_system_batch = begin
		kuat_spawn_origin_system_initial_all = yes
		set_spawn_system_batch = end
		every_playable_country = { country_event = { id = kuat_facility_return_invasion.4 days = 1 random = 2 } }
	}
}

country_event = {
	id = kuat_facility_return_invasion.4
	title = "kuat_facility_return_invasion.4.name"
	desc = "kuat_facility_return_invasion.4.desc"
	diplomatic = yes
	picture_event_data = { room = Eternal_Empire2_room }
	custom_gui = "kuat_event_m_window"
	custom_gui_option = "kuat_event_m_option"
	show_sound = event_yellow_alert
	location = root.capital_scope
	is_triggered_only = yes
	option = { name = "kuat_facility_return_invasion.4.a" }
}

#阶段三(监管者创建）
event = {
	id = kuat_facility_return_invasion.5
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		NOT = { has_global_flag = fire_the_kuat_return }
		has_global_flag = fire_facility_return
		has_global_flag = exe_kuat_return_2_fired
		NOR = {
			has_global_flag = exe_invasion_signs_kuat_return_cooldown
			has_global_flag = exe_kuat_return_3_fired
		}
	}
	immediate = {
		set_global_flag = exe_kuat_return_3_fired
		set_timed_global_flag = { flag = exe_invasion_signs_kuat_return_cooldown days = 20 }
		every_playable_country = { country_event = { id = kuat_facility_return_invasion.6 days = 2 } }
		random_country = {
			limit = { is_ai = no }
			country_event = { id = kuat_facility_return_invasion.61 days = 1 }
		}
	}
}

country_event = {
	id = kuat_facility_return_invasion.61
	hide_window = yes
	fire_only_once = yes
	is_triggered_only = yes
	immediate = {
		set_update_modifiers_batch = begin
		#国家
		create_country = {
			name = "Name_Kuat_Fire_base"
			species = event_target:kuat_player_target_species
			name_list = "MAM3"
			type = kuat_awakened_returned_empire
			flag = {
				icon = {
					category = "Kuat"
					file = "flag_swsit_1.dds"
				}
				background = {
					category = "backgrounds"
					file = "00_solid.dds"
				}
				colors = { "red" "red" "null" "null" }
			}
			ignore_initial_colony_error = yes
			authority = auth_imperial
			civics = {
				civic = civic_revanchist_fervor_kuat
				civic = civic_ancient_caches_of_technology_kuat
			}
			origin = "origin_fallen_empire"
			ethos = { ethic = ethic_fanatic_materialist }
			effect = {
				save_global_event_target_as = return_kuat_awakening_country
				set_graphical_culture = fallen_empire_kuat_01
				set_country_flag = return_fallen_empire_kuat
				# must initialize global designs here
				add_global_ship_design = "NAME_Enforcer"
				add_global_ship_design = "NAME_Savant"
				add_global_ship_design = "NAME_Scholar"
				add_global_ship_design = "NAME_Sage"
				add_global_ship_design = "NAME_Cloaker"
				add_global_ship_design = "NAME_Librarian"
				add_global_ship_design = "NAME_Seeker"
				add_global_ship_design = "NAME_FE_Starbase"
				add_global_ship_design = "Name_boss_crisis_EMPIRE_0"
				add_global_ship_design = "Name_boss_crisis_Venganza_0"
				add_global_ship_design = "Name_boss_CRISIS_Dominance_0"
				add_global_ship_design = "Name_criss_boss_Horriwer_0"
				add_global_ship_design = "Name_boss_eclipse"
				create_ship_design = { design = "NAME_KUAT_Starbase" }
				add_ship_design = last_created_design
				add_modifier = { modifier = awaken_ship }
				create_kuat_return_starbase = yes
			}
		}
		#殖民
		every_system = {
			limit = { kuat_is_kuat_system = yes }
			every_system_planet = {
				if = {
					limit = { is_colonizable = yes }
					set_controller = event_target:return_kuat_awakening_country
					set_owner = event_target:return_kuat_awakening_country
					create_pop = { species = event_target:return_kuat_awakening_country.owner_main_species }
					add_district = district_city
				}
				if = {
					limit = {
						is_star = no
						is_asteroid = no
						is_ringworld = no
						NOR = {
							has_planet_flag = has_megastructure
							is_planet_class = pc_gaia
							is_planet_class = pc_ringworld_habitable
							is_planet_class = pc_ringworld_seam
							is_planet_class = pc_ringworld_tech
							is_planet_class = pc_ringworld_habitable_damaged
							is_planet_class = pc_ringworld_seam_damaged
							is_planet_class = pc_ringworld_tech_damaged
							is_planet_class = pc_ringworld_shielded
						}
					}
					change_pc = pc_gaia
					set_controller = event_target:return_kuat_awakening_country
					set_owner = event_target:return_kuat_awakening_country
					create_pop = { species = event_target:return_kuat_awakening_country.owner_main_species }
					add_district = district_city
				}
			}
			every_fleet_in_system = {
				limit = { exists = owner NOT = { owner = { is_same_value = event_target:return_kuat_awakening_country } } }
				destroy_fleet = { target = this destroy_template = yes kill_leader = yes }
			}
		}
		set_update_modifiers_batch = end
	}
}

country_event = {
	id = kuat_facility_return_invasion.6
	title = "kuat_facility_return_invasion.6.name"
	desc = "kuat_facility_return_invasion.6.desc"
	diplomatic = yes
	picture_event_data = { room = fallen_empire_awakes_room }
	custom_gui = "kuat_event_m_window"
	custom_gui_option = "kuat_event_m_option"
	show_sound = event_yellow_alert
	location = root.capital_scope
	is_triggered_only = yes
	immediate = { establish_communications_no_message = event_target:return_kuat_awakening_country }
	option = { name = "kuat_facility_return_invasion.6.a" }
}

#阶段四(监管者军事力量关闭星门）
event = {
	id = kuat_facility_return_invasion.7
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		NOT = { has_global_flag = fire_the_kuat_return }
		has_global_flag = fire_facility_return
		has_global_flag = exe_kuat_return_3_fired
		NOR = {
			has_global_flag = exe_invasion_signs_kuat_return_cooldown
			has_global_flag = exe_kuat_return_4_fired
		}
	}
	immediate = {
		set_global_flag = disable_kuat_by_passed
		set_global_flag = exe_kuat_return_4_fired
		set_timed_global_flag = {
			flag = exe_invasion_signs_kuat_return_cooldown
			days = 10
		}
		every_megastructure = {
			limit = { is_megastructure_type = exe_outer_gate_disable }
			upgrade_megastructure_to = exe_outer_gate
			finish_upgrade = yes
		}
		every_megastructure = {
			limit = { is_megastructure_type = exe_outer_gate }
			activate_gateway = this
		}
		every_playable_country = { country_event = { id = kuat_facility_return_invasion.8 days = 2 } }
		random_country = {
			limit = { is_ai = no }
			country_event = { id = kuat_facility_return_invasion.81 days = 1 }
		}
	}
}

country_event = {
	id = kuat_facility_return_invasion.81
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes
	trigger = {
		NOT = { has_global_flag = fire_the_kuat_return }
		has_global_flag = fire_facility_return
	}
	immediate = {
		event_target:return_kuat_awakening_country = { create_kuat_return_fleet_defender = yes }
		remove_country_flag = can_pass_by 
		remove_country_flag = can_pass_inner_by
	}
}

country_event = {
	id = kuat_facility_return_invasion.8
	hide_window = no
	diplomatic = yes
	title = "kuat_facility_return_invasion.8.title"
	desc = "kuat_facility_return_invasion.8.desc"
	custom_gui = "kuat_event_diplomacy_window"
	custom_gui_option = "kuat_event_diplomacy_option"
	picture_event_data = {
		city_level = event_target:return_kuat_awakening_country
		portrait = event_target:return_kuat_awakening_country
		room = event_target:return_kuat_awakening_country.ruler
		planet_background = event_target:return_kuat_awakening_country
		graphical_culture = event_target:return_kuat_awakening_country
	}
	is_triggered_only = yes
	#你们怎么阴魂不散
	option = { 
		name = "kuat_facility_return_invasion.8.a" 
		is_dialog_only = yes
		response_text = "kuat_facility_return_invasion.8.a.response"
	}
	#你们才是这个银河的毒瘤
	option = { 
		name = "kuat_facility_return_invasion.8.b" 
		response_text = "kuat_facility_return_invasion.8.b.response"
	}
}

#阶段五（重启星门）
event = {
	id = kuat_facility_return_invasion.9
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		NOT = { has_global_flag = fire_the_kuat_return }
		has_global_flag = fire_facility_return
		has_global_flag = exe_kuat_return_4_fired
		NOR = {
			has_global_flag = exe_invasion_signs_kuat_return_cooldown
			has_global_flag = exe_kuat_return_5_fired
		}
	}
	immediate = {
		set_global_flag = exe_kuat_return_5_fired
		set_timed_global_flag = {
			flag = exe_invasion_signs_kuat_return_cooldown
			days = 10
		}
		every_playable_country = { country_event = { id = kuat_facility_return_invasion.10 days = 2 random = 2 } }
	}
}

country_event = {
	id = kuat_facility_return_invasion.10
	hide_window = no
	is_triggered_only = yes
	title = "kuat_facility_return_invasion.10.title"
	desc = "kuat_facility_return_invasion.10.desc"
	diplomatic = yes
	picture_event_data = { room = l-gateway_room }
	custom_gui = "kuat_event_m_window"
	custom_gui_option = "kuat_event_m_option"
	trigger = {
		NOT = { has_global_flag = fire_the_kuat_return }
		has_global_flag = fire_facility_return
	}
	immediate = { 
		remove_country_flag = can_pass_by 
		remove_country_flag = can_pass_inner_by
		every_system = {
			limit = { kuat_is_kuat_system = yes }
			isolate_system = yes
		}
	}
	option = { name = "kuat_facility_return_invasion.10.a" }
}

#泛银河同盟
event = {
	id = kuat_facility_return_invasion.11
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		NOT = { has_global_flag = fire_the_kuat_return }
		has_global_flag = fire_facility_return
		has_global_flag = exe_kuat_return_5_fired
		NOR = {
			has_global_flag = exe_invasion_signs_kuat_return_cooldown
			has_global_flag = exe_kuat_return_6_fired
		}
	}
	immediate = {
		set_global_flag = exe_kuat_return_6_fired
		every_playable_country = {
			limit = { is_ai = no }
			country_event = { id = kuat_facility_return_invasion.12 days = 2 }
		}
	}
}

country_event = {
	id = kuat_facility_return_invasion.12
	hide_window = no
	title = "kuat_facility_return_invasion.12.title"
	desc = "kuat_facility_return_invasion.12.desc"
	diplomatic = yes
	picture_event_data = { room = galactic_community_room }
	custom_gui = "kuat_event_window"
	custom_gui_option = "kuat_event_option"
	fire_only_once = yes
	is_triggered_only = yes
	trigger = {
		NOT = { has_global_flag = fire_the_kuat_return }
		has_global_flag = fire_facility_return
		any_country = { is_country_type = kuat_awakened_returned_empire }
		has_global_flag = exe_kuat_return_6_fired
	}
	immediate = { save_global_event_target_as = player_declare_warer }
	#建立同盟
	option = {
		name = "exe_kuat_return.12.a"
		set_global_flag = build_the_galaxy_guardiance_alliance
		hidden_effect = { country_event = { id = kuat_facility_return_invasion.15 days = 30 } }
	}
}

#玩家建立
country_event = {
	id = kuat_facility_return_invasion.15
	fire_only_once = yes
	hide_window = yes
	is_triggered_only = yes
	trigger = { 
		has_global_flag = build_the_galaxy_guardiance_alliance 
		NOT = { has_global_flag = fire_the_kuat_return }
		has_global_flag = fire_facility_return
	}
	immediate = {
		set_update_modifiers_batch = begin
		if = {
			limit = { has_federation = yes }
			set_federation_leader = root
			every_playable_country = {
				limit = { is_subject = yes overlord = { is_same_value = root } }
				join_alliance = { who = root override_requirements = yes }
			}
			federation = {
				set_name = "Name_DEFNECE"
				add_cohesion = 200
				add_federation_experience = 1000
				set_federation_flag = galactic_alliance_for_kuat
				set_federation_type = imperial_loyalists_federation
				set_federation_law = centralization_imperial_loyalists
				set_federation_law = succession_type_none
				set_federation_law = succession_term_perpetual
				set_federation_law = fleet_contribution_none
				set_federation_law = treaties_separate_no_imperial_loyalists
				set_federation_law = declare_war_president_vote_imperial_loyalists
				set_federation_law = invite_members_president_vote_imperial_loyalists
				set_federation_law = kick_members_president_vote_imperial_loyalists
				set_federation_law = vote_weight_diplomatic_imperial_loyalists
				set_federation_law = allow_subjects_to_join_yes_imperial_loyalists
			}
		} 
		else = {
			join_alliance = {
				who = root
				name = "Name_DEFNECE"
				override_requirements = yes
			}
			set_federation_leader = root
			every_playable_country = {
				limit = { is_subject = yes overlord = { is_same_value = root } }
				join_alliance = { who = root override_requirements = yes }
			}
			federation = {
				add_cohesion = 200
				add_federation_experience = 1000
				set_federation_flag = galactic_alliance_for_kuat
				set_federation_type = imperial_loyalists_federation
				set_federation_law = centralization_imperial_loyalists
				set_federation_law = succession_type_none
				set_federation_law = succession_term_perpetual
				set_federation_law = fleet_contribution_none
				set_federation_law = treaties_separate_no_imperial_loyalists
				set_federation_law = declare_war_president_vote_imperial_loyalists
				set_federation_law = invite_members_president_vote_imperial_loyalists
				set_federation_law = kick_members_president_vote_imperial_loyalists
				set_federation_law = vote_weight_diplomatic_imperial_loyalists
				set_federation_law = allow_subjects_to_join_yes_imperial_loyalists
			}
		}
		set_update_modifiers_batch = end
		country_event = { id = kuat_facility_return_invasion.16 }
	}
}

country_event = {
	id = kuat_facility_return_invasion.16
	hide_window = no
	title = "kuat_facility_return_invasion.16.title"
	desc = "kuat_facility_return_invasion.16.desc"
	diplomatic = yes
	picture_event_data = { room = Eternal_Empire2_room }
	custom_gui = "kuat_event_m_window"
	custom_gui_option = "kuat_event_m_option"
	fire_only_once = yes
	is_triggered_only = yes
	trigger = {
		NOT = { has_global_flag = fire_the_kuat_return }
		has_global_flag = fire_facility_return
	}
	option = {
		name = "kuat_facility_return_invasion.16.a"
		hidden_effect = {
			save_global_event_target_as = kuat_Annihilate_country
			set_country_flag = kuat_Annihilate_country
			declare_war = {
				target = event_target:return_kuat_awakening_country
				name = "Galactic Civil War"
				attacker_war_goal = Kuat_total_war
			}
			event_target:return_kuat_awakening_country = {
				country_event = { id = kuat_facility_return_invasion.19 days = 180 }
			}
		}
	}
	immediate = { 
		event_target:global_event_country = { set_variable = { which = count_destroy_eternal_fleet value = 0 } }
		if = {
			limit = { has_global_flag = eternal_support_country_channal }
			event_target:global_event_country = { set_variable = { which = eternal_fleet_return_index value = 6 } }
		} 
		else_if = {
			limit = { has_global_flag = infinite_empire_channal }
			event_target:global_event_country = { set_variable = { which = eternal_fleet_return_index value = 7 } }
		}
		else = { event_target:global_event_country = { set_variable = { which = eternal_fleet_return_index value = 8 } } }
	}
	after = { country_event = { id = kuat_facility_return_invasion.20 days = 1 random = 2 } set_global_flag = exe_return_invasion_7_fired }
}

#战争补船
country_event = {
	id = kuat_facility_return_invasion.18
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		NOT = { has_global_flag = fire_the_kuat_return }
		has_global_flag = fire_facility_return
		is_at_war = yes
		is_country_type = kuat_awakened_returned_empire
	}
	immediate = { create_kuat_return_fleet_attacker = yes }
}

country_event = {
	id = kuat_facility_return_invasion.19
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		NOT = { has_global_flag = fire_the_kuat_return }
		has_global_flag = fire_facility_return
		is_country_type = kuat_awakened_returned_empire
		is_at_war = yes
	}
	immediate = {
		if = {
			limit = { OR = {
				count_owned_ship = {
					limit = { kuat_is_flagship_system_protection = yes }
					count > 32
				}
				exists = event_target:eternal_fleet_country
			} }
			country_event = { id = kuat_facility_return_invasion.19 days = 120 random = 240 }
		}
		else = {
			country_event = { id = kuat_facility_return_invasion.18 days = 1 random = 7 }
			country_event = { id = kuat_facility_return_invasion.19 days = 120 random = 240 }
		}
	}
}

# Eternal Systme Tale
country_event = {
	id = kuat_facility_return_invasion.20
	title = "kuat_facility_return_invasion.20.title"
	desc = "kuat_facility_return_invasion.20.desc"
	diplomatic = yes
	picture_event_data = {
		portrait = event_target:ETERNAL_LEADER
		room = Eternal_Empire_room
	}
	custom_gui = "kuat_event_diplomacy_window"
	custom_gui_option = "kuat_event_diplomacy_option"
	show_sound = event_wind_ruins
	is_triggered_only = yes
	trigger = { has_global_flag = eternal_support_country_channal }
	#What about the Eternal Fleet
	option = { 
		name = kuat_facility_return_invasion.20.a 
		is_dialog_only = yes
		response_text = kuat_facility_return_invasion.20.a.resp 
	}
	#Can you control them?
	option = { 
		name = kuat_facility_return_invasion.20.b 
		is_dialog_only = yes
		response_text = kuat_facility_return_invasion.20.b.resp 
	}
	#What can i do for you
	option = { 
		name = kuat_facility_return_invasion.20.c 
		is_dialog_only = yes
		response_text = kuat_facility_return_invasion.20.c.resp 
	}
	#We will A
	option = { 
		name = kuat_facility_return_invasion.20.d 
		response_text = kuat_facility_return_invasion.20.d.resp 
		hidden_effect = { set_country_flag = eternal_fleet_ennded_A }
	}
	#We will B
	option = { 
		name = kuat_facility_return_invasion.20.e 
		response_text = kuat_facility_return_invasion.20.e.resp 
		hidden_effect = { set_country_flag = eternal_fleet_ennded_B }
	}
}

country_event = {
	id = kuat_facility_return_invasion.21
	title = "kuat_facility_return_invasion.21.title"
	desc = "kuat_facility_return_invasion.21.desc"
	diplomatic = yes
	picture_event_data = {
		portrait = event_target:ETERNAL_LEADER
		room = Eternal_Empire_room
	}
	custom_gui = "kuat_event_diplomacy_window"
	custom_gui_option = "kuat_event_diplomacy_option"
	show_sound = event_wind_ruins
	is_triggered_only = yes
	trigger = { has_global_flag = eternal_support_country_channal }
	#Enable Gateway
	option = { 
		name = kuat_facility_return_invasion.21.a 
		is_dialog_only = yes
		response_text = kuat_facility_return_invasion.21.a.resp 
	}
	#Final fire
	option = { 
		name = kuat_facility_return_invasion.21.b 
		response_text = kuat_facility_return_invasion.21.b.resp 
	}
}

country_event = {
	id = kuat_facility_return_invasion.22
	title = "kuat_facility_return_invasion.22.title"
	desc = "kuat_facility_return_invasion.22.desc"
	diplomatic = yes
	picture_event_data = {
		portrait = event_target:ETERNAL_LEADER
		room = Eternal_Empire_room
	}
	custom_gui = "kuat_event_diplomacy_window"
	custom_gui_option = "kuat_event_diplomacy_option"
	show_sound = event_wind_ruins
	is_triggered_only = yes
	trigger = { has_global_flag = eternal_support_country_channal }
	#We will destroy all starbase
	option = { 
		name = kuat_facility_return_invasion.22.b 
		response_text = kuat_facility_return_invasion.22.b.resp 
	}
}

country_event = {
	id = kuat_facility_return_invasion.23
	title = "kuat_facility_return_invasion.23.title"
	desc = "kuat_facility_return_invasion.23.desc"
	diplomatic = yes
	picture_event_data = {
		portrait = event_target:ETERNAL_LEADER
		room = Eternal_Empire_room
	}
	custom_gui = "kuat_event_diplomacy_window"
	custom_gui_option = "kuat_event_diplomacy_option"
	show_sound = event_wind_ruins
	is_triggered_only = yes
	trigger = { has_global_flag = eternal_support_country_channal }
	#For ALL thing we need say good bye, for the future we will see again
	option = { 
		name = kuat_facility_return_invasion.23.b 
		response_text = kuat_facility_return_invasion.23.b.resp 
		hidden_effect = {
			if = {
				limit = { NOT = { has_existing_ship_design = Annihilator } }
				create_ship_design = { design = NAME_KUAT_Annihilator }
				add_ship_design = last_created_design
			}
			if = {
				limit = { NOT = { has_existing_ship_design = kuat_sector } }
				create_ship_design = { design = Name_boss_crisis_Sector_3 }
				add_ship_design = last_created_design
			}
		}
	}
	after = { event_target:eternal_support_country = { destroy_country = yes } }
}

country_event = {
	id = kuat_facility_return_invasion.24
	title = "kuat_facility_return_invasion.24.title"
	desc = "kuat_facility_return_invasion.24.desc"
	diplomatic = yes
	picture_event_data = { room = Eternal_Empire2_room }
	custom_gui = "kuat_event_m_window"
	custom_gui_option = "kuat_event_m_option"
	show_sound = event_wind_ruins
	is_triggered_only = yes
	trigger = { has_global_flag = eternal_support_country_channal }
	#Final fire
	option = { name = kuat_facility_return_invasion.24.a }
}

country_event = {
	id = kuat_facility_return_invasion.25
	title = "kuat_facility_return_invasion.25.title"
	desc = "kuat_facility_return_invasion.25.desc"
	diplomatic = yes
	picture_event_data = {
		portrait = event_target:ETERNAL_LEADER
		room = Eternal_Empire_room
	}
	custom_gui = "kuat_event_diplomacy_window"
	custom_gui_option = "kuat_event_diplomacy_option"
	show_sound = event_wind_ruins
	is_triggered_only = yes
	trigger = { has_global_flag = eternal_support_country_channal }
	#For ALL thing we need say good bye, for the future we will see again
	option = { 
		name = kuat_facility_return_invasion.25.b 
		is_dialog_only = yes
		response_text = kuat_facility_return_invasion.25.b.resp 
	}
	option = { 
		name = kuat_facility_return_invasion.25.a
		response_text = kuat_facility_return_invasion.25.a.resp 
		hidden_effect = { enable_special_project = {
			name = eternal_reroll_endedA_rountine
			location = root.capital_star owner = root
		} }
	}
	option = { 
		name = kuat_facility_return_invasion.25.c 
		response_text = kuat_facility_return_invasion.25.c.resp 
	}
}

country_event = {
	id = kuat_facility_return_invasion.26
	title = "kuat_facility_return_invasion.26.name"
	desc = "kuat_facility_return_invasion.26.desc"
	diplomatic = yes
	custom_gui = "kuat_event_m_window"
	custom_gui_option = "kuat_event_m_option"
	picture_event_data = { room = ancient_knowledge_room }
	show_sound = event_wind_ruins
	is_triggered_only = yes
	immediate = { 
		set_global_flag = eternal_ended_A_rountine
		event_target:zakuul_system = { create_elternal_origin_system_warbase = { LOCK = yes DAYS = -1 } }
		remove_global_flag = eternal_support_country_disabled
		clear_variable = eternal_kuat_invasion_fleet_num
	}
	option = { name = "kuat_facility_return_invasion.26.a" }
}