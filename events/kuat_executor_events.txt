namespace = executor_build

##########################
## START SYSTEM INITIAL ##
##########################
event = {
	id = executor_build.999
	hide_window = yes
	is_triggered_only = yes
	immediate = { set_global_flag = install_kuat_mod }
}

country_event = {
	id = executor_build.1
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes
	trigger = {
		is_ai = no
		NOR = { has_origin = origin_kuat_apocalyptic has_origin = origin_eternalthrone }
	}
	immediate = {
		set_country_flag = executorbuilding
		random_system = {
			limit = {
				has_owner = no
				distance = {
					source = root.capital_scope
					type = euclidean
					min_distance >= 50
					max_distance <= 100
				}
				kuat_is_create_system = no
			}
			spawn_megastructure = {
				type = exe_outer_gate_disable
				orbit_angle = 225
				orbit_distance = 200
				planet = system_star
				init_effect = { save_global_event_target_as = exe_outer_gate_disable }
			}
			while = { count = 15 create_ambient_object = { type = "large_debris_object" location = solar_system } }
			while = { count = 10 create_ambient_object = { type = "medium_debris_01_object" location = solar_system } }
			while = { count = 20 create_ambient_object = { type = "medium_debris_02_object" location = solar_system } }
			while = { count = 30 create_ambient_object = { type = "small_debris_object" location = solar_system } }
			set_star_flag = ag_exe_invasion_gate_system set_star_flag = exe_outer_gate_disable_system
		}
	}
}

country_event = {
	id = executor_build.8
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		is_ai = yes
		OR = { has_origin = origin_kuat_apocalyptic has_origin = origin_eternalthrone }
	}
	immediate = { set_origin = origin_default }
}

event = {
	id = executor_build.22
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes
	trigger = { any_country = { OR = { has_origin = origin_kuat_apocalyptic has_origin = origin_eternalthrone } } }
	immediate = {
		every_megastructure = {
			limit = { is_megastructure_type = exe_outer_gate_disable }
			upgrade_megastructure_to = exe_outer_gate
			finish_upgrade = yes
		}
		every_playable_country = {
			limit = { is_ai = no has_origin = origin_kuat_apocalyptic }
			set_country_flag = can_pass_by
			set_country_flag = can_pass_inner_by
			country_event = { id = executor_build.93 }
		}
		every_megastructure = {
			limit = { is_megastructure_type = exe_outer_gate }
			activate_gateway = this
		}
	}
}

country_event = {
	id = executor_build.93
	title = executor_build.93.title
	desc = executor_build.93.desc
	diplomatic = yes
	picture_event_data = { room = l-gateway_room }
	custom_gui = "kuat_event_m_window"
	custom_gui_option = "kuat_event_m_option"
	is_triggered_only = yes
	trigger = { has_origin = origin_kuat_apocalyptic }
	option = { name = executor_build.93.RESPON }
}

country_event = {
	id = executor_build.94
	hide_window = yes
	is_triggered_only = yes
	trigger = { NOT = { has_origin = origin_parit } }
	immediate = { event_target:fallen_empire_kuat = { add_opinion_modifier = { who = prev modifier = opinion_kuat_new } } }
}

country_event = {
	id = executor_build.23
	title = "executor_build.23.name"
	desc = "executor_build.23.desc"
	diplomatic = yes
	fire_only_once = yes
	picture_event_data = { room = frozen_planet_room }
	custom_gui = "kuat_event_window"
	custom_gui_option = "kuat_event_option"
	trigger = {
		is_ai = no
		has_technology = tech_sensors_2
		NOT = { any_country = { OR = { has_origin = origin_kuat_apocalyptic has_origin = origin_eternalthrone } } }
		NOT = { has_global_flag = kuat_outgate_enable }
	}
	mean_time_to_happen = { 
		years = 4 
		modifier = { factor = 0.75 years_passed > 20 }
		modifier = { factor = 0.5 years_passed > 25 }
		modifier = { factor = 0.25 years_passed > 30 }
	}
	immediate = {
		if = {
			limit = { any_system_within_border = {
				is_capital_system = no
				any_system_planet = { 
					is_planet_class = pc_frozen 
					NOT = { exists = archaeological_site }
				}
			} }
			random_system_within_border = {
				limit = {
					is_capital_system = no
					any_system_planet = { 
						is_planet_class = pc_frozen 
						NOT = { exists = archaeological_site }
					}
				}
				random_system_planet = {
					limit = { 
						is_planet_class = pc_frozen 
						NOT = { exists = archaeological_site }
					}
					save_global_event_target_as = has_kuat_lagacy_9
					create_archaeological_site = kuat_lagacy_9
				}
			}
		} else = {
			random_planet_within_border = {
				limit = {
					is_ringworld = no
					is_star = no
					is_colony = no
					is_colonizable = no
					is_capital = no
					is_asteroid = no
					NOT = { exists = archaeological_site }
				}
				change_pc = pc_frozen
				save_global_event_target_as = has_kuat_lagacy_9
				create_archaeological_site = kuat_lagacy_9
			}
		}
	}
	option = { name = "executor_build.23.a" }
}

fleet_event = {
	id = executor_build.30
	hide_window = no
	title = "executor_build.30.title"
	desc = "executor_build.30.desc"
	picture = GFX_evt_frozen
	show_sound = event_wind_ruins
	is_triggered_only = yes
	archaeology = yes
	immediate = { from = { set_site_progress_locked = yes } }

	after = { from = { set_site_progress_locked = no } }
	
	option = { name = executor_build.30.a }
}

fleet_event = {
	id = executor_build.31
	hide_window = no
	title = "executor_build.31.title"
	desc = "executor_build.31.desc"
	picture = GFX_evt_habitable_dig_site
	show_sound = event_wind_ruins
	is_triggered_only = yes
	archaeology = yes
	immediate = { from = { set_site_progress_locked = yes } }

	after = { from = { set_site_progress_locked = no } }
	
	option = { name = executor_build.31.a }
}

fleet_event = {
	id = executor_build.32
	hide_window = no
	title = "executor_build.32.title"
	desc = "executor_build.32.desc"
	picture = GFX_evt_hidden_door
	show_sound = event_wind_ruins
	is_triggered_only = yes
	archaeology = yes
	immediate = { from = { set_site_progress_locked = yes } }

	after = { from = { set_site_progress_locked = no } }
	
	option = { name = executor_build.32.a }
}

fleet_event = {
	id = executor_build.33
	hide_window = no
	title = "executor_build.33.title"
	desc = "executor_build.33.desc"
	picture = GFX_evt_relic_world_building
	show_sound = event_wind_ruins
	is_triggered_only = yes
	archaeology = yes
	immediate = { from = { set_site_progress_locked = yes } }

	after = { from = { set_site_progress_locked = no } }
	
	option = { name = executor_build.33.a }
}

fleet_event = {
	id = executor_build.34
	hide_window = no
	title = "executor_build.34.title"
	desc = "executor_build.34.desc"
	picture = GFX_evt_sapient_AI
	show_sound = event_wind_ruins
	is_triggered_only = yes
	archaeology = yes
	immediate = { from = { set_site_progress_locked = yes } }

	after = { from = { set_site_progress_locked = no } }
	
	option = { name = executor_build.34.a }
}

fleet_event = {
	id = executor_build.35
	hide_window = no
	title = "executor_build.35.title"
	desc = "executor_build.35.desc"
	picture = GFX_evt_ancient_databank
	show_sound = event_wind_ruins
	is_triggered_only = yes
	archaeology = yes
	immediate = { from = { set_site_progress_locked = yes } }

	after = { from = { set_site_progress_locked = no } }
	
	option = { 
		name = executor_build.35.a
		large_artifact_reward = yes
		event_target:has_kuat_lagacy_9 = {
			change_pc = pc_gaia
			set_planet_size = 25
			add_modifier = { modifier = paradise_planet }
			add_deposit = d_underwater_vent
			add_deposit = d_frozen_gas_lake
			add_deposit = d_tempestous_mountain
			add_deposit = d_searing_desert
			add_deposit = d_buzzing_plains
			add_deposit = d_rich_mountain
			add_deposit = d_prosperous_mesa
			add_deposit = d_submerged_ore_veins
			add_deposit = d_ore_rich_caverns
			add_deposit = d_mineral_striations
			add_deposit = d_teeming_reef
			add_deposit = d_lush_jungle
			add_deposit = d_black_soil
			add_deposit = d_fertile_lands
			add_deposit = d_natural_farmland
			add_deposit = d_dust_desert
			add_deposit = d_fuming_bog
			add_deposit = d_dust_caverns
			add_deposit = d_bubbling_swamp
			add_deposit = d_crystal_reef
			add_deposit = d_crystal_forest
			add_deposit = d_betharian_deposit
			add_deposit = d_alien_pets_deposit
			add_modifier = { modifier = kyber_crystals days = -1 }
		}
		leader = { save_global_event_target_as = dig_archetectrue_leader }
		hidden_effect = { owner = { set_country_flag = finished_kuat_gateway_stage_first } }
	}
}

country_event = {
	id = executor_build.36
	title = "executor_build.36.name"
	desc = "executor_build.36.desc"
	diplomatic = yes
	fire_only_once = yes
	picture_event_data = { room = frozen_planet_room }
	custom_gui = "kuat_event_window"
	custom_gui_option = "kuat_event_option"
	trigger = {
		is_ai = no
		has_technology = tech_sensors_2
		has_country_flag = finished_kuat_gateway_stage_first
		NOT = { any_country = { OR = { has_origin = origin_kuat_apocalyptic has_origin = origin_eternalthrone } } }
		NOT = { has_global_flag = kuat_outgate_enable }
	}
	mean_time_to_happen = { 
		years = 4 
		modifier = { factor = 0.75 years_passed > 20 }
		modifier = { factor = 0.5 years_passed > 25 }
		modifier = { factor = 0.25 years_passed > 30 }
	}
	immediate = {
		clear_global_event_target = has_kuat_lagacy_9
		if = {
			limit = { any_system_within_border = {
				is_capital_system = no
				any_system_planet = { 
					is_planet_class = pc_frozen 
					NOT = { exists = archaeological_site }
				}
			} }
			random_system_within_border = {
				limit = {
					is_capital_system = no
					any_system_planet = { 
						is_planet_class = pc_frozen 
						NOT = { exists = archaeological_site }
					}
				}
				random_system_planet = {
					limit = { 
						is_planet_class = pc_frozen 
						NOT = { exists = archaeological_site }
					}
					save_global_event_target_as = has_kuat_lagacy_10
					create_archaeological_site = kuat_lagacy_10
				}
				while = { count = 15 create_ambient_object = { type = "large_debris_object" location = solar_system } }
				while = { count = 10 create_ambient_object = { type = "medium_debris_01_object" location = solar_system } }
				while = { count = 20 create_ambient_object = { type = "medium_debris_02_object" location = solar_system } }
				while = { count = 30 create_ambient_object = { type = "small_debris_object" location = solar_system } }
			}
		} else = {
			random_planet_within_border = {
				limit = {
					is_ringworld = no
					is_star = no
					is_colony = no
					is_colonizable = no
					is_capital = no
					is_asteroid = no
					NOT = { exists = archaeological_site }
				}
				change_pc = pc_frozen
				save_global_event_target_as = has_kuat_lagacy_10
				create_archaeological_site = kuat_lagacy_10
				solar_system = {
					while = { count = 15 create_ambient_object = { type = "large_debris_object" location = solar_system } }
					while = { count = 10 create_ambient_object = { type = "medium_debris_01_object" location = solar_system } }
					while = { count = 20 create_ambient_object = { type = "medium_debris_02_object" location = solar_system } }
					while = { count = 30 create_ambient_object = { type = "small_debris_object" location = solar_system } }
				}
			}
		}
	}
	option = { name = "executor_build.36.a" }
}

fleet_event = {
	id = executor_build.37
	hide_window = no
	title = "executor_build.37.title"
	desc = "executor_build.37.desc"
	picture = GFX_evt_em_war_6
	show_sound = event_wind_ruins
	is_triggered_only = yes
	archaeology = yes
	immediate = { from = { set_site_progress_locked = yes } }

	after = { from = { set_site_progress_locked = no } }
	
	option = { name = executor_build.37.a }
}

fleet_event = {
	id = executor_build.38
	hide_window = no
	title = "executor_build.38.title"
	desc = "executor_build.38.desc"
	picture = GFX_evt_habitable_dig_site
	show_sound = event_wind_ruins
	is_triggered_only = yes
	archaeology = yes
	immediate = { from = { set_site_progress_locked = yes } }

	after = { from = { set_site_progress_locked = no } }
	
	option = { name = executor_build.38.a }
}

fleet_event = {
	id = executor_build.39
	hide_window = no
	title = "executor_build.39.title"
	desc = "executor_build.39.desc"
	picture = GFX_evt_hidden_door
	show_sound = event_wind_ruins
	is_triggered_only = yes
	archaeology = yes
	immediate = { from = { set_site_progress_locked = yes } }

	after = { from = { set_site_progress_locked = no } }
	
	option = { name = executor_build.39.a }
}

fleet_event = {
	id = executor_build.40
	hide_window = no
	title = "executor_build.40.title"
	desc = "executor_build.40.desc"
	picture = GFX_evt_relic_world_building
	show_sound = event_wind_ruins
	is_triggered_only = yes
	archaeology = yes
	immediate = { from = { set_site_progress_locked = yes } }

	after = { from = { set_site_progress_locked = no } }
	
	option = { name = executor_build.40.a }
}

fleet_event = {
	id = executor_build.41
	hide_window = no
	title = "executor_build.41.title"
	desc = "executor_build.41.desc"
	picture = GFX_evt_sapient_AI
	show_sound = event_wind_ruins
	is_triggered_only = yes
	archaeology = yes
	immediate = { from = { set_site_progress_locked = yes } }

	after = { from = { set_site_progress_locked = no } }
	
	option = { name = executor_build.41.a }
}

fleet_event = {
	id = executor_build.42
	hide_window = no
	title = "executor_build.42.title"
	desc = "executor_build.42.desc"
	picture = GFX_evt_ancient_databank
	show_sound = event_wind_ruins
	is_triggered_only = yes
	archaeology = yes
	immediate = { from = { set_site_progress_locked = yes } }

	after = { from = { set_site_progress_locked = no } }
	
	option = { 
		name = executor_build.42.a
		large_artifact_reward = yes
	}
}

fleet_event = {
	id = executor_build.43
	hide_window = no
	title = "executor_build.43.title"
	desc = "executor_build.43.desc"
	picture = GFX_evt_ancient_artifact
	show_sound = event_wind_ruins
	is_triggered_only = yes
	archaeology = yes
	immediate = { from = { set_site_progress_locked = yes } }

	after = { from = { set_site_progress_locked = no } }
	
	option = { 
		name = executor_build.43.a
		large_artifact_reward = yes
		event_target:has_kuat_lagacy_10 = {
			change_pc = pc_gaia
			set_planet_size = 25
			add_modifier = { modifier = paradise_planet }
			add_deposit = d_underwater_vent
			add_deposit = d_frozen_gas_lake
			add_deposit = d_tempestous_mountain
			add_deposit = d_searing_desert
			add_deposit = d_buzzing_plains
			add_deposit = d_rich_mountain
			add_deposit = d_prosperous_mesa
			add_deposit = d_submerged_ore_veins
			add_deposit = d_ore_rich_caverns
			add_deposit = d_mineral_striations
			add_deposit = d_teeming_reef
			add_deposit = d_lush_jungle
			add_deposit = d_black_soil
			add_deposit = d_fertile_lands
			add_deposit = d_natural_farmland
			add_deposit = d_dust_desert
			add_deposit = d_fuming_bog
			add_deposit = d_dust_caverns
			add_deposit = d_bubbling_swamp
			add_deposit = d_crystal_reef
			add_deposit = d_crystal_forest
			add_deposit = d_betharian_deposit
			add_deposit = d_alien_pets_deposit
			add_modifier = { modifier = kyber_crystals days = -1 }
		}
		hidden_effect = { 
			owner = { 
				set_country_flag = finished_kuat_gateway_stage_final
				if = {
					limit = { 
						OR = {
							any_system_within_border = { 
								has_star_flag = exe_outer_gate_disable_system 
							} 	
							any_system = { 
								OR = {
									NOT = { space_owner = { is_same_value = prevprev } }
									NOT = { exists = space_owner }
								}
								has_star_flag = exe_outer_gate_disable_system
								is_surveyed = { who = prev status = yes }
							}
						}
					}
					set_country_flag = can_enable_kuat_gate_special
				}
				else = { set_country_flag = can_enable_kuat_gate }
			} 
			clear_global_event_target = dig_archetectrue_leader
		}
	}
}

country_event = {
	id = executor_build.44
	title = "executor_build.44.name"
	desc = "executor_build.44.desc"
	diplomatic = yes
	picture_event_data = { room = ancient_AI_room }
	custom_gui = "kuat_event_window"
	custom_gui_option = "kuat_event_option"
	is_triggered_only = yes
	fire_only_once = yes
	trigger = {
		has_country_flag = finished_kuat_gateway_stage_final
		has_country_flag = can_enable_kuat_gate
		NOT = { has_country_flag = can_enable_kuat_gate_special_active }
		NOT = { any_country = { OR = { has_origin = origin_kuat_apocalyptic has_origin = origin_eternalthrone } } }
		NOT = { has_global_flag = kuat_outgate_enable }
		from = { has_star_flag = exe_outer_gate_disable_system }
	}
	immediate = { 
		set_country_flag = can_enable_kuat_gate_active
		clear_global_event_target = has_kuat_lagacy_10
	}
	option = {
		name = executor_build.44.a
		enable_special_project = {
			name = exe_enable_kuat_stargate
			owner = root
			location = event_target:exe_outer_gate_disable
		}
	}
}

ship_event = {
	id = executor_build.45
	title = executor_build.45.title
	desc = executor_build.45.desc
	diplomatic = yes
	picture_event_data = { room = clocks_room }
	custom_gui = "kuat_event_m_window"
	custom_gui_option = "kuat_event_m_option"
	is_triggered_only = yes
	immediate = { set_global_flag = kuat_outgate_enable }
	option = { 
		name = executor_build.45.a 
		hidden_effect = {
			solar_system = { remove_star_flag = exe_outer_gate_disable_system }
			every_megastructure = {
				limit = { is_megastructure_type = exe_outer_gate_disable }
				upgrade_megastructure_to = exe_outer_gate
				finish_upgrade = yes
			}
			every_playable_country = {
				limit = { is_ai = no }
				set_country_flag = can_pass_by
				set_country_flag = can_pass_inner_by
				country_event = { id = executor_build.46 }
			}
			every_megastructure = {
				limit = { is_megastructure_type = exe_outer_gate }
				activate_gateway = this
			}
		}
	}
}

country_event = {
	id = executor_build.46
	title = executor_build.46.title
	desc = executor_build.46.desc
	diplomatic = yes
	picture_event_data = { room = l-gateway_room }
	custom_gui = "kuat_event_m_window"
	custom_gui_option = "kuat_event_m_option"
	is_triggered_only = yes
	option = { name = executor_build.46.a }
}

country_event = {
	id = executor_build.47
	title = "executor_build.47.name"
	desc = "executor_build.47.desc"
	diplomatic = yes
	picture_event_data = { room = ancient_AI_room }
	custom_gui = "kuat_event_window"
	custom_gui_option = "kuat_event_option"
	mean_time_to_happen = { 
		years = 10 
		modifier = { factor = 0.75 exists = event_target:fallen_empire_kuat_fleet }
		modifier = { factor = 0.5 exists = event_target:exe_outer_gate_disable }
		modifier = { factor = 0.25 is_at_war_with = event_target:fallen_empire_kuat }
	}
	fire_only_once = yes
	trigger = {
		has_country_flag = finished_kuat_gateway_stage_final
		OR = {
			has_country_flag = can_enable_kuat_gate_special
			any_system_within_border = { has_star_flag = exe_outer_gate_disable_system } 
			AND = {
				NOT = { exists = event_target:exe_outer_gate_disable }
				NOT = { exists = event_target:fallen_empire_kuat_fleet }
				is_at_war_with = event_target:fallen_empire_kuat
				any_system = { has_star_flag = ag_exe_invasion_gate_system } 
			}
		}
		NOT = { any_country = { OR = { has_origin = origin_kuat_apocalyptic has_origin = origin_eternalthrone } } }
		NOT = { has_global_flag = kuat_outgate_enable }
		NOT = { has_country_flag = can_enable_kuat_gate_active }
	}
	immediate = { 
		set_country_flag = can_enable_kuat_gate_special_active
		clear_global_event_target = has_kuat_lagacy_10 
		if = {
			limit = { 
				NOT = { exists = event_target:exe_outer_gate_disable }
				NOT = { exists = event_target:fallen_empire_kuat_fleet }
				is_at_war_with = event_target:fallen_empire_kuat
				any_system = { has_star_flag = ag_exe_invasion_gate_system } 
			}
			every_megastructure = {
				limit = { 
					has_megastructure_flag = can_active_gateway 
					is_megastructure_type = exe_outer_gate
				}
				save_event_target_as = exe_outer_gate_disable
			}
		}
	}
	option = {
		name = executor_build.47.a
		enable_special_project = {
			name = exe_enable_kuat_stargate
			owner = root
			location = event_target:exe_outer_gate_disable
		}
	}
}

##########################
## STAR GAME FOR SYSTEM ##
##########################
event = {
	id = executor_build.2
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		random_country = {
			limit = { is_ai = no }
			save_global_event_target_as = kuat_player_target_country
			owner_main_species = { save_global_event_target_as = kuat_player_target_species }
		}
		if = {
			limit = { any_country = { OR = { has_origin = origin_kuat_apocalyptic has_origin = origin_eternalthrone } is_ai = no } }
			every_playable_country = {
				limit = { OR = { has_origin = origin_kuat_apocalyptic has_origin = origin_eternalthrone } is_ai = no }
				remove_country_flag = human_1
				remove_country_flag = human_2
				set_country_flag = custom_start_screen
				country_event = { id = kuat_origin.1 }
			}
		}
		else_if = {
			limit = { 
				OR = {
					NOT = { any_country = { OR = { has_origin = origin_kuat_apocalyptic has_origin = origin_eternalthrone } } }
					any_country = { OR = { has_origin = origin_kuat_apocalyptic has_origin = origin_eternalthrone } is_ai = yes }
				}
			}
			kuat_system_initial_creating = yes
			every_playable_country = { country_event = { id = executor_build.3 days = 30 } }
			set_global_flag = kuat_spawned
		}
	}
}

country_event = {
	id = executor_build.3
	title = executor_build.title
	desc = {
		trigger = {
			NOR = {
				has_global_flag = has_swgs_country
				has_origin = origin_parit
			}
		}
		text = executor_build.desc
	}
	desc = {
		trigger = {
			has_global_flag = has_swgs_country
		}
		text = executor_build_special.desc
	}
	desc = {
		trigger = {
			has_origin = origin_parit
		}
		text = executor_build_special_parit.desc
	}
	diplomatic = yes
	picture_event_data = {
		portrait = event_target:kuat_player_target_species
		planet_background = pc_ringworld_habitable
		graphical_culture = fallen_empire_01
		city_level = event_target:fallen_empire_kuat
		room = personality_fallen_empire_cyan_room
	}
	custom_gui = "kuat_event_diplomacy_window"
	custom_gui_option = "kuat_event_diplomacy_option"
	is_triggered_only = yes
	trigger = {
		NOT = { is_country_type = default_ev }
	}
	immediate = {
		if = {
			limit = { has_origin = origin_parit }
			set_country_flag = has_parit_girl
			event_target:fallen_empire_kuat = {
				add_opinion_modifier = {
					who = prev
					modifier = opinion_kuat_new_parit
				}
			}
		}
		random_system = {
			limit = { has_star_flag = Kuat_system_int_4 }
			if = {
				limit = { NOT = { exists = starbase } }
				create_starbase = {
					size = "starbase_citadel"
					owner = event_target:fallen_empire_kuat
					module = "shipyard"
					module = "gun_battery"
					module = "gun_battery"
					module = "gun_battery"
					module = "gun_battery"
					module = "gun_battery"
					building = "target_uplink_computer"
					building = "defense_grid"
					building = "colossus_yards"
					building = "titan_yards"
				}
				random_system_planet = { create_kuat_system_fleet = yes }
			}
		}
		establish_communications_no_message = event_target:fallen_empire_kuat
		establish_communications_no_message = event_target:kuat_shipyard_country
	}
	option = {
		name = executor_build.a
		hidden_effect = {
			country_event = { id = executor_build.94 days = 10 }
			country_event = { id = executor_build.371 days = 30 }
		}
	}
}

country_event = {
	id = executor_build.9
	title = executor_build.title
	desc = {
		trigger = {
			NOR = {
				has_global_flag = has_swgs_country
				has_origin = origin_parit
			}
		}
		text = executor_build.desc
	}
	desc = {
		trigger = {
			has_global_flag = has_swgs_country
		}
		text = executor_build_special.desc
	}
	desc = {
		trigger = {
			has_origin = origin_parit
		}
		text = executor_build_special_parit.desc
	}
	diplomatic = yes
	picture_event_data = {
		portrait = event_target:kuat_player_target_species
		planet_background = pc_ringworld_habitable
		graphical_culture = fallen_empire_01
		city_level = event_target:fallen_empire_kuat
		room = personality_fallen_empire_cyan_room
	}
	custom_gui = "kuat_event_diplomacy_window"
	custom_gui_option = "kuat_event_diplomacy_option"
	is_triggered_only = yes
	trigger = { is_country_type = default_ev }
	immediate = {
		if = {
			limit = { has_origin = origin_parit }
			set_country_flag = has_parit_girl
			event_target:fallen_empire_kuat = {
				add_opinion_modifier = {
					who = prev
					modifier = opinion_kuat_new_parit
				}
			}
		}
		establish_communications_no_message = event_target:fallen_empire_kuat
		establish_communications_no_message = event_target:kuat_shipyard_country
	}
	option = {
		name = executor_build.a
		country_event = { id = executor_build.94 days = 10 }
	}
}

##########################
# KUAT CRISIS AWAKENING ##
##########################
country_event = {
	id = executor_build.4
	title = OK
	desc = OK
	hide_window = yes
	fire_only_once = yes
	trigger = {
		is_country_type = kuat_fallen_empire
		is_at_war = no
		any_country = { is_country_type = wg_crisis_country }
	}
	mean_time_to_happen = {
		years = 200000
		modifier = {
			factor = 0
			any_country = { is_country_type = wg_crisis_country }
		}
	}
	immediate = {
		if = {
			limit = { has_global_flag = wg_crisis_insane }
			every_playable_country = {
				limit = { is_ai = no }
				country_event = { id = ai_action.10 days = 5 }
			}
		}
		country_event = { id = executor_build.20 }
		country_event = { id = ai_action.7 days = 10 }
		every_playable_country = {
			limit = { is_ai = no }
			country_event = { id = executor_build.21 }
		}
	}
}

country_event = {
	id = executor_build.21
	title = fallen_empires_awakening.2.name
	desc = fallen_empires_awakening.2.desc
	diplomatic = yes
	picture_event_data = { room = fallen_empire_room }
	custom_gui = "kuat_event_window"
	custom_gui_option = "kuat_event_option"
	show_sound = event_alien_signal
	location = from
	is_triggered_only = yes
	option = { name = fallen_empires_awakening.2.a }
	option = { name = fallen_empires_awakening.2.b }
}

country_event = {
	id = executor_build.20
	title = OK
	desc = OK
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		set_country_flag = sleepers_awake_first_sleeper
		set_country_type = kuat_awakened_fallen_empire
		change_government = {
			civics = {
				civic = civic_revanchist_fervor_kuat
				civic = civic_ancient_caches_of_technology_kuat
			}
		}
		create_kuat_awakening_fleet = yes
		# Establish communications
		every_country = {
			limit = {
				NOT = { has_communications = root }
			}
			establish_communications_no_message = root
			root = { save_event_target_as = contact_empire }
			country_event = { id = action.1 }
		}
	}
}

##########################
##### GIVE TECHNOLOGY ####
##########################
country_event = {
	id = executor_build.5
	hide_window = yes
	is_triggered_only = yes
	trigger = { has_country_flag = fallen_empire_kuat }
	immediate = {
		every_country = {
			limit = {
				is_ai = no
				any_system_within_border = { kuat_is_kuat_system = yes }
			}
			country_event = { id = executor_build.6 }
		}
	}
}

country_event = {
	id = executor_build.6
	title = executor_build.6.title
	desc = executor_build.6.desc
	diplomatic = yes
	picture_event_data = { room = exploding_ship_room }
	custom_gui = "kuat_event_m_window"
	custom_gui_option = "kuat_event_m_option"
	is_triggered_only = yes
	immediate = { set_country_flag = can_have_tecn }
	option = {
		name = executor_build.6.a
		give_technology = { tech = tech_kuat_noway }
		hidden_effect = {
			if = {
				limit = { NOT = { has_existing_ship_design = swfo_resurgent } }
				create_ship_design = { design = "Name_boss_Resugrant" }
				add_ship_design = last_created_design
			}
			if = {
				limit = { NOT = { has_existing_ship_design = horrizone } }
				create_ship_design = { design = "Name_boss_Horriwer" }
				add_ship_design = last_created_design
			}
			if = {
				limit = { NOT = { has_existing_ship_design = Imperial_star_destroyer } }
				create_ship_design = { design = "Name_boss_EMPIRE" }
				add_ship_design = last_created_design
			}
		}
	}
}

##########################
##### KUAT AWAKENING #####
##########################
country_event = {
	id = executor_build.7
	title = OK
	desc = OK
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		is_kuat_fallen_empire = yes
		is_at_war = no
		NOT = { exists = event_target:fallen_empire_kuat_fleet }
		NOT = { any_country = { is_kuat_battle_country = yes } }
	}
	immediate = {
		if = {
			limit = { has_global_flag = kuat_war_goal }
			if = {
				limit = { is_country_type = kuat_fallen_empire }
				every_playable_country = {
					limit = { is_ai = no }
					country_event = { id = executor_build.21 }
				}
				country_event = { id = executor_build.20 }
			}
			random_playable_country = {
				limit = { is_same_value = event_target:target_for_kuat }
				country_event = { id = executor_build.24 days = 5 }
			}
		}
		else = {
			save_event_target_as = fallen_empire_humiliator
			create_kuat_fleet_country_type = yes
			every_system = {
				limit = { has_star_flag = kuat_military_base_system_home }
				every_fleet_in_system = { 
					limit = { exists = owner owner = { is_kuat_fallen_empire = no } }
					set_location =  owner.capital_scope 
				}
				create_starbase = {
					owner = event_target:fallen_empire_kuat_fleet
					size = exe_starbase
					module = "gun_battery"
					module = "gun_battery"
					module = "gun_battery"
					module = "gun_battery"
					module = "gun_battery"
					module = "gun_battery"
					building = "target_uplink_computer"
					building = "defense_grid"
					building = "colossus_yards"
					building = "titan_yards"
				}
				every_system_planet = {
					limit = { has_planet_flag = create_defender_fleet_location }
					create_kuat_fleet_country_type_defend_army = yes
				}
			}
			event_target:target_for_kuat = { establish_communications_no_message = event_target:fallen_empire_kuat_fleet }
			event_target:target_for_kuat = { fallen_empire_humiliate_effect = yes country_event = { id = ai_action.5 days = 1 } }
		}
	}
}

country_event = {
	id = executor_build.24
	title = executor_build.24.title
	desc = executor_build.24.desc
	diplomatic = yes
	diplomatic_title = executor_build.24.title
	picture_event_data = {
		portrait = event_target:kuat_player_target_species
		planet_background = pc_ringworld_habitable
		graphical_culture = fallen_empire_01
		city_level = event_target:fallen_empire_kuat
		room = personality_fallen_empire_cyan_room
	}
	custom_gui = "kuat_event_diplomacy_window"
	custom_gui_option = "kuat_event_diplomacy_option"
	is_triggered_only = yes
	trigger = { exists = event_target:fallen_empire_kuat }
	option = {
		name = executor_build.24.a
		hidden_effect = { event_target:fallen_empire_kuat = { declare_war = {
			target = event_target:target_for_kuat
			name = "Name_kuat_war"
			attacker_war_goal = Kuat_total_war
		} } }
	}
}

##########################
# BEAT BY PLAYER REBORN ##
##########################
country_event = {
	id = executor_build.10
	is_triggered_only = yes
	hide_window = yes
	trigger = {
		has_country_flag = fallen_empire_kuat
		fromfrom = { has_ship_flag = ship_ruins }
	}
	immediate = {
		solar_system = { save_event_target_as = explode_kuat_system }
		from = { country_event = { id = executor_build.11 days = 1 } }
	}
}

country_event = {
	id = executor_build.11
	is_triggered_only = yes
	hide_window = no
	title = executor_build.11.title
	desc = executor_build.11.desc
	diplomatic = yes
	picture_event_data = { room = exploding_ship_room }
	custom_gui = "kuat_event_window"
	custom_gui_option = "kuat_event_option"
	immediate = { country_event = { id = executor_build.12 days = 10 } }
	option = { name = executor_build.11.a }
}

country_event = {
	id = executor_build.12
	is_triggered_only = yes
	hide_window = yes
	immediate = {
		event_target:explode_kuat_system = {
			star = {
				create_ambient_object = { type = "star_explosion" play_animation_once = yes location = this }
				last_created_ambient_object = { set_location = { target = prev distance = 0 angle = random } }
				create_ambient_object = { type = "destroyed_system" location = this }
				last_created_ambient_object = { set_ambient_object_flag = destroyed_system_effect set_location = { target = prev  distance = 0  angle = random  } }
			}
			every_fleet_in_system = { 
				limit = { exists = owner owner = { is_kuat_fallen_empire = no } }
				destroy_fleet = { target = this destroy_template = yes kill_leader = yes } 
			}
		}
		country_event = { id = executor_build.13 days = 5 }
	}
}

country_event = {
	id = executor_build.13
	is_triggered_only = yes
	hide_window = no
	title = executor_build.13.title
	desc = executor_build.13.desc
	diplomatic = yes
	picture_event_data = { room = machine_space_battle_room }
	custom_gui = "kuat_event_m_window"
	custom_gui_option = "kuat_event_m_option"
	trigger = { exists = event_target:fallen_empire_kuat }
	immediate = {
		event_target:fallen_empire_kuat = {
			every_system_within_border = {
				limit = { has_star_flag = Kuat_system }
				create_starbase = {
					owner = event_target:fallen_empire_kuat
					size = "starbase_citadel"
					module = "shipyard"
					module = "shipyard"
					module = "shipyard"
					module = "hangar_bay"
					module = "gun_battery"
					module = "gun_battery"
					building = "target_uplink_computer"
					building = "defense_grid"
					building = "colossus_yards"
					building = "titan_yards"
				}
				create_capital_reinforcements_fleet = yes
			}
		}
	}
	option = { name = OK }
}

##########################
### BUILDING EXECUTOR ####
##########################
ship_event = {
	id = executor_build.90
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		owner = { NOR = { has_origin = origin_kuat_apocalyptic has_origin = origin_eternalthrone } }
		is_ship_size = knigjt_hammer_executor
	}
	immediate = {
		set_ship_flag = executor
		if = {
			limit = { exists = event_target:fallen_empire_kuat }
			owner = { country_event = { id = executor_build.91 } }
		}
	}
}

country_event = {
	id = executor_build.91
	title = executor_build.91.title
	desc = executor_build.91.desc
	diplomatic = yes
	is_triggered_only = yes
	fire_only_once = yes
	picture_event_data = {
		portrait = event_target:kuat_player_target_species
		planet_background = event_target:fallen_empire_kuat
		graphical_culture = fallen_empire_01
		city_level = event_target:fallen_empire_kuat
		room = event_target:fallen_empire_kuat.ruler
	}
	custom_gui = "kuat_event_diplomacy_window"
	custom_gui_option = "kuat_event_diplomacy_option"
	trigger = { any_country = { has_country_flag = fallen_empire_kuat } }
	immediate = {
		if = {
			limit = { has_country_resource = { type = energy amount > 10000 } }
			export_resource_stockpile_to_variable = { resource = energy variable = country_energy_tax_amount }
			multiply_variable = { which = country_energy_tax_amount value = 0.5 }
		}
		else = { set_variable = { which = country_energy_tax_amount value = 5000 } }
	}
	option = {
		name = executor_build.91.a
		allow = { has_country_resource = { type = energy amount >= country_energy_tax_amount } }
		add_resource = { energy = -1 mult = country_energy_tax_amount }
		hidden_effect = { clear_variable = country_energy_tax_amount }
		event_target:fallen_empire_kuat = { add_opinion_modifier = { who = prev modifier = opinion_kuat_shipc_can_get_1 } }
	}
	option = {
		name = executor_build.91.b
		hidden_effect = { clear_variable = country_energy_tax_amount }
		event_target:fallen_empire_kuat = { add_opinion_modifier = { who = prev modifier = opinion_kuat_shipc_can_not_get } }
	}
}

country_event = {
	id = executor_build.92
	title = executor_build.91.title
	desc = executor_build.92.desc
	diplomatic = yes
	picture_event_data = { room = clocks_room }
	custom_gui = "kuat_event_m_window"
	custom_gui_option = "kuat_event_m_option"
	is_triggered_only = yes
	trigger = {
		mid_game_years_passed >= 20
		any_owned_ship = { has_ship_flag = executor }
		exists = event_target:fallen_empire_kuat
	}
	immediate = {
		if = {
			limit = { has_country_resource = { type = energy amount > 10000 } }
			export_resource_stockpile_to_variable = { resource = energy variable = country_energy_tax_amount }
			multiply_variable = { which = country_energy_tax_amount value = 0.5 }
		}
		else = { set_variable = { which = country_energy_tax_amount value = 5000 } }
	}
	option = {
		name = executor_build.91.a
		allow = { has_country_resource = { type = energy amount >= country_energy_tax_amount } }
		add_resource = { energy = -1 mult = country_energy_tax_amount }
		hidden_effect = { clear_variable = country_energy_tax_amount }
		event_target:fallen_empire_kuat = { add_opinion_modifier = { who = prev modifier = opinion_kuat_shipc_can_get_1 } }
	}
	option = {
		name = executor_build.91.b
		hidden_effect = { clear_variable = country_energy_tax_amount }
		event_target:fallen_empire_kuat = { add_opinion_modifier = { who = prev modifier = opinion_kuat_shipc_can_not_get } }
	}
}

##########################
##### FIND SYSTEM ########
##########################
country_event = {
	id = executor_build.100
	title = executor_build.100.title
	desc = executor_build.100.desc
	is_triggered_only = yes
	diplomatic = yes
	picture_event_data = {
		portrait = event_target:kuat_player_target_species
		planet_background = pc_ringworld_habitable
		graphical_culture = fallen_empire_01
		city_level = event_target:fallen_empire_kuat
		room = personality_fallen_empire_cyan_room
	}
	custom_gui = "kuat_event_diplomacy_window"
	custom_gui_option = "kuat_event_diplomacy_option"
	trigger = {
		exists = event_target:fallen_empire_kuat
		is_ai = no
	}
	option = {
		name = executor_build_op_a.a
		event_target:fallen_empire_kuat = { add_opinion_modifier = { who = prev modifier = opinion_kuat_shipc_can_get } }
	}
}

##########################
##### EVENT FLAG #########
##########################
event = {
	id = executor_build.1000
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		NOT = { any_country = { OR = { has_origin = origin_kuat_apocalyptic has_origin = origin_eternalthrone } } }
	}
	immediate = {
		if = {
			limit = {
				NOR = {
					has_global_flag = ag_spawnsystem_gatekeeper_any_time
					has_global_flag = ag_spawnsystem_gatekeeper_mid_game
				}
			}
			set_global_flag = ag_spawnsystem_gatekeeper_mid_game
		}
	}
}


##########################
##### Parit start ########
##########################
country_event = {
	id = executor_build.258
	hide_window = no
	title = "executor_build.258.title"
	desc = "executor_build.258.desc"
	diplomatic = yes
	picture_event_data = {
		portrait = event_target:kuat_player_target_species
		planet_background = pc_ringworld_habitable
		graphical_culture = fallen_empire_01
		city_level = event_target:fallen_empire_kuat
		room = personality_fallen_empire_cyan_room
	}
	custom_gui = "kuat_event_diplomacy_window"
	custom_gui_option = "kuat_event_diplomacy_option"
	is_triggered_only = yes
	trigger = {
		is_ai = no
		exists = event_target:fallen_empire_kuat
		has_origin = origin_parit
	}
	option = {
		name = "executor_build.258.a"
		hidden_effect = {
			event_target:fallen_empire_kuat = { add_opinion_modifier = { who = root modifier = opinion_kuat_new_parit_finish } }
		}
	}
}

event = {
	id = executor_build.278
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		exists = event_target:fallen_empire_kuat
		any_country = {
			is_ai = no
			has_origin = origin_parit
		}
		mid_game_years_passed > 0
	}
	immediate = {
		every_playable_country = {
			limit = {
				is_ai = no
				has_origin = origin_parit
				has_communications = event_target:fallen_empire_kuat
			}
			random_list = {
				1 = {
					modifier = {
						add = 1
						check_variable = { which = years_not_trigger_parit_evt value >= 8 }
					}
					clear_variable = years_not_trigger_parit_evt
					country_event = { id = executor_build.279 days = 1 random = 359 }
				}
				14 = {
					modifier = {
						add = -2
						check_variable = { which = years_not_trigger_parit_evt value >= 2 }
					}
					modifier = {
						add = -3
						check_variable = { which = years_not_trigger_parit_evt value >= 3 }
					}
					modifier = {
						add = -4
						check_variable = { which = years_not_trigger_parit_evt value >= 4 }
					}
					modifier = {
						add = -5
						check_variable = { which = years_not_trigger_parit_evt value >= 5 }
					}
					modifier = {
						factor = 0
						check_variable = { which = years_not_trigger_parit_evt value >= 10 }
					}
					change_variable = { which = years_not_trigger_parit_evt value = 1 }
				}
			}
		}
	}
}

country_event = {
	id = executor_build.279
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		is_ai = no
		has_origin = origin_parit
		has_communications = event_target:fallen_empire_kuat
		NOT = { is_hostile = event_target:fallen_empire_kuat }
	}
	immediate = {
		random_list = {
			5 = {
				modifier = {
					factor = 2
					is_at_war = yes
				}
				country_event = { id = executor_build.259 }
				change_variable = { which = num_resource_event value = 1 }
			}
			1 = {
				modifier = {
					add = 2
					is_at_war = yes
				}
				modifier = {
					factor = 3
					check_variable = { which = num_resource_event value > 10 }
				}
				modifier = {
					factor = 0
					OR = {
						mid_game_years_passed < 10
						check_variable = { which = num_battleship_event value > 10 }
					}
				}
				country_event = { id = executor_build.260 }
				change_variable = { which = num_battleship_event value = 1 }
			}
			1 = {
				modifier = {
					add = 2
					is_at_war = yes
				}
				modifier = {
					factor = 3
					check_variable = { which = num_resource_event value > 25 }
				}
				modifier = {
					factor = 4
					check_variable = { which = num_battleship_event value > 10 }
				}
				modifier = {
					factor = 0
					OR = {
						check_variable = { which = num_flagship_event value >= 1 }
						end_game_years_passed < 10
					}
				}
				country_event = { id = executor_build.261 }
				change_variable = { which = num_flagship_event value = 1 }
			}
		}
	}
}

country_event = {
	id = executor_build.259
	title = "executor_build.259.title"
	desc = "executor_build.259.desc"
	hide_window = no
	diplomatic = yes
	picture_event_data = {
		portrait = event_target:kuat_player_target_species
		planet_background = pc_ringworld_habitable
		graphical_culture = fallen_empire_01
		city_level = event_target:fallen_empire_kuat
		room = personality_fallen_empire_cyan_room
	}
	custom_gui = "kuat_event_diplomacy_window"
	custom_gui_option = "kuat_event_diplomacy_option"
	is_triggered_only = yes

	trigger = {
		exists = event_target:fallen_empire_kuat
		NOT = { is_at_war_with = event_target:fallen_empire_kuat }
	}

	option = {
		name = executor_build.259.a
		hidden_effect = {
			if = {
				limit = { NOT = { has_country_flag = only_communicate_once } }
				event_target:fallen_empire_kuat = {
					add_opinion_modifier = { who = root modifier = opinion_kuat_new_parit_finish_1 }
				}
				set_country_flag = only_communicate_once
			}
			random_list = {
				7 = { add_resource = { alloys = 5000 } }
				6 = { add_resource = { alloys = 6000 } }
				5 = { add_resource = { alloys = 6000 } }
				4 = { add_resource = { alloys = 10000 } }
				3 = { add_resource = { alloys = 25000 } }
				2 = { add_resource = { alloys = 30000 } }
				1 = { add_modifier = { modifier = country_production_for_parit days = 1800 } }
				1 = { add_modifier = { modifier = country_production_for_parit_default days = 1800 } }
			}
		}
	}
}

country_event = {
	id = executor_build.260
	title = "executor_build.260.title"
	desc = "executor_build.260.desc"
	hide_window = no
	diplomatic = yes
	picture_event_data = {
		portrait = event_target:kuat_player_target_species
		planet_background = pc_ringworld_habitable
		graphical_culture = fallen_empire_01
		city_level = event_target:fallen_empire_kuat
		room = personality_fallen_empire_cyan_room
	}
	custom_gui = "kuat_event_diplomacy_window"
	custom_gui_option = "kuat_event_diplomacy_option"
	is_triggered_only = yes
	trigger = {
		exists = event_target:fallen_empire_kuat
		NOT = { is_at_war_with = event_target:fallen_empire_kuat }
		event_target:fallen_empire_kuat = { opinion = { who = root value >= 150 } }
	}
	option = {
		name = "executor_build.260.a"
		hidden_effect = { create_fleet = {
			effect = {
				set_owner = prev
				while = { count = 3 create_ship = { design = "Name_boss_EMPIRE" } }
				add_modifier = { modifier = kuat_fleet_power }
				set_fleet_stance = aggressive
				set_fleet_bombardment_stance = indiscriminate
				set_location = prev.capital_scope
			}
		} }
	}
}

country_event = {
	id = executor_build.261
	title = "executor_build.261.title"
	desc = "executor_build.261.desc"
	hide_window = no
	diplomatic = yes
	picture_event_data = {
		portrait = event_target:kuat_player_target_species
		planet_background = pc_ringworld_habitable
		graphical_culture = fallen_empire_01
		city_level = event_target:fallen_empire_kuat
		room = personality_fallen_empire_cyan_room
	}
	custom_gui = "kuat_event_diplomacy_window"
	custom_gui_option = "kuat_event_diplomacy_option"
	is_triggered_only = yes
	trigger = {
		exists = event_target:fallen_empire_kuat
		NOT = { is_at_war_with = event_target:fallen_empire_kuat }
	}
	immediate = {
		create_fleet = {
			effect = {
				set_owner = prev
				create_ship = { design = "NAME_KUAT_Annihilator" }
				add_modifier = { modifier = kuat_fleet_power }
				set_location = prev.capital_scope
				set_fleet_stance = aggressive
				set_fleet_bombardment_stance = indiscriminate
			}
		}
		add_modifier = { modifier = ship_firing_default_for_parit days = 3600 }
	}
	option = { name = "executor_build.261.a" }
}

##########################
### Millatary base########
##########################
country_event = {
	id = executor_build.371
	hide_window = yes
	trigger = { exists = event_target:fallen_empire_kuat }
	is_triggered_only = yes
	fire_only_once = yes
	immediate = {
		create_kuat_fleet_country_type = yes
		if = {
			limit = { NOT = { has_global_flag = giga_has_host } }
			kuat_military_base_system_initial = yes
		}
		else = { random_system = {
			limit = { has_owner = no }
			set_spawn_system_batch = begin
			spawn_system = { initializer = kuat_base_system } 
			set_spawn_system_batch = end
		} }
		random_playable_country = {
			limit = { is_ai = no }
			country_event = { id = executor_build.372 }
		}
		every_playable_country = {
			limit = { is_ai = no }
			country_event = { id = executor_build.9 days = 30 }
		}
	}
}

country_event = {
	id = executor_build.372
	title = "executor_build.372.name"
	desc = "executor_build.372.desc"
	diplomatic = yes
	custom_gui = "kuat_event_diplomacy_window"
	custom_gui_option = "kuat_event_diplomacy_option"
	picture_event_data = {
		portrait = event_target:kuat_player_target_species
		room = kuat_mega_shipyard_room
	}
	is_triggered_only = yes
	immediate = { establish_communications_no_message = event_target:fallen_empire_kuat_fleet }
	option = { name = "executor_build.372.a" hidden_effect = { create_sol_kuat_military_gateway = { NUM = 8 } } }
	after = { every_megastructure = { limit = { has_megastructure_flag = can_active_gateway } activate_gateway = this } }
}

country_event = {
	id = executor_build.373
	title = "executor_build.373.name"
	desc = "executor_build.373.desc"
	diplomatic = yes
	picture_event_data = {
		portrait = event_target:kuat_player_target_species
		room = kuat_mega_shipyard_room
	}
	custom_gui = "kuat_event_diplomacy_shipyard_window"
	custom_gui_option = "kuat_event_diplomacy_shipyard_option"
	is_triggered_only = yes
	trigger = {
		is_ai = no
		can_communicate_with_kuat_fleet = yes
		OR = {
			kuat_fleet_diplo_event_active = no
			from = { is_same_value = root }
		}
		OR = {
			from = { is_same_value = root }
			from = { is_country_type = kuat_fleet }
			from = { is_country_type = kuat_fleet_hostile }
			from = { is_country_type = kuat_shipyard }
		}
	}
	option = {
		name = executor_build.373.trading
		trigger = {
			custom_tooltip = {
				fail_text = need_lower_than_100
				event_target:fallen_empire_kuat = { opinion = { who = root value < 1000 } }
			}
		}
		allow = {
			custom_tooltip = {
				fail_text = need_5000_alloys
				resource_stockpile_compare = { resource = energy value > 5000 }
			}
		}
		hidden_effect = {
			add_resource = { energy = -5000 }
			event_target:fallen_empire_kuat = {
				add_opinion_modifier = { modifier = opinion_kuat_buy_op_ship_credit who = root }
			}
		}
		response_text = executor_build.373.trading.a
		is_dialog_only = yes
	}
	option = {
		name = executor_build.373.hiring
		hidden_effect = { country_event = { id = executor_build.374 } }
	}
	option = {
		name = executor_build.373.back_shipyard
		hidden_effect = { country_event = { id = kuat_shipyard.1 } }
		default_hide_option = yes
	}
	option = { name = executor_build.373.back }
}

country_event = {
	id = executor_build.374
	is_triggered_only = yes
	title = "executor_build.374.title"
	desc = "executor_build.374.desc"
	diplomatic = yes
	picture_event_data = {
		portrait = event_target:kuat_player_target_species
		room = kuat_mega_shipyard_room
	}
	custom_gui = "kuat_event_diplomacy_shipyard_window"
	custom_gui_option = "kuat_event_diplomacy_shipyard_option"
	trigger = {
		is_ai = no
		can_communicate_with_kuat_fleet = yes
	}
	option = {
		name = "executor_build_hiring_eclipse.374"
		allow = {
			custom_tooltip = {
				fail_text = executor_build.374.a
				event_target:fallen_empire_kuat = { opinion = { who = root value > 100 } }
			}
			custom_tooltip = {
				fail_text = executor_build.374.b
				mid_game_years_passed > 0
			}
			custom_tooltip = {
				fail_text = executor_build.374.c
				check_variable = { which = num_hiring_eclipse value < 1 }
			}
			resource_stockpile_compare = { resource = energy value > 500000 }
		} 
		hidden_effect = {
			add_resource = { energy = -500000 }
			save_event_target_as = hiring_country_eclipse
			change_variable = { which = num_hiring_eclipse value = 1 }
			create_message = {
				type = "SPACEPORT_CONSTRUCTION_MESSAGE_TYPE"
				localization = "kuat_hiring_arrived_desc"
				days = 30
				target = from
				variable = {
					type = name
					localization = "capital_planet"
					scope = root.capital_scope
				}
			}
			create_fleet = {
				name = "Name_DFLEET"
				effect = {
					set_owner = event_target:fallen_empire_kuat_fleet
					create_ship = { design = "Name_boss_eclipse" }
					while = { count = 48 create_ship = { design = "Name_boss_EMPIRE" } }
					set_location = prev.capital_scope
					set_fleet_flag = will_be_return_eclipse
					save_event_target_as = return_eclipse_fleet
					set_fleet_stance = aggressive
					set_fleet_bombardment_stance = indiscriminate
					root = { country_event = { id = executor_build.386 days = 3600 } }
				}
				settings = { is_boss = yes can_disband = no spawn_debris = no can_change_composition = no }
			}
			event_target:return_eclipse_fleet = { give_fleet = { controller = root days = 3600 } }
		}
	}
	option = {
		name = "executor_build.374.hiring"
		allow = {
			custom_tooltip = {
				fail_text = executor_build.374.a
				event_target:fallen_empire_kuat = { opinion = { who = root value > 100 } }
			}
			custom_tooltip = {
				fail_text = executor_build.375.b
				OR = {
					AND = {
						is_at_war = yes
						NOT = { is_at_war_with = event_target:fallen_empire_kuat }
					}
					kuat_is_defense_galaxy_fleet = yes
				}
			}
			custom_tooltip = {
				fail_text = executor_build.375.c
				check_variable = { which = num_hiring value < 1 }
			}
			resource_stockpile_compare = { resource = energy value > 200000 }
		} 
		hidden_effect = {
			add_resource = { energy = -200000 }
			save_event_target_as = hiring_country
			change_variable = { which = num_hiring value = 1 }
			create_message = {
				type = "SPACEPORT_CONSTRUCTION_MESSAGE_TYPE"
				localization = "kuat_hiring_arrived_desc"
				days = 30
				target = from
				variable = {
					type = name
					localization = "capital_planet"
					scope = root.capital_scope
				}
			}
			create_fleet = {
				name = "Name_DFLEET"
				effect = {
					set_owner = event_target:fallen_empire_kuat_fleet
					while = { count = 50 create_ship = { design = "Name_boss_EMPIRE" } }
					set_location = prev.capital_scope
					set_fleet_flag = will_be_return
					save_event_target_as = return_fleet
					set_fleet_stance = aggressive
					set_fleet_bombardment_stance = indiscriminate
					root = { country_event = { id = executor_build.376 days = 3600 } }
				}
				settings = { is_boss = yes can_disband = no spawn_debris = no can_change_composition = no }
			}
			event_target:return_fleet = { give_fleet = { controller = root days = 3600 } }
		}
	}
	option = {
		name = executor_build.373.back
		default_hide_option = yes
	}
}

country_event = {
	id = executor_build.376
	diplomatic = yes
	title = "executor_build.376.title"
	desc = "executor_build.376.desc"
	picture_event_data = {
		portrait = event_target:kuat_player_target_species
		room = kuat_mega_shipyard_room
	}
	custom_gui = "kuat_event_diplomacy_window"
	custom_gui_option = "kuat_event_diplomacy_option"
	is_triggered_only = yes
	option = {
		name = executor_build.376.a
		event_target:return_fleet = { destroy_fleet = { target = this destroy_template = yes kill_leader = no } }
		event_target:hiring_country = { clear_variable = num_hiring }
	}
}

country_event = {
	id = executor_build.386
	diplomatic = yes
	title = "executor_build.376.title"
	desc = "executor_build.376.desc"
	picture_event_data = {
		portrait = event_target:kuat_player_target_species
		room = kuat_mega_shipyard_room
	}
	custom_gui = "kuat_event_diplomacy_window"
	custom_gui_option = "kuat_event_diplomacy_option"
	is_triggered_only = yes
	option = {
		name = executor_build.376.a
		event_target:return_eclipse_fleet = { destroy_fleet = { target = this destroy_template = yes kill_leader = no } }
		event_target:hiring_country_eclipse = { clear_variable = num_hiring_eclipse }
	}
}

country_event = {
	id = executor_build.3761
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		fromfrom = {
			OR = {
				has_fleet_flag = will_be_return
				has_fleet_flag = will_be_return_eclipse
			}
		}
	}
	immediate = {
		if = {
			limit = { fromfrom = { has_fleet_flag = will_be_return } }
			event_target:hiring_country = { clear_variable = num_hiring }
		}
		if = {
			limit = { fromfrom = { has_fleet_flag = will_be_return_eclipse } }
			event_target:hiring_country_eclipse = { clear_variable = num_hiring_eclipse }
		}
	}
}

country_event = {
	id = executor_build.377
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		exists = event_target:fallen_empire_kuat
		from = {
			count_owned_fleet = {
				count = 0
				limit = { has_fleet_flag = kuat_fundation_main_fleet NOT = { is_same_value = root.fromfromfrom } }
			}
			is_country_type = kuat_fleet
		}
	}

	immediate = { from = { destroy_country = yes } country_event = { id = executor_build.378 } }
}

country_event = {
	id = executor_build.378
	diplomatic = yes
	title = executor_build.378.title
	desc = executor_build.378.desc
	picture_event_data = {
		portrait = event_target:kuat_player_target_species
		room = kuat_mega_shipyard_room
	}
	custom_gui = "kuat_event_diplomacy_window"
	custom_gui_option = "kuat_event_diplomacy_option"
	is_triggered_only = yes
	immediate = { save_event_target_as = target_for_kuat }
	option = {
		name = executor_build.378.a
		event_target:fallen_empire_kuat = { 
			add_opinion_modifier = { who = prevprev modifier = opinion_mutual_threat_kuat_fleet } 
			country_event = { id = executor_build.7 days = 3 }
		}
	}
}

event = {
	id = executor_build.375
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		NOT = { exists = event_target:fallen_empire_kuat }
		exists = event_target:fallen_empire_kuat_fleet
	}
	immediate = { event_target:fallen_empire_kuat_fleet = { destroy_country = yes } }
}

country_event = {
	id = executor_build.28
	hide_window = no
	is_triggered_only = yes
	title = executor_build.378.title
	desc = executor_build.28.desc
	diplomatic = yes
	picture_event_data = { room = fallen_empire_room }
	custom_gui = "kuat_event_m_window"
	custom_gui_option = "kuat_event_m_option"
	trigger = { NOT = { has_country_flag = fire_once_setting } }
	immediate = { every_playable_country = {
		begin_event_chain = { event_chain = kuat_mission_6_chain target = this }
	} }
	option = {
		name = executor_build.28.A
		hidden_effect = { country_event = { id = executor_build.28 } }
	}
	option = {
		name = executor_build.28.B
		hidden_effect = { set_country_flag = fire_once_setting }
	}
}

country_event = {
	id = executor_build.29
	hide_window = yes
	is_triggered_only = yes
	trigger = { is_ai = no }
	immediate = { 
		set_update_modifiers_batch = begin
		if = {
			limit = { 
				NOT = { command_limit = 4000 }
				exists = event_target:ag_kuat_invasion_country 
				has_global_flag = ban_exe_invasion
				has_global_flag = enable_modifer_check
			}
			remove_modifier = basic_country_command_limit_add
			remove_modifier = iep_basic_country_command_limit_mult
			remove_modifier = iep_basic_country_command_limit_add
		}
		else_if = {
			limit = { command_limit > 800 }
			remove_modifier = basic_country_command_limit_add
			remove_modifier = iep_basic_country_command_limit_mult
			remove_modifier = iep_basic_country_command_limit_add
		}
		country_event = { id = executor_build.293 days = 1 } 
		set_update_modifiers_batch = end
	}
}

country_event = {
	id = executor_build.293
	hide_window = yes
	is_triggered_only = yes
	trigger = { is_ai = no }
	immediate = { 
		set_update_modifiers_batch = begin
		set_country_flag = executor_build_command_limit_running
		if = {
			limit = { 
				NOT = { command_limit = 4000 }
				exists = event_target:ag_kuat_invasion_country 
				has_global_flag = ban_exe_invasion
				has_global_flag = enable_modifer_check
			}
			clear_ship_modifier = { modifier = country_command_limit_mult DAYS = -1 }
			clear_ship_modifier = { modifier = country_command_limit_add DAYS = -1 }
			country_event = { id = executor_build.291 days = 1 }
			country_event = { id = executor_build.29 days = 180 }
		}
		else_if = {
			limit = { command_limit > 800 }
			clear_ship_modifier = { modifier = country_command_limit_mult DAYS = -1 }
			clear_ship_modifier = { modifier = country_command_limit_add DAYS = -1 }
			country_event = { id = executor_build.291 days = 1 }
			country_event = { id = executor_build.29 days = 30 }
		}
		else = { country_event = { id = executor_build.29 days = 360 } }
		set_update_modifiers_batch = end
	}
}

country_event = {
	id = executor_build.291
	hide_window = yes
	is_triggered_only = yes
	trigger = { is_ai = no }
	immediate = {
		set_update_modifiers_batch = begin
		if = {
			limit = { 
				exists = event_target:ag_kuat_invasion_country
				has_global_flag = ban_exe_invasion
				has_global_flag = enable_modifer_check
				NOT = { check_modifier_value = { modifier = country_command_limit_add value = 3980 } }
			}
			export_modifier_to_variable = { modifier = country_command_limit_add variable = country_command_limit_add_value }
			subtract_variable = { which = country_command_limit_add_value value = 3980 }
			set_invasion_fleet_basic_modifier = { SUB = basic_country_command_limit_add FACTOR = country_command_limit_add_value DAYS = -1 }
			if = { limit = { is_variable_set = country_command_limit_add_value } clear_variable = country_command_limit_add_value }
		}
		else_if = {
			limit = { NOT = { check_modifier_value = { modifier = country_command_limit_add value = 780 } } }
			export_modifier_to_variable = { modifier = country_command_limit_add variable = country_command_limit_add_value }
			subtract_variable = { which = country_command_limit_add_value value = 780 }
			set_invasion_fleet_basic_modifier = { SUB = basic_country_command_limit_add FACTOR = country_command_limit_add_value DAYS = -1 }
			if = { limit = { is_variable_set = country_command_limit_add_value } clear_variable = country_command_limit_add_value }
		}
		set_update_modifiers_batch = end
	}
}

country_event = {
	id = executor_build.292
	hide_window = yes
	is_triggered_only = yes
	trigger = { 
		has_origin = origin_eternalthrone 
		kuat_is_forbidden_ee_production_var = no
	}
	immediate = { 
		set_update_modifiers_batch = begin
		every_owned_planet = {
			if = {
				limit = { 
					OR = {
						NOT = { is_variable_set = building_producation_index }
						NOT = { check_variable = { which = building_producation_index value = trigger:num_pops } }
					}
					NOT = { has_planet_flag = PR_flg_plnt_ASCENDED }
				}
				set_variable = { which = building_producation_index value = trigger:num_pops }
			}
			else_if = {
				limit = { 
					has_planet_flag = PR_flg_plnt_ASCENDED 
					OR = {
						NOT = { is_variable_set = building_producation_index }
						NOT = { check_variable = { which = building_producation_index value = PR_var_plnt_HC } }
					}
				}
				set_variable = { which = building_producation_index value = PR_var_plnt_HC }
			}
		} 
		set_update_modifiers_batch = end
	}
}


planet_event = {
	id = executor_build.294
	title = "executor_build.294.title"
	desc = "executor_build.294.desc"
	diplomatic = yes
	picture_event_data = { room = clocks_room }
	custom_gui = "kuat_event_m_window"
	custom_gui_option = "kuat_event_m_option"
	is_triggered_only = yes
	pre_triggers = {
		has_owner = yes
	}
	trigger = { 
		has_planet_flag = colonied_eternal_ringworld
		NOT = { has_planet_flag = colonied_eternal_ringworld_over }
		is_planet_class = pc_kuat_eternal_ringworld_habitable 
		owner = { has_origin = origin_eternalthrone }
	}
	immediate = { set_planet_flag = colonied_eternal_ringworld_over }
	option = {
		name = executor_build.294.a
		hidden_effect = { while = { limit = { free_district_slots > 1 } add_district = district_arcology_kuat_housing } }
	}
	option = {
		name = executor_build.294.b
		hidden_effect = { while = { limit = { free_district_slots > 1 } add_district = district_arcology_kuat_Military } }
	}
	option = {
		name = executor_build.294.c
		hidden_effect = { while = { limit = { free_district_slots > 1 } add_district = district_arcology_kuat_science } }
	}
	option = {
		name = executor_build.294.d
		hidden_effect = { while = { limit = { free_district_slots > 1 } add_district = district_arcology_kuat_Khaydarin } }
	}
	option = {
		name = executor_build.294.e
		hidden_effect = { while = { limit = { free_district_slots > 1 } add_district = district_arcology_Kuat_civilian_industry } }
	}
	option = {
		name = executor_build.294.f
		hidden_effect = { while = { limit = { free_district_slots > 1 } add_district = district_arcology_eternal_Khaydarin } }
	}
}

planet_event = {
	id = executor_build.295
	hide_window = yes
	is_triggered_only = yes
	trigger = { has_planet_flag = enable_kuat_shield }
	immediate = {
		solar_system = {
			random_system_ambient_object = {
				limit = {
					has_ambient_object_flag = kuat_planet_shield_effect_object_@root
				}
				destroy_ambient_object = this
			}
		}
		remove_planet_flag = enable_kuat_shield
		set_timed_planet_flag = { flag = enable_kuat_shield_cooldown days = 1800 }
	}
}