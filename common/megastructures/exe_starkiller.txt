kuat_starkillerbase_0 = {
	entity = "construction_platform_entity"
	construction_entity = "construction_platform_entity"
	portrait = "GFX_megastructure_starkiller_background1"
	construction_blocks_others = yes
	potential = { always = no }
	station_modifier = { starbase_shipyard_capacity_add = 5 }
	ai_weight = { factor = 0 }
}

kuat_starkillerbase_0_1 = {
	entity = "starkillerbase_megastructure_entity"
	construction_entity = "starkillerbase_megastructure_entity"
	portrait = "GFX_megastructure_starkiller_background2"
	construction_blocks_others = yes
	upgrade_from = { kuat_starkillerbase_0 }
	build_time = 3600
	resources = {
		category = megastructures
		cost = {
			alloys = 15000
			influence = 500
			minerals = 20000
		}
		upkeep = { energy = 15 }
	}
	station_modifier = { starbase_shipyard_capacity_add = 10 }
	ai_weight = { factor = 0 }
}

kuat_starkillerbase_0_2 = {
	entity = "starkillerbase_megastructure_entity"
	construction_entity = "starkillerbase_megastructure_entity"
	portrait = "GFX_megastructure_starkiller_background3"
	construction_blocks_others = yes
	upgrade_from = { kuat_starkillerbase_0_1 }
	build_time = 10800
	resources = {
		category = megastructures
		cost = { alloys = 30000 }
		upkeep = { energy = 25 }
	}
	station_modifier = { starbase_shipyard_capacity_add = 15 }
	ai_weight = { factor = 0 }
}

kuat_starkillerbase_1 = {
	entity = "starkillerbase_megastructure_entity"
	construction_entity = "starkillerbase_megastructure_entity"
	portrait = "GFX_megastructure_starkiller_background4"
	construction_blocks_others = no
	upgrade_from = { kuat_starkillerbase_0_2 }
	build_time = 5400
	resources = {
		category = megastructures
		cost = { alloys = 35000 }
		upkeep = { energy = 150 }
	}
	station_modifier = { starbase_shipyard_capacity_add = 20 }
	on_build_start = { }
	on_build_cancel = { }
	on_build_complete = { }
}

kuat_starkillerbase_15 = {
	entity = "starkillerbase_megastructure_entity"
	construction_entity = "starkillerbase_megastructure_entity"
	portrait = "GFX_megastructure_starkiller_background4"
	construction_blocks_others = no
	upgrade_from = { kuat_starkillerbase_1 }
	build_time = 1
	resources = {
		category = megastructures
		cost = { sr_dark_matter = 5000 }
	}
	potential = { NOT = { has_global_flag = starkillerbase_not_passed } }
	on_build_start = { }
	on_build_cancel = { }
	on_build_complete = {
		set_star_flag = rebuild_soon
		from = {
			set_country_flag = kuat_enabled_epsilon_planet_killer_selector
			country_event = { id = kuat_system_selector.1 }
		}
		fromfrom.planet = { set_planet_flag = buildingsoon }
	}
}

kuat_starkillerbase_2 = {
	entity = "starkillerbase_firing_entity"
	construction_entity = "starkillerbase_megastructure_entity"
	portrait = "GFX_megastructure_construction_background"
	construction_blocks_others = no
	upgrade_desc = hide
	upgrade_from = { kuat_starkillerbase_15 }
	build_time = 1
	resources = {
		category = megastructures
		cost = { sr_dark_matter = 5000 }
	}
	potential = { always = no }
	on_build_start = { }
	on_build_cancel = { }
	on_build_complete = { }
}

kuat_starkillerbase_a = {
	entity = "starkillerbase_megastructure_entity"
	construction_entity = "starkillerbase_megastructure_entity"
	portrait = "GFX_megastructure_construction_background"
	construction_blocks_others = no
	build_time = 0
	potential = { always = no }
	possible = { }
	on_build_start = { }
	on_build_cancel = { }
	on_build_complete = { }
}

##############Target Marker - PLANET############
kuat_starkiller_marker_0 = {
	entity = "starkiller_market_entity"
	construction_entity = "starkiller_market_entity"
	portrait = "GFX_megastructure_construction_background"
	entity_offset = { x = 0 y = 0 }
	upgrade_desc = hide
	build_time = 0
	resources = {
		category = megastructures
		cost = {
			energy = 10000
			influence = 200
		}
	}
	potential = { always = no }
	ai_weight = { factor = 0 }
	on_build_start = { }
	on_build_cancel = { }
	on_build_complete = { }
}

kuat_starkiller_marker_0_1 = {
	entity = "starkiller_market_entity"
	construction_entity = "starkiller_market_entity"
	portrait = "GFX_megastructure_construction_background"
	upgrade_desc = hide
	entity_offset = { x = 0 y = 0 }
	build_time = 0
	resources = {
		category = megastructures
		cost = {
			energy = 10000
			influence = 200
		}
	}
	potential = { always = no }
	ai_weight = { factor = 0 }
	on_build_start = { }
	on_build_cancel = { }
	on_build_complete = { }
}

#######################################Wormhole over planet
kuat_starkiller_marker_1 = {
	entity = "starkillerbase_target_portal_entity"
	construction_entity = ""
	portrait = "GFX_megastructure_construction_background"
	construction_blocks_others = no
	entity_offset = { x = 0 y = 0 }
	build_time = 0
	upgrade_desc = hide
	upgrade_from = { kuat_starkiller_marker_0 }
	potential = { always = no }
	possible = { }
	ai_weight = { weight = 0 }
	on_build_start = { }
	on_build_cancel = { }
	on_build_complete = { }
}

kuat_starkiller_marker_1_1 = {
	entity = "starkillerbase_target_portal_entity"
	construction_entity = ""
	portrait = "GFX_megastructure_construction_background"
	construction_blocks_others = no
	entity_offset = { x = 0 y = 0 }
	build_time = 0
	upgrade_desc = hide
	upgrade_from = { kuat_starkiller_marker_0_1 }
	potential = { always = no }
	possible = { }
	ai_weight = { weight = 0 }
	on_build_start = { }
	on_build_cancel = { }
	on_build_complete = { }
}

#######################################Starkiller fire in planet
kuat_starkiller_marker_2 = {
	entity = "starkillerbsae_target_portal_beam_entity"
	construction_entity = ""
	portrait = "GFX_megastructure_construction_background"
	entity_offset = { x = 0 y = 0 }
	build_time = 0
	upgrade_from = { kuat_starkiller_marker_1 }
	upgrade_desc = hide
	potential = { always = no }
	possible = { }
	ai_weight = { weight = 0 }
	on_build_complete = { }
}

kuat_starkiller_marker_2_1 = {
	entity = "starkillerbsae_target_star_portal_beam_entity"
	construction_entity = ""
	portrait = "GFX_megastructure_construction_background"
	entity_offset = { x = 0 y = 0 }
	build_time = 0
	upgrade_from = { kuat_starkiller_marker_1_1 }
	upgrade_desc = hide
	potential = { always = no }
	possible = { }
	ai_weight = { weight = 0 }
	on_build_complete = { }
}


############################################################
kuat_sun_drain = {
	entity = "starkiller_sun_drain_entity"
	construction_entity = ""
	portrait = "GFX_megastructure_construction_background"
	build_time = 0
	upgrade_desc = hide
	potential = { always = no }
	possible = { }
	ai_weight = { weight = 0 }
	on_build_start = { }
	on_build_cancel = { }
	on_build_complete = { fromfrom.planet = { set_planet_flag = sunflaglocation } }
}

@entity_x = 0
@entity_y = 0
#############################################################
kuat_epsilon_obelisk_0 = {
	entity = "ag_epsilon_obelisk_base_closed_hull_entity"
	construction_entity = "starforge_avoid_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = yes
	show_galactic_map_icon = no
	
	build_time = 0
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	
	potential = { always = no }
	construction_blocked_by_others = no
	construction_blocks_others = no
	ai_weight = { weight = 0 }
}
kuat_epsilon_obelisk_1 = {
	entity = "ag_epsilon_obelisk_base_0_hull_entity"
	construction_entity = "starforge_avoid_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = yes
	show_galactic_map_icon = no
	
	build_time = 0
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	upgrade_from = { kuat_epsilon_obelisk_0 }
	
	potential = { always = no }
	construction_blocked_by_others = no
	construction_blocks_others = no
	ai_weight = { weight = 0 }
}
kuat_epsilon_obelisk_2 = {
	entity = "starforge_avoid_entity"
	construction_entity = "starforge_avoid_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = yes
	show_galactic_map_icon = no
	
	build_time = 20
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	upgrade_from = { kuat_epsilon_obelisk_1 }

	resources = {
		category = megastructures
		cost = { energy = 500 sr_dark_matter = 100 }
	}
	
	potential = {
		exists = owner
		owner = { NOT = { has_country_flag = kuat_epsilon_31_actived } }
	}

	construction_blocked_by_others = no
	construction_blocks_others = no

	on_build_complete = {
		fromfrom = {
			switch = {
				trigger = has_megastructure_flag
				ag_epsilon_obelisk_1 = { root.from = { set_country_flag = kuat_epsilon_obelisk_1_flag } }
				ag_epsilon_obelisk_2 = { root.from = { set_country_flag = kuat_epsilon_obelisk_2_flag } }
				ag_epsilon_obelisk_3 = { root.from = { set_country_flag = kuat_epsilon_obelisk_3_flag } }
			}
		}
		from = { set_country_flag = kuat_epsilon_31_actived country_event = { id = kuat_epsilon.31 } }
		spawn_megastructure = {
			type = kuat_epsilon_obelisk_1
			coords_from = fromfrom
			owner = from
			init_effect = {
				if = {
					limit = { root.fromfrom = { has_megastructure_flag = kuat_epsilon_obelisk_1 } }
					set_megastructure_flag = kuat_epsilon_obelisk_1
				}
				else_if = {
					limit = { root.fromfrom = { has_megastructure_flag = kuat_epsilon_obelisk_2 } }
					set_megastructure_flag = kuat_epsilon_obelisk_2
				}
				else_if = {
					limit = { root.fromfrom = { has_megastructure_flag = kuat_epsilon_obelisk_3 } }
					set_megastructure_flag = kuat_epsilon_obelisk_3
				}
			}
		}
		remove_megastructure = fromfrom
	}

	ai_weight = { weight = 0 }
}
kuat_epsilon_obelisk_3 = {
	# Obelisk turn red.
	entity = "ag_epsilon_obelisk_base_1_hull_entity"
	construction_entity = "starforge_avoid_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = yes
	show_galactic_map_icon = no
	
	build_time = 0
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	upgrade_from = { kuat_epsilon_obelisk_2 }
	
	potential = { always = no }
	construction_blocked_by_others = no
	construction_blocks_others = no
	ai_weight = { weight = 0 }
}
kuat_epsilon_obelisk_4 = {
	# Obelisk opening.
	entity = "ag_epsilon_obelisk_base_activated_opening_entity"
	construction_entity = "starforge_avoid_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = yes
	show_galactic_map_icon = no
	
	build_time = 0
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	upgrade_from = { kuat_epsilon_obelisk_3 }
	
	potential = { always = no }
	construction_blocked_by_others = no
	construction_blocks_others = no
	ai_weight = { weight = 0 }
}
kuat_epsilon_obelisk_5 = {
	# Obelisk closing.
	entity = "ag_epsilon_obelisk_base_activated_closing_entity"
	construction_entity = "starforge_avoid_entity"
	portrait = "GFX_megastructure_construction_background"
	
	place_entity_on_planet_plane = yes
	show_galactic_map_icon = no
	
	build_time = 0
	upgrade_desc = hide
	entity_offset = { x = @entity_x y = @entity_y }
	upgrade_from = { kuat_epsilon_obelisk_4 }
	
	potential = { always = no }
	construction_blocked_by_others = no
	construction_blocks_others = no
	ai_weight = { weight = 0 }
}