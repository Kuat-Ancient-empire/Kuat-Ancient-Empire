# scope: ship
increase_executor_power = {
	if = {
		limit = { has_hp <= 1000000 }
		add_modifier = { modifier = increase_hp_5000000_times days = $DAYS$ }
	}
	else_if = {
		limit = { has_hp <= 2000000 }
		add_modifier = { modifier = increase_hp_4000000_times days = $DAYS$ }
	}
	else_if = {
		limit = { has_hp <= 3000000 }
		add_modifier = { modifier = increase_hp_3000000_times days = $DAYS$ }
	}
	else_if = {
		limit = { has_hp <= 4000000 }
		add_modifier = { modifier = increase_hp_2000000_times days = $DAYS$ }
	}
	else_if = {
		limit = { has_hp <= 10000000 }
		add_modifier = { modifier = increase_hp_1000000_times days = $DAYS$ }
	}
}

increase_ship_hp_effect_change = {
	if = {
		limit = { root.from = { ag_is_ancient_country = no } }
		every_owned_ship = {
			set_timed_ship_flag = { flag = is_invisiable_trigger days = $DAYS$ }
			increase_executor_power = { DAYS = $DAYS$ }
			ship_event = { id = exe_invasion.119 }
		}
	} else = {
		every_owned_ship = {
			set_timed_ship_flag = { flag = is_invisiable_trigger days = $DAYS$ }
			ship_event = { id = exe_invasion.119 }
		}
	}
	set_fleet_modifier = { SUB = Eternal_submit }
	remove_modifier = ship_firing_debuff_invisiable_protection
}

set_fromfromfrom_check_invsiable_time_flag = {
	ROOT.FROMFROMFROM = {
		add_modifier = { modifier = ship_firing_debuff_invisiable_protection days = $DAYS$ }
		set_timed_fleet_flag = { flag = ship_firing_debuff_invisiable_protection days = $DAYS$ } 
	}
}

# scope: fleet
set_eternal_fleet_mult_modifier = {
	#scope: fromfromfrom
	[[shield_penetration] if = {
		limit = { 
			NOT = { check_modifier_value = { modifier = $shield_penetration$ value = -1 } }
			NOT = { is_variable_set = $shield_penetration$_value }
		}
		export_modifier_to_variable = { modifier = $shield_penetration$ variable = $shield_penetration$_value }
		if = {
			limit = { is_variable_set = $shield_penetration$_value }
			change_variable = { which = $shield_penetration$_value value = 1 }
			set_ship_flag = has_$shield_penetration$
			if = {
				limit = { is_variable_set = $shield_penetration$_value has_ship_flag = has_$shield_penetration$ }
				set_invasion_fleet_basic_modifier = { SUB = basic_$shield_penetration$ FACTOR = $shield_penetration$_value }
				remove_ship_flag = has_$shield_penetration$
			}
		}
	}]
	[[armor_penetration] if = {
		limit = { 
			NOT = { check_modifier_value = { modifier = $armor_penetration$ value = -1 } }
			NOT = { is_variable_set = $armor_penetration$_value }
		}
		export_modifier_to_variable = { modifier = $armor_penetration$ variable = $armor_penetration$_value }
		if = {
			limit = { is_variable_set = $armor_penetration$_value }
			change_variable = { which = $armor_penetration$_value value = 1 }
			set_ship_flag = has_$armor_penetration$
			if = {
				limit = { is_variable_set = $armor_penetration$_value has_ship_flag = has_$armor_penetration$ }
				set_invasion_fleet_basic_modifier = { SUB = basic_$armor_penetration$ FACTOR = $armor_penetration$_value }
				remove_ship_flag = has_$armor_penetration$
			}
		}
	}]
	[[armor_damage] if = {
		limit = { 
			check_modifier_value = { modifier = $armor_damage$ value > -0.75 } 
			NOT = { is_variable_set = $armor_damage$_value }
		}
		export_modifier_to_variable = { modifier = $armor_damage$ variable = $armor_damage$_value }
		if = {
			limit = { is_variable_set = $armor_damage$_value }
			change_variable = { which = $armor_damage$_value value = 0.75 }
			set_ship_flag = has_$armor_damage$
			if = {
				limit = { is_variable_set = $armor_damage$_value has_ship_flag = has_$armor_damage$ }
				set_invasion_fleet_basic_modifier = { SUB = basic_$armor_damage$ FACTOR = $armor_damage$_value }
				remove_ship_flag = has_$armor_damage$
			}
		}
	}]
	[[shield_damage] if = {
		limit = { 
			check_modifier_value = { modifier = $shield_damage$ value > -0.75 } 
			NOT = { is_variable_set = $shield_damage$_value }
		}
		export_modifier_to_variable = { modifier = $shield_damage$ variable = $shield_damage$_value }
		if = {
			limit = { is_variable_set = $shield_damage$_value }
			change_variable = { which = $shield_damage$_value value = 0.75 }
			set_ship_flag = has_$shield_damage$
			if = {
				limit = { is_variable_set = $shield_damage$_value has_ship_flag = has_$shield_damage$ }
				set_invasion_fleet_basic_modifier = { SUB = basic_$shield_damage$ FACTOR = $shield_damage$_value }
				remove_ship_flag = has_$shield_damage$
			}
		}
	}]
	[[hull_damage] if = {
		limit = { 
			check_modifier_value = { modifier = $hull_damage$ value > -0.75 } 
			NOT = { is_variable_set = $hull_damage$_value }
		}
		export_modifier_to_variable = { modifier = $hull_damage$ variable = $hull_damage$_value }
		if = {
			limit = { is_variable_set = $hull_damage$_value }
			change_variable = { which = $hull_damage$_value value = 0.75 }
			set_ship_flag = has_$hull_damage$
			if = {
				limit = { is_variable_set = $hull_damage$_value has_ship_flag = has_$hull_damage$ }
				set_invasion_fleet_basic_modifier = { SUB = basic_$hull_damage$ FACTOR = $hull_damage$_value }
				remove_ship_flag = has_$hull_damage$
			}
		}
	}]
	[[weapon_damage] if = {
		limit = { 
			check_modifier_value = { modifier = $weapon_damage$ value > -0.75 } 
			NOT = { is_variable_set = $weapon_damage$_value }
		}
		export_modifier_to_variable = { modifier = $weapon_damage$ variable = $weapon_damage$_value }
		if = {
			limit = { is_variable_set = $weapon_damage$_value }
			change_variable = { which = $weapon_damage$_value value = 0.75 }
			set_ship_flag = has_$weapon_damage$
			if = {
				limit = { is_variable_set = $weapon_damage$_value has_ship_flag = has_$weapon_damage$ }
				set_invasion_fleet_basic_modifier = { SUB = basic_$weapon_damage$ FACTOR = $weapon_damage$_value }
				remove_ship_flag = has_$weapon_damage$
			}
		}
	}]
	[[tracking] if = {
		limit = { 
			check_modifier_value = { modifier = $tracking$ value > -0.25 } 
			NOT = { is_variable_set = $tracking$_value }
		}
		export_modifier_to_variable = { modifier = $tracking$ variable = $tracking$_value }
		if = {
			limit = { is_variable_set = $tracking$_value }
			change_variable = { which = $tracking$_value value = 0.25 }
			set_ship_flag = has_$tracking$
			if = {
				limit = { is_variable_set = $tracking$_value has_ship_flag = has_$tracking$ }
				set_invasion_fleet_basic_modifier = { SUB = basic_$tracking$ FACTOR = $tracking$_value }
				remove_ship_flag = has_$tracking$
			}
		}
	}]
	##scope: fromfrom
	[[shield_penetration_own] if = {
		limit = { 
			check_modifier_value = { modifier = $shield_penetration_own$ value < 1 }
			NOT = { is_variable_set = $shield_penetration_own$_value }
		}
		export_modifier_to_variable = { modifier = $shield_penetration_own$ variable = $shield_penetration_own$_value }
		if = {
			limit = { is_variable_set = $shield_penetration_own$_value }
			subtract_variable = { which = $shield_penetration_own$_value value = 1 }
			set_ship_flag = has_$shield_penetration_own$
			if = {
				limit = { is_variable_set = $shield_penetration_own$_value has_ship_flag = has_$shield_penetration_own$ }
				set_invasion_fleet_basic_modifier = { SUB = basic_$shield_penetration_own$ FACTOR = $shield_penetration_own$_value }
				remove_ship_flag = has_$shield_penetration_own$
			}
		}
	}]
	[[armor_penetration_own] if = {
		limit = { 
			check_modifier_value = { modifier = $armor_penetration_own$ value < 1 }
			NOT = { is_variable_set = $armor_penetration_own$_value }
		}
		export_modifier_to_variable = { modifier = $armor_penetration_own$ variable = $armor_penetration_own$_value }
		if = {
			limit = { is_variable_set = $armor_penetration_own$_value }
			subtract_variable = { which = $armor_penetration_own$_value value = 1 }
			set_ship_flag = has_$armor_penetration_own$
			if = {
				limit = { is_variable_set = $armor_penetration_own$_value has_ship_flag = has_$armor_penetration_own$ }
				set_invasion_fleet_basic_modifier = { SUB = basic_$armor_penetration_own$ FACTOR = $armor_penetration_own$_value }
				remove_ship_flag = has_$armor_penetration_own$
			}
		}
	}]
	[[weapon_damage_own] if = {
		limit = { 
			check_modifier_value = { modifier = $weapon_damage_own$ value < 0 } 
			NOT = { is_variable_set = $weapon_damage_own$_value }
		}
		export_modifier_to_variable = { modifier = $weapon_damage_own$ variable = $weapon_damage_own$_value }
		if = {
			limit = { is_variable_set = $weapon_damage_own$_value }
			subtract_variable = { which = $weapon_damage_own$_value value = 1 }
			set_ship_flag = has_$weapon_damage_own$
			if = {
				limit = { is_variable_set = $weapon_damage_own$_value has_ship_flag = has_$weapon_damage_own$ }
				set_invasion_fleet_basic_modifier = { SUB = basic_$weapon_damage_own$ FACTOR = $weapon_damage_own$_value }
				remove_ship_flag = has_$weapon_damage_own$
			}
		}
	}]
	[[hull_regen_add_perc] if = {
		limit = { 
			check_modifier_value = { modifier = $hull_regen_add_perc$ value < 0 } 
			NOT = { is_variable_set = $hull_regen_add_perc$_value }
		}
		export_modifier_to_variable = { modifier = $hull_regen_add_perc$ variable = $hull_regen_add_perc$_value }
		if = {
			limit = { is_variable_set = $hull_regen_add_perc$_value }
			subtract_variable = { which = $hull_regen_add_perc$_value value = 1 }
			set_ship_flag = has_$hull_regen_add_perc$
			if = {
				limit = { is_variable_set = $hull_regen_add_perc$_value has_ship_flag = has_$hull_regen_add_perc$ }
				set_invasion_fleet_basic_modifier = { SUB = basic_$hull_regen_add_perc$ FACTOR = $hull_regen_add_perc$_value }
				remove_ship_flag = has_$hull_regen_add_perc$
			}
		}
	}]
	[[armor_regen_add_perc] if = {
		limit = { 
			check_modifier_value = { modifier = $armor_regen_add_perc$ value < 0 } 
			NOT = { is_variable_set = $armor_regen_add_perc$_value }
		}
		export_modifier_to_variable = { modifier = $armor_regen_add_perc$ variable = $armor_regen_add_perc$_value }
		if = {
			limit = { is_variable_set = $armor_regen_add_perc$_value }
			subtract_variable = { which = $armor_regen_add_perc$_value value = 1 }
			set_ship_flag = has_$armor_regen_add_perc$
			if = {
				limit = { is_variable_set = $armor_regen_add_perc$_value has_ship_flag = has_$armor_regen_add_perc$ }
				set_invasion_fleet_basic_modifier = { SUB = basic_$armor_regen_add_perc$ FACTOR = $armor_regen_add_perc$_value }
				remove_ship_flag = has_$armor_regen_add_perc$
			}
		}
	}]
	[[shield_regen_add_perc] if = {
		limit = { 
			check_modifier_value = { modifier = $shield_regen_add_perc$ value < 0 } 
			NOT = { is_variable_set = $shield_regen_add_perc$_value }
		}
		export_modifier_to_variable = { modifier = $shield_regen_add_perc$ variable = $shield_regen_add_perc$_value }
		if = {
			limit = { is_variable_set = $shield_regen_add_perc$_value }
			subtract_variable = { which = $shield_regen_add_perc$_value value = 1 }
			set_ship_flag = has_$shield_regen_add_perc$
			if = {
				limit = { is_variable_set = $shield_regen_add_perc$_value has_ship_flag = has_$shield_regen_add_perc$ }
				set_invasion_fleet_basic_modifier = { SUB = basic_$shield_regen_add_perc$ FACTOR = $shield_regen_add_perc$_value }
				remove_ship_flag = has_$shield_regen_add_perc$
			}
		}
	}]
	[[hull_mult] if = {
		limit = { 
			check_modifier_value = { modifier = $hull_mult$ value < 0 } 
			NOT = { is_variable_set = $hull_mult$_value }
		}
		export_modifier_to_variable = { modifier = $hull_mult$ variable = $hull_mult$_value }
		if = {
			limit = { is_variable_set = $hull_mult$_value }
			subtract_variable = { which = $hull_mult$_value value = 1 }
			set_ship_flag = has_$hull_mult$
			if = {
				limit = { is_variable_set = $hull_mult$_value has_ship_flag = has_$hull_mult$ }
				set_invasion_fleet_basic_modifier = { SUB = basic_$hull_mult$ FACTOR = $hull_mult$_value }
				remove_ship_flag = has_$hull_mult$
			}
		}
	}]
	[[armor_mult] if = {
		limit = { 
			check_modifier_value = { modifier = $armor_mult$ value < 0 } 
			NOT = { is_variable_set = $armor_mult$_value }
		}
		export_modifier_to_variable = { modifier = $armor_mult$ variable = $armor_mult$_value }
		if = {
			limit = { is_variable_set = $armor_mult$_value }
			subtract_variable = { which = $armor_mult$_value value = 1 }
			set_ship_flag = has_$armor_mult$
			if = {
				limit = { is_variable_set = $armor_mult$_value has_ship_flag = has_$armor_mult$ }
				set_invasion_fleet_basic_modifier = { SUB = basic_$armor_mult$ FACTOR = $armor_mult$_value }
				remove_ship_flag = has_$armor_mult$
			}
		}
	}]
	[[shield_mult] if = {
		limit = { 
			check_modifier_value = { modifier = $shield_mult$ value < 0 } 
			NOT = { is_variable_set = $shield_mult$_value }
		}
		export_modifier_to_variable = { modifier = $shield_mult$ variable = $shield_mult$_value }
		if = {
			limit = { is_variable_set = $shield_mult$_value }
			subtract_variable = { which = $shield_mult$_value value = 1 }
			set_ship_flag = has_$shield_mult$
			if = {
				limit = { is_variable_set = $shield_mult$_value has_ship_flag = has_$shield_mult$ }
				set_invasion_fleet_basic_modifier = { SUB = basic_$shield_mult$ FACTOR = $shield_mult$_value }
				remove_ship_flag = has_$shield_mult$
			}
		}
	}]
	[[weapon_range_mult] if = {
		limit = { 
			check_modifier_value = { modifier = $weapon_range_mult$ value < 0 } 
			NOT = { is_variable_set = $weapon_range_mult$_value }
		}
		export_modifier_to_variable = { modifier = $weapon_range_mult$ variable = $weapon_range_mult$_value }
		if = {
			limit = { is_variable_set = $weapon_range_mult$_value }
			subtract_variable = { which = $weapon_range_mult$_value value = 1 }
			set_ship_flag = has_$weapon_range_mult$
			if = {
				limit = { is_variable_set = $weapon_range_mult$_value has_ship_flag = has_$weapon_range_mult$ }
				set_invasion_fleet_basic_modifier = { SUB = basic_$weapon_range_mult$ FACTOR = $weapon_range_mult$_value }
				remove_ship_flag = has_$weapon_range_mult$
			}
		}
	}]
	####BASICAL
	[[weapon_type_energy] if = {
		limit = { 
			check_modifier_value = { modifier = $weapon_type_energy$ value < 0 } 
			NOT = { is_variable_set = $weapon_type_energy$_value }
		}
		export_modifier_to_variable = { modifier = $weapon_type_energy$ variable = $weapon_type_energy$_value }
		if = {
			limit = { is_variable_set = $weapon_type_energy$_value }
			subtract_variable = { which = $weapon_type_energy$_value value = 1 }
			set_ship_flag = has_$weapon_type_energy$
			if = {
				limit = { is_variable_set = $weapon_type_energy$_value has_ship_flag = has_$weapon_type_energy$ }
				set_invasion_fleet_basic_modifier = { SUB = basical_$weapon_type_energy$ FACTOR = $weapon_type_energy$_value }
				remove_ship_flag = has_$weapon_type_energy$
			}
		}
	}]
	[[weapon_type_kinetic] if = {
		limit = { 
			check_modifier_value = { modifier = $weapon_type_kinetic$ value < 0 } 
			NOT = { is_variable_set = $weapon_type_kinetic$_value }
		}
		export_modifier_to_variable = { modifier = $weapon_type_kinetic$ variable = $weapon_type_kinetic$_value }
		if = {
			limit = { is_variable_set = $weapon_type_kinetic$_value }
			subtract_variable = { which = $weapon_type_kinetic$_value value = 1 }
			set_ship_flag = has_$weapon_type_kinetic$
			if = {
				limit = { is_variable_set = $weapon_type_kinetic$_value has_ship_flag = has_$weapon_type_kinetic$ }
				set_invasion_fleet_basic_modifier = { SUB = basical_$weapon_type_kinetic$ FACTOR = $weapon_type_kinetic$_value }
				remove_ship_flag = has_$weapon_type_kinetic$
			}
		}
	}]
	[[weapon_type_explosive] if = {
		limit = { 
			check_modifier_value = { modifier = $weapon_type_explosive$ value < 0 } 
			NOT = { is_variable_set = $weapon_type_explosive$_value }
		}
		export_modifier_to_variable = { modifier = $weapon_type_explosive$ variable = $weapon_type_explosive$_value }
		if = {
			limit = { is_variable_set = $weapon_type_explosive$_value }
			subtract_variable = { which = $weapon_type_explosive$_value value = 1 }
			set_ship_flag = has_$weapon_type_explosive$
			if = {
				limit = { is_variable_set = $weapon_type_explosive$_value has_ship_flag = has_$weapon_type_explosive$ }
				set_invasion_fleet_basic_modifier = { SUB = basical_$weapon_type_explosive$ FACTOR = $weapon_type_explosive$_value }
				remove_ship_flag = has_$weapon_type_explosive$
			}
		}
	}]
}

remove_eternal_fleet_mult_variable = {
	[[shield_penetration] clear_variable = $shield_penetration$_value ]
	[[armor_penetration] clear_variable = $armor_penetration$_value ]
	[[armor_damage] clear_variable = $armor_damage$_value ]
	[[shield_damage] clear_variable = $shield_damage$_value ]
	[[hull_damage] clear_variable = $hull_damage$_value ]
	[[weapon_damage] clear_variable = $weapon_damage$_value ]
	[[tracking] clear_variable = $tracking$_value]
	[[hull_regen_add_perc] clear_variable = $hull_regen_add_perc$_value ]
	[[armor_regen_add_perc] clear_variable = $armor_regen_add_perc$_value ]
	[[shield_regen_add_perc] clear_variable = $shield_regen_add_perc$_value ]
	[[hull_mult] clear_variable = $hull_mult$_value ]
	[[armor_mult] clear_variable = $armor_mult$_value ]
	[[shield_mult] clear_variable = $shield_mult$_value ]
	[[weapon_range_mult] clear_variable = $weapon_range_mult$_value ]
	[[shield_penetration_own] clear_variable = $shield_penetration_own$_value ]
	[[armor_penetration_own] clear_variable = $armor_penetration_own$_value ]
	[[weapon_damage_own] clear_variable = $weapon_damage_own$_value ]
	[[weapon_type_energy] clear_variable = $weapon_type_energy$_value ]
	[[weapon_type_explosive] clear_variable = $weapon_type_explosive$_value ]
	[[weapon_type_kinetic] clear_variable = $weapon_type_kinetic$_value ]
}

set_fleet_modifier = {
	add_modifier = { modifier = $SUB$ }
	set_fleet_flag = has_$SUB$
}

set_invasion_fleet_basic_modifier = {
	add_modifier = { modifier = $SUB$ multiplier = $FACTOR$ }
	prev = { set_fleet_flag = has_combat_modifier }
}

#fromfromfrom fleet
# exe_invasion_country_trigger = {
# 	if = {
# 		limit = { NOT = { has_fleet_flag = kill_leader_only_once } }
# 		set_timed_fleet_flag = { flag = kill_leader_only_once days = 2 }
# 		if = {
# 			limit = { owner = { ag_is_combat_country_trigger = yes } }
# 			if = {
# 				limit = { 
# 					owner = { 
# 						OR = {
# 							is_country_type = default 
# 							is_country_type = fallen_empire	
# 							is_country_type = default_ev
# 							is_country_type = awakened_fallen_empire
# 						}
# 					} 
# 				}
# 				random_list = {
# 					1 = {
# 						modifier = { factor = 0 root.from = { is_ai = yes } }
# 						modifier = { add = 1 has_global_flag = special_exe_invasion }
# 						exe_reset_invasion_leader = yes
# 					}
# 					1 = { }
# 				}
# 			}
# 			else_if = {
# 				limit = { 
# 					owner = { 
# 						OR = {
# 							is_country_type = afk_crisis_country
# 							is_country_type = wg_crisis_country
# 						}
# 					} 
# 				}
# 				random_list = {
# 					1 = {
# 						modifier = { add = 1 has_global_flag = special_exe_invasion }
# 						modifier = { factor = 0 owner = { is_country_type = wg_crisis_country } }
# 						exe_reset_invasion_leader = yes
# 					}
# 					1 = { }
# 				}
# 			}
# 		} 
# 		else = {
# 			prev.fromfrom = { add_modifier = { modifier = ship_firing_default_debuff_own days = 10 } }
# 			add_modifier = { modifier = ship_firing_debuff days = 10 }
# 			exe_reset_invasion_leader = yes
# 		}
# 	}
# }

# exe_reset_invasion_leader = {
# 	leader = { 
# 		save_event_target_as = is_interesting_leader 
# 		owner = {
# 			clone_leader = {
# 				target = event_target:is_interesting_leader
# 				class = admiral
# 				effect = { save_event_target_as = cloner_leader set_owner = event_target:receves_leader_country }
# 			}
# 		}
# 	} 
# 	root.fromfrom = { 
# 		if = {
# 			limit = { NOT = { exists = leader } }
# 			assign_leader = event_target:cloner_leader
# 		}
# 		else_if = {
# 			limit = { owner = { any_owned_fleet = { NOT = { exists = leader } } } }
# 			owner = {
# 				random_owned_fleet = {
# 					limit = { NOT = { exists = leader } }
# 					assign_leader = event_target:cloner_leader
# 				}
# 			}
# 		} else = {
# 			leader = { kill_leader = { type = admiral show_notification = no } }
# 			assign_leader = event_target:cloner_leader
# 		}
# 	}
# 	owner = { country_event = { id = exe_invasion.129 } }
# }