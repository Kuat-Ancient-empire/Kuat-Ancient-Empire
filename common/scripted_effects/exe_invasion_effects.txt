#Etenal fleet invasion AI
ag_exe_spawn_outer_gate_fallback = {
	optimize_memory
	event_target:exe_invasion_outer_gate_spawn_system = {
		spawn_system = {
			initializer = "exe_invasion_fallback_init"
			min_distance >= 30
			max_distance <= 15
		}
	}
	random_system = {
		limit = { has_star_flag = ag_exe_invasion_gate_system_fallback }
		every_system = {
			limit = {
				NOR = {
					has_star_flag = Kuat_system
					has_star_flag = Kuat_system_1
					has_star_flag = Kuat_system_2
					has_star_flag = Kuat_system_3
					is_same_value = prev
					has_hyperlane_to = prev
				}
				distance = {
					source = prev
					min_distance >= 0
					max_distance <= 30
					type = euclidean
					use_bypasses = no
				}
			}
			random_list = {
				40 = { }
				60 = { add_hyperlane = { from = this to = prev } }
			}
		}
	}
}

ag_exe_invasion_fleet_wandering_action = {
	optimize_memory
	clear_orders = yes
	clear_fleet_actions = this
	random_list = {
		75 = {
			solar_system = {
				random_neighbor_system = {
					save_event_target_as = ag_exe_invasion_fleet_wandering_action_target
				}
			}
			if = {
				limit = { exists = event_target:ag_exe_invasion_fleet_wandering_action_target }
				event_target:ag_exe_invasion_fleet_wandering_action_target = {
					system_star = { prevprev = { auto_move_to_planet = { target = prev clear_auto_move_on_arrival = yes } } }
				}
			} else = { fleet_event = { id = exe_invasion.12 days = 32 random = 5 } }
		}
		25 = {
			modifier = { 
				factor = 0 
				any_owned_ship = { has_ship_flag = ag_jump_drive_cooldown } 
			}
			random_system = {
				limit = {
					NOR = { 
						has_star_flag = kuat_starbase_megastructure_in_system
						has_star_flag = kuat_initial_system 
						has_star_flag = myst_system_4
						is_same_value = prev.solar_system
					}
					OR = {
						AND = {
							exists = starbase
							starbase = { exists = owner owner = { is_hostile = event_target:eternal_fleet_country } }
						}
						any_system_planet = {
							exists = owner
							owner = { is_hostile = event_target:eternal_fleet_country }
							exists = controller
							controller = { is_hostile = event_target:eternal_fleet_country }
							OR = {
								is_colony = yes
								is_under_colonization = yes
							}
							NOT = { any_fleet_in_orbit = {
								exists = owner
								owner = { is_same_value = event_target:eternal_fleet_country }
								NOT = { is_same_value = root }
							} }
						}
						any_ship_in_system = {
							is_disabled = no
							is_ship_class = shipclass_military
							exists = owner
							owner = { is_hostile = event_target:eternal_fleet_country }
						}
					}
				}
				save_event_target_as = ag_exe_invasion_fleet_wandering_action_target
			}
			if = {
				limit = { exists = event_target:ag_exe_invasion_fleet_wandering_action_target }
				event_target:ag_exe_invasion_fleet_wandering_action_target = {
					random_system_planet = {
						limit = { is_primary_star = yes }
						prevprev = {
							set_location = { target = prev distance = 300 angle = random }
							every_owned_ship = { create_jump_particle_effect = yes }
							while = {
								limit = {
									any_owned_ship = { NOT = { has_ship_flag = ag_jump_drive_cooldown } }
								}
								random_owned_ship = {
									limit = {
										NOT = { has_ship_flag = ag_jump_drive_cooldown }
									}
									set_timed_ship_flag = { flag = ag_jump_drive_cooldown days = 50 }
									add_modifier = { modifier = "jump_drive_cooldown" days = 50 }
								}
							}
							auto_move_to_planet = { target = prev clear_auto_move_on_arrival = yes }
						}
					}
				}
			} else = {
				solar_system = {
					random_neighbor_system = {
						save_event_target_as = ag_exe_invasion_fleet_wandering_action_target
					}
				}
				if = {
					limit = { exists = event_target:ag_exe_invasion_fleet_wandering_action_target }
					event_target:ag_exe_invasion_fleet_wandering_action_target = {
						random_system_planet = {
							limit = { is_primary_star = yes }
							prevprev = { auto_move_to_planet = { target = prev clear_auto_move_on_arrival = yes } }
						}
					}
				} 
				else = { fleet_event = { id = exe_invasion.12 days = 32 random = 5 } }
			}
		}
	}
}

ag_exe_invasion_fleet_action = {
	optimize_memory
	if = {
		limit = {
			root = {
				exists = solar_system
				solar_system = {
					any_system_planet = {
						exists = owner
						owner = { is_hostile = event_target:eternal_fleet_country }
						exists = controller
						controller = { is_hostile = event_target:eternal_fleet_country }
						OR = {
							is_colony = yes
							is_under_colonization = yes
						}
						NOT = { any_fleet_in_orbit = {
							exists = owner
							owner = { is_same_value = event_target:eternal_fleet_country }
							NOT = { is_same_value = root }
						} }
					}
				}
			}
		}
		root = {
			solar_system = {
				random_system_planet = {
					limit = {
						exists = owner
						owner = { is_hostile = event_target:eternal_fleet_country }
						exists = controller
						controller = { is_hostile = event_target:eternal_fleet_country }
						OR = {
							is_colony = yes
							is_under_colonization = yes
						}
						NOT = { any_fleet_in_orbit = {
							exists = owner
							owner = { is_same_value = event_target:eternal_fleet_country }
							NOT = { is_same_value = root }
						} }
					}
					prevprev = { auto_move_to_planet = { target = prev clear_auto_move_on_arrival = yes } }
				}
			}
		}
	}
	else_if = {
		limit = {
			root = {
				exists = solar_system
				solar_system = { any_ship_in_system = {
					is_disabled = no
					is_ship_class = shipclass_military
					exists = owner
					owner = { is_hostile = event_target:eternal_fleet_country }
				} }
			}
		}
		root = {
			solar_system = {
				random_fleet_in_system = {
					limit = {
						exists = owner
						owner = { is_hostile = event_target:eternal_fleet_country }
						any_owned_ship = {
							is_disabled = no
							is_ship_class = shipclass_military
						}
					}
					prevprev = { auto_follow_fleet = { target = prev attack_fleet = yes } }
				}
			}
		}
	}
	else_if = {
		limit = {
			solar_system = { any_neighbor_system = { OR = {
				AND = {
					exists = starbase
					starbase = { exists = owner owner = { is_hostile = event_target:eternal_fleet_country } }
				}
				any_ship_in_system = {
					is_disabled = no
					is_ship_class = shipclass_military
					exists = owner
					owner = { is_hostile = event_target:eternal_fleet_country }
				}
			} } }
		}
		solar_system = { random_neighbor_system = {
			limit = { OR = {
				AND = {
					exists = starbase
					starbase = {
						exists = owner
						owner = { is_hostile = event_target:eternal_fleet_country }
					}
				}
				any_ship_in_system = {
					is_disabled = no
					is_ship_class = shipclass_military
					exists = owner
					owner = { is_hostile = event_target:eternal_fleet_country }
				}
			} }
			system_star = { prevprevprev = { auto_move_to_planet = { target = prev clear_auto_move_on_arrival = yes } } }
		} }
	}
	else_if = {
		limit = {
			solar_system = { kuat_is_kuat_system = yes }
			any_system = {
				has_star_flag = kuat_military_base_local_home
				any_system_megastructure = { is_megastructure_type = exe_outer_gate }
			}
		}
		if = {
			limit = {
				solar_system = { 
					OR = {
						has_star_flag = Kuat_system 
						has_star_flag = Kuat_system_int
					}
				}
			}
			random_system = {
				limit = { 
					OR = {
						has_star_flag = Kuat_system_3 
						has_star_flag = Kuat_system_int_3
					}
				}
				system_star = { prevprev = { auto_move_to_planet = { target = prev clear_auto_move_on_arrival = yes } } }
			}
		}
		else_if = {
			limit = {
				solar_system = { 
					OR = {
						has_star_flag = Kuat_system_3 
						has_star_flag = Kuat_system_int_3
					}
				}
			}
			random_system = {
				limit = { 
					OR = {
						has_star_flag = Kuat_system_2 
						has_star_flag = Kuat_system_int_2
					}
				}
				system_star = { prevprev = { auto_move_to_planet = { target = prev clear_auto_move_on_arrival = yes } } }
			}
		}
		else_if = {
			limit = {
				solar_system = { 
					OR = {
						has_star_flag = Kuat_system_2 
						has_star_flag = Kuat_system_int_2
					}
				}
			}
			random_system = {
				limit = { 
					OR = {
						has_star_flag = Kuat_system_1 
						has_star_flag = Kuat_system_int_1
					} 
				}
				system_star = { prevprev = { auto_move_to_planet = { target = prev clear_auto_move_on_arrival = yes } } }
			}
		}
		else_if = {
			limit = {
				solar_system = { 
					OR = {
						has_star_flag = Kuat_system_1 
						has_star_flag = Kuat_system_int_1
						has_star_flag = Kuat_system_int_4
					} 
				}
			}
			random_system = {
				limit = {
					has_star_flag = kuat_military_base_local_home
					any_system_megastructure = { is_megastructure_type = exe_outer_gate }
				}
				system_star = { prevprev = { auto_move_to_planet = { target = prev clear_auto_move_on_arrival = yes } } }
			}
		}
	}
	else_if = {
		limit = { 
			solar_system = { has_star_flag = kuat_military_base_local_home }
			any_system = {
				has_star_flag = kuat_military_sublocal_home
				NOT = { any_fleet_in_system = { NOT = { is_same_value = root } has_fleet_flag = ag_kuat_invasion_fleet } }
			}
		}
		random_system = {
			limit = {
				has_star_flag = kuat_military_sublocal_home
				NOT = { any_fleet_in_system = { NOT = { is_same_value = root } has_fleet_flag = ag_kuat_invasion_fleet } }
			}
			system_star = { prevprev = { auto_move_to_planet = { target = prev clear_auto_move_on_arrival = yes } } }
		}
	}
	else_if = {
		limit = {  
			solar_system = { has_star_flag = kuat_military_sublocal_home }
			any_system = { has_star_flag = kuat_outlander_exe_center_rim_gate }
		}
		random_system = {
			limit = { has_star_flag = kuat_outlander_exe_center_rim_gate }
			system_star = { prevprev = { auto_move_to_planet = { target = prev clear_auto_move_on_arrival = yes } } }
		}
	}
	else = {
		random_list = {
			25 = {
				closest_system = {
					max_steps = 50
					limit = {
						NOT = { is_same_value = root.solar_system }
						OR = {
							AND = {
								exists = starbase
								starbase = {
									exists = owner
									owner = { is_hostile = event_target:eternal_fleet_country }
								}
							}
							any_system_planet = {
								exists = owner
								owner = { is_hostile = event_target:eternal_fleet_country }
								exists = controller
								controller = { is_hostile = event_target:eternal_fleet_country }
								OR = {
									is_colony = yes
									is_under_colonization = yes
								}
								NOT = { any_fleet_in_orbit = {
									exists = owner
									owner = { is_same_value = event_target:eternal_fleet_country }
									NOT = { is_same_value = root }
								} }
							}
						}
						prev = { can_access_system = prev }
					}
					save_event_target_as = ag_kuat_invasion_fleet_action_target
				}
				if = {
					limit = { exists = event_target:ag_kuat_invasion_fleet_action_target }
					event_target:ag_kuat_invasion_fleet_action_target = {
						if = {
							limit = {
								any_system_planet = {
									exists = owner
									owner = { is_hostile = event_target:eternal_fleet_country }
									exists = controller
									controller = { is_hostile = event_target:eternal_fleet_country }
									OR = {
										is_colony = yes
										is_under_colonization = yes
									}
									NOT = { any_fleet_in_orbit = {
										exists = owner
										owner = { is_same_value = event_target:eternal_fleet_country }
										NOT = { is_same_value = root }
									} }
								}
							}
							random_system_planet = {
								limit = {
									exists = owner
									owner = { is_hostile = event_target:eternal_fleet_country }
									exists = controller
									controller = { is_hostile = event_target:eternal_fleet_country }
									OR = {
										is_colony = yes
										is_under_colonization = yes
									}
									NOT = {
										any_fleet_in_orbit = {
											exists = owner
											owner = { is_same_value = event_target:eternal_fleet_country }
											NOT = { is_same_value = root }
										}
									}
								}
								random_list = {
									80 = {
										prevprev = {
											auto_move_to_planet = { target = prev clear_auto_move_on_arrival = yes }
										}
									}
									20 = {
										modifier = {
											factor = 0
											prevprev = {
												any_owned_ship = { has_ship_flag = ag_jump_drive_cooldown }
											}
										}
										prevprev = {
											set_location = { target = prev distance = 300 angle = random }
											every_owned_ship = { create_jump_particle_effect = yes }
											while = {
												limit = {
													any_owned_ship = {
														NOT = { has_ship_flag = ag_jump_drive_cooldown }
													}
												}
												random_owned_ship = {
													limit = {
														NOT = { has_ship_flag = ag_jump_drive_cooldown }
													}
													set_timed_ship_flag = { flag = ag_jump_drive_cooldown days = 200 }
													add_modifier = { modifier = "jump_drive_cooldown" days = 200 }
												}
											}
											auto_move_to_planet = { target = prev clear_auto_move_on_arrival = yes }
										}
									}
								}
							}
						} 
						else = { system_star = { prevprev = { auto_move_to_planet = { target = prev clear_auto_move_on_arrival = yes } } } }
					}
				} else = {
					closest_system = {
						max_steps = 50
						limit = {
							NOT = {
								is_same_value = root.solar_system
							}
							OR = {
								AND = {
									exists = starbase
									starbase = {
										exists = owner
										owner = { is_hostile = event_target:eternal_fleet_country }
									}
								}
								any_system_planet = {
									exists = owner
									owner = { is_hostile = event_target:eternal_fleet_country }
									exists = controller
									controller = { is_hostile = event_target:eternal_fleet_country }
									OR = {
										is_colony = yes
										is_under_colonization = yes
									}
									NOT = { any_fleet_in_orbit = {
										exists = owner
										owner = { is_same_value = event_target:eternal_fleet_country }
										NOT = { is_same_value = root }
									} }
								}
							}
						}
						save_event_target_as = ag_kuat_invasion_fleet_action_target
					}
					if = {
						limit = { exists = event_target:ag_kuat_invasion_fleet_action_target }
						event_target:ag_kuat_invasion_fleet_action_target = {
							if = {
								limit = {
									any_system_planet = {
										exists = owner
										owner = { is_hostile = event_target:eternal_fleet_country }
										exists = controller
										controller = { is_hostile = event_target:eternal_fleet_country }
										OR = {
											is_colony = yes
											is_under_colonization = yes
										}
										NOT = { any_fleet_in_orbit = {
											exists = owner
											owner = { is_same_value = event_target:eternal_fleet_country }
											NOT = { is_same_value = root }
										} }
									}
								}
								random_system_planet = {
									limit = {
										exists = owner
										owner = { is_hostile = event_target:eternal_fleet_country }
										exists = controller
										controller = { is_hostile = event_target:eternal_fleet_country }
										OR = {
											is_colony = yes
											is_under_colonization = yes
										}
										NOT = { any_fleet_in_orbit = {
											exists = owner
											owner = { is_same_value = event_target:eternal_fleet_country }
											NOT = { is_same_value = root }
										} }
									}
									random_list = {
										80 = {
											prevprev = {
												auto_move_to_planet = { target = prev clear_auto_move_on_arrival = yes }
											}
										}
										20 = {
											modifier = {
												factor = 0
												prevprev = {
													any_owned_ship = { has_ship_flag = ag_jump_drive_cooldown }
												}
											}
											prevprev = {
												set_location = { target = prev distance = 300 angle = random }
												every_owned_ship = { create_jump_particle_effect = yes }
												while = {
													limit = {
														any_owned_ship = {
															NOT = { has_ship_flag = ag_jump_drive_cooldown }
														}
													}
													random_owned_ship = {
														limit = {
															NOT = { has_ship_flag = ag_jump_drive_cooldown }
														}
														set_timed_ship_flag = { flag = ag_jump_drive_cooldown days = 200 }
														add_modifier = { modifier = "jump_drive_cooldown" days = 200 }
													}
												}
												auto_move_to_planet = { target = prev clear_auto_move_on_arrival = yes }
											}
										}
									}
								}
							} 
							else = { system_star = { prevprev = { auto_move_to_planet = { target = prev clear_auto_move_on_arrival = yes } } } }
						}
					} else = { ag_exe_invasion_fleet_wandering_action = yes }
				}
			}
			25 = {
				random_system = {
					limit = {
						NOT = { is_same_value = root.solar_system }
						distance = {
							source = root.solar_system
							type = hyperlane
							use_bypasses = yes
							min_jumps = 1
							max_jumps = 10
						}
						OR = {
							AND = {
								exists = starbase
								starbase = {
									exists = owner
									owner = { is_hostile = event_target:eternal_fleet_country }
								}
							}
							any_system_planet = {
								exists = owner
								owner = { is_hostile = event_target:eternal_fleet_country }
								exists = controller
								controller = { is_hostile = event_target:eternal_fleet_country }
								OR = {
									is_colony = yes
									is_under_colonization = yes
								}
								NOT = { any_fleet_in_orbit = {
									exists = owner
									owner = { is_same_value = event_target:eternal_fleet_country }
									NOT = { is_same_value = root }
								} }
							}
						}
						prev = { can_access_system = prev }
					}
					save_event_target_as = ag_kuat_invasion_fleet_action_target
				}
				if = {
					limit = { exists = event_target:ag_kuat_invasion_fleet_action_target }
					event_target:ag_kuat_invasion_fleet_action_target = {
						if = {
							limit = {
								any_system_planet = {
									exists = owner
									owner = { is_hostile = event_target:eternal_fleet_country }
									exists = controller
									controller = { is_hostile = event_target:eternal_fleet_country }
									OR = {
										is_colony = yes
										is_under_colonization = yes
									}
									NOT = { any_fleet_in_orbit = {
										exists = owner
										owner = { is_same_value = event_target:eternal_fleet_country }
										NOT = { is_same_value = root }
									} }
								}
							}
							random_system_planet = {
								limit = {
									exists = owner
									owner = { is_hostile = event_target:eternal_fleet_country }
									exists = controller
									controller = { is_hostile = event_target:eternal_fleet_country }
									OR = {
										is_colony = yes
										is_under_colonization = yes
									}
									NOT = { any_fleet_in_orbit = {
										exists = owner
										owner = { is_same_value = event_target:eternal_fleet_country }
										NOT = { is_same_value = root }
									} }
								}
								random_list = {
									80 = {
										prevprev = {
											auto_move_to_planet = { target = prev clear_auto_move_on_arrival = yes }
										}
									}
									20 = {
										modifier = {
											factor = 0
											prevprev = {
												any_owned_ship = {
													has_ship_flag = ag_jump_drive_cooldown
												}
											}
										}
										prevprev = {
											set_location = { target = prev distance = 300 angle = random }
											every_owned_ship = { create_jump_particle_effect = yes }
											while = {
												limit = {
													any_owned_ship = {
														NOT = { has_ship_flag = ag_jump_drive_cooldown }
													}
												}
												random_owned_ship = {
													limit = {
														NOT = { has_ship_flag = ag_jump_drive_cooldown }
													}
													set_timed_ship_flag = { flag = ag_jump_drive_cooldown days = 200 }
													add_modifier = { modifier = "jump_drive_cooldown" days = 200 }
												}
											}
											auto_move_to_planet = { target = prev clear_auto_move_on_arrival = yes }
										}
									}
								}
							}
						} 
						else = { system_star = { prevprev = { auto_move_to_planet = { target = prev clear_auto_move_on_arrival = yes } } } }
					}
				} else = {
					random_system = {
						limit = {
							NOT = { is_same_value = root.solar_system }
							distance = {
								source = root.solar_system
								type = hyperlane
								use_bypasses = yes
								min_jumps = 1
								max_jumps = 10
							}
							OR = {
								AND = {
									exists = starbase
									starbase = {
										exists = owner
										owner = { is_hostile = event_target:eternal_fleet_country }
									}
								}
								any_system_planet = {
									exists = owner
									owner = { is_hostile = event_target:eternal_fleet_country }
									exists = controller
									controller = { is_hostile = event_target:eternal_fleet_country }
									OR = {
										is_colony = yes
										is_under_colonization = yes
									}
									NOT = { any_fleet_in_orbit = {
										exists = owner
										owner = { is_same_value = event_target:eternal_fleet_country }
										NOT = { is_same_value = root }
									} }
								}
							}
						}
						save_event_target_as = ag_kuat_invasion_fleet_action_target
					}
					if = {
						limit = { exists = event_target:ag_kuat_invasion_fleet_action_target }
						event_target:ag_kuat_invasion_fleet_action_target = {
							if = {
								limit = {
									any_system_planet = {
										exists = owner
										owner = { is_hostile = event_target:eternal_fleet_country }
										exists = controller
										controller = { is_hostile = event_target:eternal_fleet_country }
										OR = {
											is_colony = yes
											is_under_colonization = yes
										}
										NOT = { any_fleet_in_orbit = {
											exists = owner
											owner = { is_same_value = event_target:eternal_fleet_country }
											NOT = { is_same_value = root }
										} }
									}
								}
								random_system_planet = {
									limit = {
										exists = owner
										owner = { is_hostile = event_target:eternal_fleet_country }
										exists = controller
										controller = { is_hostile = event_target:eternal_fleet_country }
										OR = {
											is_colony = yes
											is_under_colonization = yes
										}
										NOT = {
											any_fleet_in_orbit = {
												exists = owner
												owner = { is_same_value = event_target:eternal_fleet_country }
												NOT = { is_same_value = root }
											}
										}
									}
									random_list = {
										80 = {
											prevprev = {
												auto_move_to_planet = { target = prev clear_auto_move_on_arrival = yes }
											}
										}
										20 = {
											modifier = {
												factor = 0
												prevprev = {
													any_owned_ship = { has_ship_flag = ag_jump_drive_cooldown }
												}
											}
											prevprev = {
												set_location = { target = prev distance = 300 angle = random }
												every_owned_ship = { create_jump_particle_effect = yes }
												while = {
													limit = {
														any_owned_ship = {
															NOT = { has_ship_flag = ag_jump_drive_cooldown }
														}
													}
													random_owned_ship = {
														limit = {
															NOT = { has_ship_flag = ag_jump_drive_cooldown }
														}
														set_timed_ship_flag = { flag = ag_jump_drive_cooldown days = 200 }
														add_modifier = { modifier = "jump_drive_cooldown" days = 200 }
													}
												}
												auto_move_to_planet = { target = prev clear_auto_move_on_arrival = yes }
											}
										}
									}
								}
							} 
							else = { system_star = { prevprev = { auto_move_to_planet = { target = prev clear_auto_move_on_arrival = yes } } } }
						}
					} else = { ag_exe_invasion_fleet_wandering_action = yes }
				}
			}
			25 = {
				closest_system = {
					max_steps = 50
					limit = {
						NOT = { is_same_value = root.solar_system }
						any_ship_in_system = {
							is_disabled = no
							is_ship_class = shipclass_military
							exists = owner
							owner = { is_hostile = event_target:eternal_fleet_country }
						}
						prev = { can_access_system = prev }
					}
					save_event_target_as = ag_kuat_invasion_fleet_action_target
				}
				if = {
					limit = { exists = event_target:ag_kuat_invasion_fleet_action_target }
					event_target:ag_kuat_invasion_fleet_action_target = {
						random_fleet_in_system = {
							limit = {
								exists = owner
								owner = { is_hostile = event_target:eternal_fleet_country }
								any_owned_ship = {
									is_disabled = no
									is_ship_class = shipclass_military
								}
							}
							random_list = {
								75 = {
									prevprev = {
										auto_follow_fleet = { target = prev attack_fleet = yes }
									}
								}
								25 = {
									modifier = {
										factor = 0
										prevprev = {
											any_owned_ship = {
												has_ship_flag = ag_jump_drive_cooldown
											}
										}
									}
									prevprev = {
										set_location = { target = prev distance = 150 angle = random }
										every_owned_ship = { create_jump_particle_effect = yes }
										while = {
											limit = {
												any_owned_ship = {
													NOT = { has_ship_flag = ag_jump_drive_cooldown }
												}
											}
											random_owned_ship = {
												limit = {
													NOT = { has_ship_flag = ag_jump_drive_cooldown }
												}
												set_timed_ship_flag = { flag = ag_jump_drive_cooldown days = 200 }
												add_modifier = { modifier = "jump_drive_cooldown" days = 200 }
											}
										}
										auto_follow_fleet = { target = prev attack_fleet = yes }
									}
								}
							}
						}
					}
				} else = {
					closest_system = {
						max_steps = 50
						limit = {
							NOT = { is_same_value = root.solar_system }
							any_ship_in_system = {
								is_disabled = no
								is_ship_class = shipclass_military
								exists = owner
								owner = { is_hostile = event_target:eternal_fleet_country }
							}
						}
						save_event_target_as = ag_kuat_invasion_fleet_action_target
					}
					if = {
						limit = { exists = event_target:ag_kuat_invasion_fleet_action_target }
						event_target:ag_kuat_invasion_fleet_action_target = {
							random_fleet_in_system = {
								limit = {
									exists = owner
									owner = { is_hostile = event_target:eternal_fleet_country }
									any_owned_ship = {
										is_disabled = no
										is_ship_class = shipclass_military
									}
								}
								random_list = {
									75 = {
										prevprev = {
											auto_follow_fleet = { target = prev attack_fleet = yes }
										}
									}
									25 = {
										modifier = {
											factor = 0
											prevprev = {
												any_owned_ship = {
													has_ship_flag = ag_jump_drive_cooldown
												}
											}
										}
										prevprev = {
											set_location = { target = prev distance = 150 angle = random }
											every_owned_ship = { create_jump_particle_effect = yes }
											while = {
												limit = {
													any_owned_ship = {
														NOT = { has_ship_flag = ag_jump_drive_cooldown }
													}
												}
												random_owned_ship = {
													limit = {
														NOT = { has_ship_flag = ag_jump_drive_cooldown }
													}
													set_timed_ship_flag = { flag = ag_jump_drive_cooldown days = 200 }
													add_modifier = { modifier = "jump_drive_cooldown" days = 200 }
												}
											}
											auto_follow_fleet = { target = prev attack_fleet = yes }
										}
									}
								}
							}
						}
					} else = { ag_exe_invasion_fleet_wandering_action = yes }
				}
			}
			25 = {
				random_system = {
					limit = {
						NOT = { is_same_value = root.solar_system }
						distance = {
							source = root.solar_system
							type = hyperlane
							use_bypasses = yes
							min_jumps = 1
							max_jumps = 10
						}
						any_ship_in_system = {
							is_disabled = no
							is_ship_class = shipclass_military
							exists = owner
							owner = { is_hostile = event_target:eternal_fleet_country }
						}
						prev = { can_access_system = prev }
					}
					save_event_target_as = ag_kuat_invasion_fleet_action_target
				}
				if = {
					limit = { exists = event_target:ag_kuat_invasion_fleet_action_target }
					event_target:ag_kuat_invasion_fleet_action_target = {
						random_fleet_in_system = {
							limit = {
								exists = owner
								owner = { is_hostile = event_target:eternal_fleet_country }
								any_owned_ship = {
									is_disabled = no
									is_ship_class = shipclass_military
								}
							}
							random_list = {
								75 = {
									prevprev = {
										auto_follow_fleet = { target = prev attack_fleet = yes }
									}
								}
								25 = {
									modifier = {
										factor = 0
										prevprev = {
											any_owned_ship = {
												has_ship_flag = ag_jump_drive_cooldown
											}
										}
									}
									prevprev = {
										set_location = { target = prev distance = 150 angle = random }
										every_owned_ship = { create_jump_particle_effect = yes }
										while = {
											limit = {
												any_owned_ship = {
													NOT = { has_ship_flag = ag_jump_drive_cooldown }
												}
											}
											random_owned_ship = {
												limit = {
													NOT = { has_ship_flag = ag_jump_drive_cooldown }
												}
												set_timed_ship_flag = { flag = ag_jump_drive_cooldown days = 200 }
												add_modifier = { modifier = "jump_drive_cooldown" days = 200 }
											}
										}
										auto_follow_fleet = { target = prev attack_fleet = yes }
									}
								}
							}
						}
					}
				} else = {
					random_system = {
						limit = {
							NOT = { is_same_value = root.solar_system }
							distance = {
								source = root.solar_system
								type = hyperlane
								use_bypasses = yes
								min_jumps = 1
								max_jumps = 10
							}
							any_ship_in_system = {
								is_disabled = no
								is_ship_class = shipclass_military
								exists = owner
								owner = { is_hostile = event_target:eternal_fleet_country }
							}
						}
						save_event_target_as = ag_kuat_invasion_fleet_action_target
					}
					if = {
						limit = { exists = event_target:ag_kuat_invasion_fleet_action_target }
						event_target:ag_kuat_invasion_fleet_action_target = {
							random_fleet_in_system = {
								limit = {
									exists = owner
									owner = { is_hostile = event_target:eternal_fleet_country }
									any_owned_ship = {
										is_disabled = no
										is_ship_class = shipclass_military
									}
								}
								random_list = {
									75 = {
										prevprev = {
											auto_follow_fleet = { target = prev attack_fleet = yes }
										}
									}
									25 = {
										modifier = {
											factor = 0
											prevprev = {
												any_owned_ship = { has_ship_flag = ag_jump_drive_cooldown }
											}
										}
										prevprev = {
											set_location = { target = prev distance = 150 angle = random }
											every_owned_ship = { create_jump_particle_effect = yes }
											while = {
												limit = {
													any_owned_ship = {
														NOT = { has_ship_flag = ag_jump_drive_cooldown }
													}
												}
												random_owned_ship = {
													limit = {
														NOT = { has_ship_flag = ag_jump_drive_cooldown }
													}
													set_timed_ship_flag = { flag = ag_jump_drive_cooldown days = 200 }
													add_modifier = { modifier = "jump_drive_cooldown" days = 200 }
												}
											}
											auto_follow_fleet = { target = prev attack_fleet = yes }
										}
									}
								}
							}
						}
					} else = { ag_exe_invasion_fleet_wandering_action = yes }
				}
			}
		}
	}
}

#KUAT FLEET ACTION
fleet_execute_order_1 = {
	optimize_memory
	queue_actions = {
		repeat = {
			effect = {
				id = executor.1.c
				if = {
					limit = { has_fleet_flag = kuat_cannot_find_path }
					if = {
						limit = { any_country = { is_at_war_with = $OWNER_TARGET$ } }
						random_system = {
							limit = { any_system_planet = { 
								exists = controller
								controller = { is_at_war_with = $OWNER_TARGET$ } 
							} }
							random_system_planet = { ROOT = { 
								set_location = { target = PREV distance = 300 angle = random } 
								every_owned_ship = { create_jump_particle_effect = yes }
							} }
						}
					}
					else = {
						destroy_fleet = { target = this destroy_template = yes kill_leader = yes }
						every_system = {
							limit = { check_variable = { which = kuat_fleet_id value >= 1 } }
							set_variable = { which = kuat_fleet_id value = 0 } clear_variable = kuat_fleet_id
						}
					}
					remove_fleet_flag = kuat_cannot_find_path
				}
			}
			find_closest_system = {
				trigger = {
					id = executor.1
					ROOT = { can_access_system = prev }
					OR = {
						any_system_planet = {
							exists = controller
							controller = { is_at_war_with = $OWNER_TARGET$ }
						}
						AND = { exists = starbase starbase = { controller = { is_hostile = $OWNER_TARGET$ } } }
					}
					check_variable = { which = kuat_fleet_id value < 1 }
				}
				found_system = {
					effect = {
						id = executor.2.r1
						set_variable = { which = kuat_fleet_id value = root.fleet_id }
					}
					move_to = this
					repeat = {
						while = {
							id = executor.2.t0
							any_system_planet = {
								exists = controller
								controller = { is_at_war_with = $OWNER_TARGET$ }
							}
						}
						find_closest_planet = {
							trigger = {
								id = executor.2
								exists = controller
								controller = { is_at_war_with = $OWNER_TARGET$ }
							}
							found_planet = {
								orbit_planet = this
								effect = {
									id = executor.3
									set_planet_flag = ruins_planet
									ROOT = { set_fleet_flag = kuat_fallen_bombaring_fleet }
								}
								repeat = {
									while = { id = executor.3.t0 ROOT = { has_fleet_flag = kuat_fallen_bombaring_fleet } }
									effect = {
										id = executor.3.t1
										if = { limit = { is_colony = no } ROOT = { remove_fleet_flag = kuat_fallen_bombaring_fleet } }
									} 
									wait = 5
								}
							}
						}
						wait = 5
					}
					wait = 15
				}
				failed = {
					find_closest_system = {
						trigger = {
							id = executor.5.t9
							ROOT = { can_access_system = prev }
							OR = {
								any_system_planet = {
									exists = controller
									controller = { is_at_war_with = $OWNER_TARGET$ }
								}
								AND = {
									exists = starbase
									starbase = { owner = { is_hostile = $OWNER_TARGET$ } }
								}
							}
						}
						found_system = {
							move_to = this
							repeat = {
								while = {
									id = executor.5.t0
									any_system_planet = {
										exists = controller
										controller = { is_at_war_with = $OWNER_TARGET$ }
									}
								}
								find_closest_planet = {
									trigger = {
										id = executor.5.t5
										exists = controller
										controller = { is_at_war_with = $OWNER_TARGET$ }
									}
									found_planet = {
										orbit_planet = this
										effect = {
											id = executor.5.t4
											set_planet_flag = ruins_planet
											ROOT = { set_fleet_flag = kuat_fallen_bombaring_fleet }
										}
										repeat = {
											while = { id = executor.5.t3 ROOT = { has_fleet_flag = kuat_fallen_bombaring_fleet } }
											effect = {
												id = executor.5.t1
												if = { limit = { is_colony = no } ROOT = { remove_fleet_flag = kuat_fallen_bombaring_fleet } }
											}
											wait = 5
										}
									}
								}
								wait = 5
							}
							wait = 15
						}
						failed = { effect = { id = executor.1.b ROOT = { set_fleet_flag = kuat_cannot_find_path } } wait = 60 }
					}
				}
			}
		}
	}
}

fleet_execute_order_3 = {
	optimize_memory
	queue_actions = {
		repeat = {
			effect = {
				id = executor.20.j
				if = {
					limit = { has_fleet_flag = kuat_cannot_find_path }
					if = {
						limit = { any_country = { kuat_is_crisis_faction = yes } }
						random_system = {
							limit = { any_fleet_in_system = { owner = { kuat_is_crisis_faction = yes } } }
							random_system_planet = { prevprev = { 
								set_location = { target = PREV distance = 300 angle = random } 
								every_owned_ship = { create_jump_particle_effect = yes }
							}  }
						}
					}
					else = {
						destroy_fleet = { target = this destroy_template = yes kill_leader = yes }
						every_system = {
							limit = { check_variable = { which = kuat_fleet_id value >= 1 } }
							set_variable = { which = kuat_fleet_id value = 0 } clear_variable = kuat_fleet_id
						}
					}
					remove_fleet_flag = kuat_cannot_find_path
				}
			}
			find_closest_system = {
				trigger = {
					id = executor.20
					any_fleet_in_system = { owner = { kuat_is_crisis_faction = yes } }
					prev = { can_access_system = prev }
					check_variable = { which = kuat_fleet_id value < 1 }
				}
				found_system = {
					effect = {
						id = executor.20.a1
						set_variable = { which = kuat_fleet_id value = prev.fleet_id }
					}
					move_to = this
					repeat = {
						while = {
							id = executor.20.a
							any_fleet_in_system = { owner = { kuat_is_crisis_faction = yes } }
						}
						move_to = this wait = 5
					} 
					wait = 15
				}
				failed = {
					find_closest_system = {
						trigger = {
							id = executor.21
							any_fleet_in_system = { owner = { kuat_is_crisis_faction = yes } }
							prev = { can_access_system = prev }
						}
						found_system = { 
							move_to = this
							repeat = {
								while = {
									id = executor.21.a
									any_fleet_in_system = { owner = { kuat_is_crisis_faction = yes } }
								}
								move_to = this wait = 5
							} 
							wait = 15
						}
						failed = { effect = { id = executor.23 ROOT = { set_fleet_flag = kuat_cannot_find_path } } wait = 60 }
					}
				}
			}
		}
	}
}

create_jump_particle_effect = {
	optimize_memory
	create_ambient_object = {
		type = horror_spawn_object
		location = this
		duration = 10
		use_3d_location = yes
		entity_offset = { min = 0 max = 0 }
		entity_offset_angle = { min = 0 max = 0 }
		entity_offset_height = { min = 0 max = 0 }
		entity_scale_to_size = yes
		scale = 0.05
	}
}

#AWAKENING FLEET
create_kuat_awakening_fleet = {
	optimize_memory
	every_system = {
		limit = { 
			exists = starbase
			starbase = { controller = { is_kuat_fallen_empire = yes } }
			kuat_is_kuat_system = yes 
		}
		switch = {
			trigger = has_global_flag
			difficult_exe_invasion = { create_exe_invasion_fleet = {
				NAME = Name_DFLEET
				is_boss = yes  can_disband = no
				Fleet_owner = event_target:fallen_empire_kuat
				bombardment = indiscriminate

				Eclipse = @kuat_invasion_flagship_num_T1  
				Tyrant = @kuat_invasion_flagship_num_T2
				Resugrant = @kuat_invasion_Battleship_num_T3 
				high_Imperial = @kuat_invasion_BattleCruser_num_T3  
				Harrower = @kuat_invasion_Cruser_num_T3  DIFF = 1

				Location = prev.star
			} }
			normal_exe_invasion = { create_exe_invasion_fleet = {
				NAME = Name_DFLEET
				is_boss = yes  can_disband = no
				Fleet_owner = event_target:fallen_empire_kuat
				bombardment = indiscriminate
				
				Eclipse = @kuat_invasion_flagship_num_T1  
				Balletor = @kuat_invasion_flagship_num_T2
				Resugrant = @kuat_invasion_Battleship_num_T3 
				high_Imperial = @kuat_invasion_BattleCruser_num_T3  
				Harrower = @kuat_invasion_Cruser_num_T3  DIFF = 2

				Location = prev.star
			} }
			easy_exe_invasion = { create_exe_invasion_fleet = {
				NAME = Name_DFLEET
				is_boss = yes  can_disband = no
				Fleet_owner = event_target:fallen_empire_kuat
				bombardment = indiscriminate
				
				Eclipse = @kuat_invasion_flagship_num_T1  
				Titan = @kuat_invasion_flagship_num_T2
				Resugrant = @kuat_invasion_Battleship_num_T3 
				high_Imperial = @kuat_invasion_BattleCruser_num_T3  
				Harrower = @kuat_invasion_Cruser_num_T3  DIFF = 3

				Location = prev.star
			} }
			ban_exe_invasion = { create_exe_invasion_fleet = {
				NAME = Name_DFLEET
				is_boss = yes  can_disband = no
				Fleet_owner = event_target:fallen_empire_kuat
				bombardment = indiscriminate
				
				Eclipse = @kuat_invasion_flagship_num_T1  
				Tyrant = @kuat_invasion_flagship_num_T2
				Resugrant = @kuat_invasion_Battleship_num_T3 
				high_Imperial = @kuat_invasion_BattleCruser_num_T3  
				Harrower = @kuat_invasion_Cruser_num_T3  DIFF = 1

				Location = prev.star
			} }
			default = { create_exe_invasion_fleet = {
				NAME = Name_DFLEET
				is_boss = yes  can_disband = no
				Fleet_owner = event_target:fallen_empire_kuat
				bombardment = indiscriminate
				
				Eclipse = @kuat_invasion_flagship_num_T1 
				Balletor = @kuat_invasion_flagship_num_T2 
				Resugrant = @kuat_invasion_Battleship_num_T3 
				high_Imperial = @kuat_invasion_BattleCruser_num_T3  
				Harrower = @kuat_invasion_Cruser_num_T3  DIFF = 3

				Location = prev.star
			} }
		}
	}
}

#RETURN FLEET
create_kuat_return_fleet_defender = {
	optimize_memory
	if = { limit = { has_global_flag = has_origin_eternalthrone }
		every_system = { 
			limit = { 
				exists = starbase
				starbase = { controller = { is_kuat_fallen_empire = yes } }
				kuat_is_kuat_system = yes 
			}
			switch = {
				trigger = has_global_flag
				difficult_exe_invasion = { create_exe_invasion_fleet = {
					NAME = Name_DFLEET_II
					is_boss = yes  can_disband = no
					Fleet_owner = event_target:return_kuat_awakening_country
					bombardment = indiscriminate

					Sector = @kuat_invasion_flagship_num_T1  
					Tyrant = @kuat_invasion_flagship_num_T2
					Resugrant = @kuat_invasion_BattleCruser_num_T3  
					high_Imperial = @kuat_invasion_Cruser_num_T3  DIFF = 1

					Location = prev.star
				} }
				normal_exe_invasion = {	create_exe_invasion_fleet = {
					NAME = Name_DFLEET_II
					is_boss = yes  can_disband = no
					Fleet_owner = event_target:return_kuat_awakening_country
					bombardment = indiscriminate
					
					Sector = @kuat_invasion_flagship_num_T1  
					Balletor = @kuat_invasion_flagship_num_T2
					Resugrant = @kuat_invasion_BattleCruser_num_T3  
					high_Imperial = @kuat_invasion_Cruser_num_T3  DIFF = 2

					Location = prev.star
				} }
				easy_exe_invasion = { create_exe_invasion_fleet = {
					NAME = Name_DFLEET_II
					is_boss = yes  can_disband = no
					Fleet_owner = event_target:return_kuat_awakening_country
					bombardment = indiscriminate
					
					Sector = @kuat_invasion_flagship_num_T1  
					Titan = @kuat_invasion_flagship_num_T2
					Resugrant = @kuat_invasion_BattleCruser_num_T3  
					high_Imperial = @kuat_invasion_Cruser_num_T3  DIFF = 3

					Location = prev.star
				} }
				ban_exe_invasion = { create_exe_invasion_fleet = {
					NAME = Name_DFLEET_II
					is_boss = yes  can_disband = no
					Fleet_owner = event_target:return_kuat_awakening_country
					bombardment = indiscriminate
					
					Sector = @kuat_invasion_flagship_num_T1  
					Tyrant = @kuat_invasion_flagship_num_T2
					Resugrant = @kuat_invasion_BattleCruser_num_T3  
					high_Imperial = @kuat_invasion_Cruser_num_T3  DIFF = 1

					Location = prev.star
				} }
				default = { create_exe_invasion_fleet = {
					NAME = Name_DFLEET_II
					is_boss = yes  can_disband = no
					Fleet_owner = event_target:return_kuat_awakening_country
					bombardment = indiscriminate
					
					Sector = @kuat_invasion_flagship_num_T1  
					Balletor = @kuat_invasion_flagship_num_T2
					Resugrant = @kuat_invasion_BattleCruser_num_T3  
					high_Imperial = @kuat_invasion_Cruser_num_T3  DIFF = 3

					Location = prev.star
				} }
			}
		}
	}
	else = { every_system = {
		limit = { 
			exists = starbase
			starbase = { controller = { is_kuat_fallen_empire = yes } }
			kuat_is_kuat_system = yes 
		}
		switch = {
			trigger = has_global_flag
			difficult_exe_invasion = { create_exe_invasion_fleet = {
				NAME = Name_DFLEET_II
				is_boss = yes  can_disband = no
				Fleet_owner = event_target:return_kuat_awakening_country
				bombardment = indiscriminate

				Eclipse = @kuat_invasion_flagship_num_T1
				Tyrant = @kuat_invasion_flagship_num_T2
				Resugrant = @kuat_invasion_Battleship_num_T3  
				high_Imperial = @kuat_invasion_BattleCruser_num_T3  
				Harrower = @kuat_invasion_Cruser_num_T3  DIFF = 1

				Location = prev.star
			} }
			normal_exe_invasion = {	create_exe_invasion_fleet = {
				NAME = Name_DFLEET_II
				is_boss = yes  can_disband = no
				Fleet_owner = event_target:return_kuat_awakening_country
				bombardment = indiscriminate
				
				Eclipse = @kuat_invasion_flagship_num_T1   
				Balletor = @kuat_invasion_flagship_num_T2
				Resugrant = @kuat_invasion_Battleship_num_T3  
				high_Imperial = @kuat_invasion_BattleCruser_num_T3  
				Harrower = @kuat_invasion_Cruser_num_T3  DIFF = 2

				Location = prev.star
			} }
			easy_exe_invasion = { create_exe_invasion_fleet = {
				NAME = Name_DFLEET_II
				is_boss = yes  can_disband = no
				Fleet_owner = event_target:return_kuat_awakening_country
				bombardment = indiscriminate
				
				Eclipse = @kuat_invasion_flagship_num_T1   
				Titan = @kuat_invasion_flagship_num_T2
				Resugrant = @kuat_invasion_Battleship_num_T3  
				high_Imperial = @kuat_invasion_BattleCruser_num_T3  
				Harrower = @kuat_invasion_Cruser_num_T3  DIFF = 3

				Location = prev.star
			} }
			ban_exe_invasion = { create_exe_invasion_fleet = {
				NAME = Name_DFLEET_II
				is_boss = yes  can_disband = no
				Fleet_owner = event_target:return_kuat_awakening_country
				bombardment = indiscriminate
				
				Eclipse = @kuat_invasion_flagship_num_T1   
				Tyrant = @kuat_invasion_flagship_num_T2
				Resugrant = @kuat_invasion_Battleship_num_T3  
				high_Imperial = @kuat_invasion_BattleCruser_num_T3  
				Harrower = @kuat_invasion_Cruser_num_T3  DIFF = 1
				
				Location = prev.star
			} }
			default = { create_exe_invasion_fleet = {
				NAME = Name_DFLEET_II
				is_boss = yes  can_disband = no
				Fleet_owner = event_target:return_kuat_awakening_country
				bombardment = indiscriminate

				Eclipse = @kuat_invasion_flagship_num_T1   
				Balletor = @kuat_invasion_flagship_num_T2
				Resugrant = @kuat_invasion_Battleship_num_T3  
				high_Imperial = @kuat_invasion_BattleCruser_num_T3  
				Harrower = @kuat_invasion_Cruser_num_T3  DIFF = 3

				Location = prev.star
			} }
		}
	} }
}

create_kuat_return_fleet_attacker = {
	optimize_memory
	while = {
		count = $NUM$
		random_rim_system = {
			limit = { 
				kuat_is_kuat_system = no 
				NOT = { has_star_flag = has_create_random_list_return_kuat_fleet }
			}
			weights = {
				base = 1
				modifier = {
					factor = 100
					NOT = { exists = space_owner }
				}
			}
			set_timed_star_flag = {
				flag = has_create_random_list_return_kuat_fleet
				days = 1
			}
			switch = {
				trigger = has_global_flag
				difficult_exe_invasion = { create_random_list_return_kuat_fleet = { DIFF = 1 } }
				normal_exe_invasion = { create_random_list_return_kuat_fleet = { DIFF = 2 } }
				easy_exe_invasion = { create_random_list_return_kuat_fleet = { DIFF = 3 } }
				ban_exe_invasion = { create_random_list_return_kuat_fleet = { DIFF = 1 } }
				default = { create_random_list_return_kuat_fleet = { DIFF = 3 } }
			}
		}
	}
}

create_random_list_return_kuat_fleet = {
	optimize_memory
	random_list = {
		1 = {
			modifier = { factor = 0 NOT = { has_global_flag = has_origin_eternalthrone } }
			modifier = { factor = 5 has_global_flag = has_origin_eternalthrone }
			create_exe_invasion_fleet = {
				NAME = Name_DFLEET_II
				flag = third_attack_fleet
				is_boss = yes  can_disband = no
				Fleet_owner = event_target:return_kuat_awakening_country
				bombardment = indiscriminate

				Sector = @kuat_invasion_flagship_num_T1  
				Balletor = @kuat_invasion_flagship_num_T2  
				Resugrant = @kuat_invasion_Battleship_num_T3  
				high_Imperial = @kuat_invasion_BattleCruser_num_T3  
				Harrower = @kuat_invasion_Cruser_num_T4  DIFF = $DIFF$

				Location = prev.star Fleet_action = ai_action.12
				CTL_TARGET = event_target:return_kuat_awakening_country
			}
		}
		1 = { create_exe_invasion_fleet = {
			NAME = Name_DFLEET_II
			flag = third_attack_fleet
			is_boss = yes  can_disband = no
			Fleet_owner = event_target:return_kuat_awakening_country
			bombardment = indiscriminate

			Eclipse = @kuat_invasion_flagship_num_T1  
			Titan = @kuat_invasion_flagship_num_T2  
			Resugrant = @kuat_invasion_Battleship_num_T3  
			high_Imperial = @kuat_invasion_BattleCruser_num_T3  
			Harrower = @kuat_invasion_Cruser_num_T4  DIFF = $DIFF$

			Location = prev.star Fleet_action = ai_action.12
			CTL_TARGET = event_target:return_kuat_awakening_country
		} }
		1 = { create_exe_invasion_fleet = {
			NAME = Name_DFLEET_II
			is_boss = yes  can_disband = no
			flag = third_attack_fleet
			Fleet_owner = event_target:return_kuat_awakening_country
			bombardment = indiscriminate

			Venganza = @kuat_invasion_flagship_num_T1  
			Balletor = @kuat_invasion_flagship_num_T2  
			Resugrant = @kuat_invasion_Battleship_num_T3  
			high_Imperial = @kuat_invasion_BattleCruser_num_T3  
			Harrower = @kuat_invasion_Cruser_num_T4  DIFF = $DIFF$

			Location = prev.star Fleet_action = ai_action.12
			CTL_TARGET = event_target:return_kuat_awakening_country
		} }
		1 = { create_exe_invasion_fleet = {
			NAME = Name_DFLEET_II
			is_boss = yes  can_disband = no
			flag = third_attack_fleet
			Fleet_owner = event_target:return_kuat_awakening_country
			bombardment = indiscriminate

			Dominance = @kuat_invasion_flagship_num_T1  
			Titan = @kuat_invasion_flagship_num_T2  
			Resugrant = @kuat_invasion_Battleship_num_T3  
			high_Imperial = @kuat_invasion_BattleCruser_num_T3  
			Harrower = @kuat_invasion_Cruser_num_T4  DIFF = $DIFF$

			Location = prev.star Fleet_action = ai_action.12
			CTL_TARGET = event_target:return_kuat_awakening_country
		} }
	}
}

create_kuat_return_starbase = {
	optimize_memory
	create_ship_design = { design = "NAME_KUAT_Starbase" }
	add_ship_design = last_created_design
	every_system = {
		limit = { NOT = { exists = starbase } kuat_is_kuat_system = yes }
		create_starbase = { owner = event_target:return_kuat_awakening_country size = exe_starbase }
	}
}

#GW WAR FLEET
create_kuat_millatery_defender_and_attack_fleet = {
	optimize_memory
	random_system = {
		limit = {
			exists = starbase
			starbase = {
				exists = controller
				controller = { is_same_value = event_target:fallen_empire_kuat_fleet }
			}
		}
		switch = {
			trigger = has_global_flag
			difficult_exe_invasion = { create_exe_invasion_fleet = {
				NAME = Name_DFLEET
				is_boss = yes  can_disband = no
				Fleet_owner = event_target:fallen_empire_kuat_fleet
				bombardment = indiscriminate

				Annihilator = @kuat_invasion_flagship_num_T1  
				Balletor = @kuat_invasion_flagship_num_T2  
				Resugrant = @kuat_invasion_Battleship_num_T3  
				high_Imperial = @kuat_invasion_BattleCruser_num_T3  
				Harrower = @kuat_invasion_Cruser_num_T4  DIFF = 1

				SAV_TARGET = fallen_empire_kuat_fleet_attack
				Location = event_target:begin_kuat_fleet_system.star
				flag = second_attack_fleet
				Fleet_action = ai_action.12
				CTL_TARGET = event_target:fallen_empire_kuat_fleet
			} }
			normal_exe_invasion = { create_exe_invasion_fleet = {
				NAME = Name_DFLEET
				is_boss = yes  can_disband = no
				Fleet_owner = event_target:fallen_empire_kuat_fleet
				bombardment = indiscriminate

				Eclipse = @kuat_invasion_flagship_num_T1  
				Titan  = @kuat_invasion_flagship_num_T2  
				Resugrant = @kuat_invasion_Battleship_num_T3  
				high_Imperial = @kuat_invasion_BattleCruser_num_T3  
				Harrower = @kuat_invasion_Cruser_num_T4  DIFF = 2

				SAV_TARGET = fallen_empire_kuat_fleet_attack
				Location = event_target:begin_kuat_fleet_system.star
				flag = second_attack_fleet
				Fleet_action = ai_action.12
				CTL_TARGET = event_target:fallen_empire_kuat_fleet
			} }
			easy_exe_invasion = { create_exe_invasion_fleet = {
				NAME = Name_DFLEET
				is_boss = yes  can_disband = no
				Fleet_owner = event_target:fallen_empire_kuat_fleet
				bombardment = indiscriminate

				Dominance = @kuat_invasion_flagship_num_T1  
				Balletor = @kuat_invasion_flagship_num_T2  
				Resugrant = @kuat_invasion_Battleship_num_T3  
				high_Imperial = @kuat_invasion_BattleCruser_num_T3  
				Harrower = @kuat_invasion_Cruser_num_T4  DIFF = 3

				SAV_TARGET = fallen_empire_kuat_fleet_attack
				Location = event_target:begin_kuat_fleet_system.star
				flag = second_attack_fleet
				Fleet_action = ai_action.12
				CTL_TARGET = event_target:fallen_empire_kuat_fleet
			} }
			ban_exe_invasion = { create_exe_invasion_fleet = {
				NAME = Name_DFLEET
				is_boss = yes  can_disband = no
				Fleet_owner = event_target:fallen_empire_kuat_fleet
				bombardment = indiscriminate
				Venganza = @kuat_invasion_flagship_num_T1  
				Tyrant = @kuat_invasion_flagship_num_T2  
				Resugrant = @kuat_invasion_Battleship_num_T3 
				high_Imperial = @kuat_invasion_BattleCruser_num_T3  
				Harrower = @kuat_invasion_Cruser_num_T4  DIFF = 1

				SAV_TARGET = fallen_empire_kuat_fleet_attack
				Location = event_target:begin_kuat_fleet_system.star
				flag = second_attack_fleet
				Fleet_action = ai_action.12
				CTL_TARGET = event_target:fallen_empire_kuat_fleet
			} }
			default = { create_exe_invasion_fleet = {
				NAME = Name_DFLEET
				is_boss = yes  can_disband = no
				Fleet_owner = event_target:fallen_empire_kuat_fleet
				bombardment = indiscriminate

				Dominance = @kuat_invasion_flagship_num_T1  
				Balletor = @kuat_invasion_flagship_num_T2  
				Resugrant = @kuat_invasion_Battleship_num_T3  
				high_Imperial = @kuat_invasion_BattleCruser_num_T3 
				Harrower = @kuat_invasion_Cruser_num_T4  DIFF = 3

				SAV_TARGET = fallen_empire_kuat_fleet_attack
				Location = event_target:begin_kuat_fleet_system.star
				flag = second_attack_fleet
				Fleet_action = ai_action.12
				CTL_TARGET = event_target:fallen_empire_kuat_fleet
			} }
		}
	}
}

create_kuat_defender_and_attack_fleet = {
	optimize_memory
	random_system = {
		limit = { 
			kuat_is_kuat_system = yes 
			exists = starbase
			starbase = { exists = controller controller = { is_kuat_fallen_empire = yes } }
		}
		switch = {
			trigger = has_global_flag
			difficult_exe_invasion = { create_exe_invasion_fleet = {
				NAME = Name_DFLEET
				is_boss = yes  can_disband = no
				Fleet_owner = event_target:fallen_empire_kuat
				bombardment = indiscriminate

				Dominance = @kuat_invasion_flagship_num_T1 
				Tyrant = @kuat_invasion_flagship_num_T2
				Resugrant = @kuat_invasion_Battleship_num_T3  
				high_Imperial = @kuat_invasion_BattleCruser_num_T3  
				Harrower = @kuat_invasion_Cruser_num_T4  DIFF = 1

				Location = prev.star
				flag = first_attack_fleet
				Fleet_action = ai_action.12
				CTL_TARGET = event_target:fallen_empire_kuat
			} }
			normal_exe_invasion = { create_exe_invasion_fleet = {
				NAME = Name_DFLEET
				is_boss = yes  can_disband = no
				Fleet_owner = event_target:fallen_empire_kuat
				bombardment = indiscriminate
				
				Dominance = @kuat_invasion_flagship_num_T1  
				Balletor = @kuat_invasion_flagship_num_T2
				Resugrant = @kuat_invasion_Battleship_num_T3  
				high_Imperial = @kuat_invasion_BattleCruser_num_T3  
				Harrower = @kuat_invasion_Cruser_num_T4  DIFF = 2

				Location = prev.star
				flag = first_attack_fleet
				Fleet_action = ai_action.12
				CTL_TARGET = event_target:fallen_empire_kuat
			} }
			easy_exe_invasion = { create_exe_invasion_fleet = {
				NAME = Name_DFLEET
				is_boss = yes  can_disband = no
				Fleet_owner = event_target:fallen_empire_kuat
				bombardment = indiscriminate
				
				Dominance = @kuat_invasion_flagship_num_T1  
				Titan = @kuat_invasion_flagship_num_T2
				Resugrant = @kuat_invasion_Battleship_num_T3  
				high_Imperial = @kuat_invasion_BattleCruser_num_T3  
				Harrower = @kuat_invasion_Cruser_num_T4  DIFF = 3

				Location = prev.star
				flag = first_attack_fleet
				Fleet_action = ai_action.12
				CTL_TARGET = event_target:fallen_empire_kuat
			} }
			ban_exe_invasion = { create_exe_invasion_fleet = {
				NAME = Name_DFLEET
				is_boss = yes  can_disband = no
				Fleet_owner = event_target:fallen_empire_kuat
				bombardment = indiscriminate
				
				Dominance = @kuat_invasion_flagship_num_T1  
				Tyrant = @kuat_invasion_flagship_num_T2
				Resugrant = @kuat_invasion_Battleship_num_T3  
				high_Imperial = @kuat_invasion_BattleCruser_num_T3  
				Harrower = @kuat_invasion_Cruser_num_T4  DIFF = 1

				Location = prev.star
				flag = first_attack_fleet
				Fleet_action = ai_action.12
				CTL_TARGET = event_target:fallen_empire_kuat
			} }
			default = { create_exe_invasion_fleet = {
				NAME = Name_DFLEET
				is_boss = yes  can_disband = no
				Fleet_owner = event_target:fallen_empire_kuat
				bombardment = indiscriminate
				
				Dominance = @kuat_invasion_flagship_num_T1
				Balletor = @kuat_invasion_flagship_num_T2  
				Resugrant = @kuat_invasion_Battleship_num_T3  
				high_Imperial = @kuat_invasion_BattleCruser_num_T3  
				Harrower = @kuat_invasion_Cruser_num_T4  DIFF = 3

				Location = prev.star
				flag = first_attack_fleet
				Fleet_action = ai_action.12
				CTL_TARGET = event_target:fallen_empire_kuat
			} }
		}
	}
}

create_kuat_defender_and_attack_crisis_fleet = {
	optimize_memory
	every_system = {
		limit = { 
			exists = starbase 
			starbase = { exists = controller controller = { is_kuat_fallen_empire = yes } }
			kuat_is_kuat_system = yes 
		}
		create_fleet = {
			name = "Name_DFLEET"
			effect = {
				set_owner = event_target:fallen_empire_kuat
				while = {
					count = @kuat_invasion_flagship_num_T2
					create_ship = { design = "Name_boss_Venganza" }
				}
				while = {
					count = @kuat_invasion_Cruser_num_T3
					create_ship = { design = "Name_boss_HIGH_EMPIRE" }
				}
				set_location = prev.star
				set_fleet_stance = aggressive
				set_fleet_flag = defensive_galaxy_fleet
				set_fleet_bombardment_stance = indiscriminate
				fleet_execute_order_3 = yes
				event_target:fallen_empire_kuat = { change_variable = { which = fleet_id value = 1 } } 
				set_variable = { which = fleet_id value = event_target:fallen_empire_kuat.fleet_id } 
				solar_system = { set_variable = { which = kuat_fleet_id value = prev.fleet_id } }
			}
			settings = { spawn_debris = no can_disband = no is_boss = yes uses_naval_capacity = no }
		}
	}
}

#KUAT SYSTEM
create_capital_reinforcements_fleet = {
	optimize_memory
	switch = {
		trigger = has_global_flag
		difficult_exe_invasion = { create_exe_invasion_fleet = {
			NAME = Name_DFLEET
			is_boss = yes  can_disband = no
			Fleet_owner = event_target:fallen_empire_kuat
			bombardment = indiscriminate

			Eclipse = @kuat_invasion_flagship_num_T1  
			Tyrant = @kuat_invasion_flagship_num_T2  
			Resugrant = @kuat_invasion_Battleship_num_T3  
			high_Imperial = @kuat_invasion_BattleCruser_num_T3  
			Harrower = @kuat_invasion_Cruser_num_T3  DIFF = 1

			Location = event_target:fallen_empire_kuat.capital_scope
		} }
		normal_exe_invasion = { create_exe_invasion_fleet = {
			NAME = Name_DFLEET
			is_boss = yes  can_disband = no
			Fleet_owner = event_target:fallen_empire_kuat
			bombardment = indiscriminate
			
			Eclipse = @kuat_invasion_flagship_num_T1  
			Balletor = @kuat_invasion_flagship_num_T2  
			Resugrant = @kuat_invasion_Battleship_num_T3  
			high_Imperial = @kuat_invasion_BattleCruser_num_T3  
			Harrower = @kuat_invasion_Cruser_num_T3  DIFF = 2

			Location = event_target:fallen_empire_kuat.capital_scope
		} }
		easy_exe_invasion = { create_exe_invasion_fleet = {
			NAME = Name_DFLEET
			is_boss = yes  can_disband = no
			Fleet_owner = event_target:fallen_empire_kuat
			bombardment = indiscriminate
			
			Eclipse = @kuat_invasion_flagship_num_T1  
			Titan = @kuat_invasion_flagship_num_T2  
			Resugrant = @kuat_invasion_Battleship_num_T3  
			high_Imperial = @kuat_invasion_BattleCruser_num_T3  
			Harrower = @kuat_invasion_Cruser_num_T3  DIFF = 3

			Location = event_target:fallen_empire_kuat.capital_scope
		} }
		ban_exe_invasion = { create_exe_invasion_fleet = {
			NAME = Name_DFLEET
			is_boss = yes  can_disband = no
			Fleet_owner = event_target:fallen_empire_kuat
			bombardment = indiscriminate

			Eclipse = @kuat_invasion_flagship_num_T1  
			Tyrant = @kuat_invasion_flagship_num_T2  
			Resugrant = @kuat_invasion_Battleship_num_T3  
			high_Imperial = @kuat_invasion_BattleCruser_num_T3  
			Harrower = @kuat_invasion_Cruser_num_T3  DIFF = 1

			Location = event_target:fallen_empire_kuat.capital_scope
		} }
		default = { create_exe_invasion_fleet = {
			NAME = Name_DFLEET
			is_boss = yes  can_disband = no
			Fleet_owner = event_target:fallen_empire_kuat
			bombardment = indiscriminate
			
			Eclipse = @kuat_invasion_flagship_num_T1  
			Balletor = @kuat_invasion_flagship_num_T2  
			Resugrant = @kuat_invasion_Battleship_num_T3  
			high_Imperial = @kuat_invasion_BattleCruser_num_T3  
			Harrower = @kuat_invasion_Cruser_num_T3  DIFF = 3

			Location = event_target:fallen_empire_kuat.capital_scope
		} }
	}
}

create_capital_kuat_fleet = {
	optimize_memory
	create_exe_invasion_fleet = {
		NAME = Name_DFLEET_II
		is_boss = yes  can_disband = no
		flag = executor_boss
		Fleet_owner = event_target:fallen_empire_kuat
		bombardment = indiscriminate

		Eclipse = @kuat_invasion_flagship_num_T1  
		Balletor = @kuat_invasion_flagship_num_T2  
		Resugrant = @kuat_invasion_Battleship_num_T3  
		high_Imperial = @kuat_invasion_BattleCruser_num_T3  
		Harrower = @kuat_invasion_Cruser_num_T3  DIFF = 3

		Flagship_flag = ship_ruins ship_class = eclipse
		Location = event_target:fallen_empire_kuat.capital_scope
	}
}

create_kuat_system_fleet = {
	optimize_memory
	random_list = {
		1 = { create_exe_invasion_fleet = {
			NAME = Name_DFLEET
			is_boss = yes  can_disband = no
			Fleet_owner = event_target:fallen_empire_kuat
			bombardment = indiscriminate

			Dominance = @kuat_invasion_flagship_num_T1 
			Titan = @kuat_invasion_flagship_num_T2  
			Resugrant = @kuat_invasion_Battleship_num_T3  
			high_Imperial = @kuat_invasion_BattleCruser_num_T3  
			Harrower = @kuat_invasion_Cruser_num_T4  DIFF = 3
			
			Location = prev
		} }
	}
}

#CISIS FLEET
create_exe_invasion_fleet_detail = {
	optimize_memory
	switch = {
		trigger = has_global_flag
		difficult_exe_invasion = { create_exe_invasion_fleet = {
			#NAME = Name_Eternal
			flag = ag_kuat_invasion_fleet
			is_boss = yes  can_disband = no
			Fleet_owner = event_target:eternal_fleet_country
			bombardment = exe_invasion_bombardment
			Eternal_battleship = @eternal_fleet_battleship_T1 Eternal_flagship = @eternal_fleet_flagship_T1  DIFF = 0
			 
			Initial_invisable = yes
			Location = prev Disable_health = 0.01
		} }
		normal_exe_invasion = { create_exe_invasion_fleet = {
			#NAME = Name_Eternal
			flag = ag_kuat_invasion_fleet
			is_boss = yes  can_disband = no
			Fleet_owner = event_target:eternal_fleet_country
			bombardment = exe_invasion_bombardment
			Eternal_battleship = @eternal_fleet_battleship_T1 Eternal_flagship = @eternal_fleet_flagship_T1  DIFF = 1
			 
			Initial_invisable = yes
			Location = prev Disable_health = 0.01
		} }
		easy_exe_invasion = { create_exe_invasion_fleet = {
			#NAME = Name_Eternal
			flag = ag_kuat_invasion_fleet
			is_boss = yes  can_disband = no
			Fleet_owner = event_target:eternal_fleet_country
			bombardment = exe_invasion_bombardment
			Eternal_battleship = @eternal_fleet_battleship_T1 Eternal_flagship = @eternal_fleet_flagship_T1  DIFF = 2
			 
			Initial_invisable = yes
			Location = prev Disable_health = 0.01
		} }
		ban_exe_invasion = { create_exe_invasion_fleet = {
			#NAME = Name_Eternal
			flag = ag_kuat_invasion_fleet
			is_boss = yes  can_disband = no
			Fleet_owner = event_target:eternal_fleet_country
			bombardment = exe_invasion_bombardment
			Eternal_battleship = @eternal_fleet_battleship_T1 Eternal_flagship = @eternal_fleet_flagship_T1  DIFF = 1
			 
			Initial_invisable = yes
			Location = prev Disable_health = 0.01
		} }
		default = { create_exe_invasion_fleet = {
			#NAME = Name_Eternal
			flag = ag_kuat_invasion_fleet
			is_boss = yes  can_disband = no
			Fleet_owner = event_target:eternal_fleet_country
			bombardment = exe_invasion_bombardment
			Eternal_battleship = @eternal_fleet_battleship_T1 Eternal_flagship = @eternal_fleet_flagship_T1  DIFF = 3
			 
			Initial_invisable = yes
			Location = prev Disable_health = 0.01
		} }
	}
}

create_elternal_system_warbase = {
	optimize_memory
	set_star_flag = eternal_starbase_megastructure_in_system
	set_star_flag = cannot_be_hit_by_aow_starfall_spear
	system_star = {
		set_planet_size = -1
		set_planet_entity = { entity = starforge_avoid_entity }
		if = {
			limit = { has_global_flag = difficult_exe_invasion }
			create_fleet = {
				name = "Name_Eternal_station_fleet"
				settings = { spawn_debris = no can_disband = no }
				effect = {
					save_event_target_as = kuat_station_elternal
					set_owner = event_target:eternal_fleet_country
					create_ship = { design = "NAME_EXE_STARBASE_MEGASTRUCTURE_1" effect = { 
						set_disable_at_health = 0.01 
						set_ship_flag = enable_disable_starbase 
					} }
					set_location = { target = prev distance = -1 angle = 0 }
					[[DAYS] fleet_event = { id = exe_invasion.125 days = $DAYS$ }]
					set_fleet_flag = ag_kuat_invasion_starbase
					set_fleet_flag = ag_kuat_invasion_starbase_disable
					[[LOCK] set_event_locked = $LOCK$ ]
					add_modifier = { modifier = ship_firing_starbase_debuff_own days = $DAYS|-1$ }
				}
			}
		} else = { create_fleet = {
			name = "Name_Eternal_station_fleet"
			settings = { spawn_debris = no can_disband = no }
			effect = {
				save_event_target_as = kuat_station_elternal
				set_owner = event_target:eternal_fleet_country
				create_ship = { design = "NAME_EXE_STARBASE_MEGASTRUCTURE" effect = { 
					set_disable_at_health = 0.01 
					set_ship_flag = enable_disable_starbase 
				} }
				set_location = { target = prev distance = -1 angle = 0 }
				[[DAYS] fleet_event = { id = exe_invasion.125 days = $DAYS$ }]
				set_fleet_flag = ag_kuat_invasion_starbase
				set_fleet_flag = ag_kuat_invasion_starbase_disable
				[[LOCK] set_event_locked = $LOCK$ ]
				add_modifier = { modifier = ship_firing_starbase_debuff_own days = $DAYS|-1$ }
			}
		} }
		create_ambient_object = { type = "contingency_1" location = this }
		last_created_ambient_object = {
			set_ambient_object_flag = space_storm_object
			set_location = { target = prev distance = 0 angle = random }
		}
	}
}

create_eternal_defensive_fleet = {
	optimize_memory
	switch = {
		trigger = has_global_flag
		difficult_exe_invasion = { create_exe_invasion_fleet = {
			#NAME = Name_Eternal
			flag = ag_kuat_defenced_fleet
			is_boss = yes  can_disband = no
			Fleet_owner = event_target:eternal_fleet_country
			bombardment = exe_invasion_bombardment
			Eternal_battleship = @eternal_fleet_battleship_T3 Eternal_flagship = @eternal_fleet_flagship_T2  DIFF = 0
			Initial_invisable = yes
			Location = prev.star Disable_health = 0.01
		} }
		normal_exe_invasion = { create_exe_invasion_fleet = {
			#NAME = Name_Eternal
			flag = ag_kuat_defenced_fleet
			is_boss = yes  can_disband = no
			Fleet_owner = event_target:eternal_fleet_country
			bombardment = exe_invasion_bombardment
			Eternal_battleship = @eternal_fleet_battleship_T3 Eternal_flagship = @eternal_fleet_flagship_T2  DIFF = 1
			Initial_invisable = yes
			Location = prev.star Disable_health = 0.01
		} }
		easy_exe_invasion = { create_exe_invasion_fleet = {
			#NAME = Name_Eternal
			flag = ag_kuat_defenced_fleet
			is_boss = yes  can_disband = no
			Fleet_owner = event_target:eternal_fleet_country
			bombardment = exe_invasion_bombardment
			Eternal_battleship = @eternal_fleet_battleship_T3 Eternal_flagship = @eternal_fleet_flagship_T2  DIFF = 2
			Initial_invisable = yes
			Location = prev.star Disable_health = 0.01
		} }
		ban_exe_invasion = { create_exe_invasion_fleet = {
			#NAME = Name_Eternal
			flag = ag_kuat_defenced_fleet
			is_boss = yes  can_disband = no
			Fleet_owner = event_target:eternal_fleet_country
			bombardment = exe_invasion_bombardment
			Eternal_battleship = @eternal_fleet_battleship_T3 Eternal_flagship = @eternal_fleet_flagship_T2  DIFF = 1
			Initial_invisable = yes
			Location = prev.star Disable_health = 0.01
		} }
		default = { create_exe_invasion_fleet = {
			#NAME = Name_Eternal
			flag = ag_kuat_defenced_fleet
			is_boss = yes  can_disband = no
			Fleet_owner = event_target:eternal_fleet_country
			bombardment = exe_invasion_bombardment
			Eternal_battleship = @eternal_fleet_battleship_T3 Eternal_flagship = @eternal_fleet_flagship_T2  DIFF = 3
			Initial_invisable = yes
			Location = prev.star Disable_health = 0.01
		} }
	}
}

create_exe_retrun_invasion_fleet_detail = {
	optimize_memory
	switch = {
		trigger = has_global_flag
		difficult_exe_invasion = { create_exe_invasion_fleet = {
			#NAME = Name_Eternal
			flag = ag_kuat_invasion_fleet
			is_boss = yes  can_disband = no
			Fleet_owner = event_target:eternal_fleet_country
			bombardment = exe_invasion_bombardment
			Eternal_battleship = @eternal_fleet_battleship_T2 Eternal_flagship = @eternal_fleet_flagship_T2  DIFF = 0
			Initial_invisable = yes
			Location = prev Disable_health = 0.01
		} }
		normal_exe_invasion = { create_exe_invasion_fleet = {
			#NAME = Name_Eternal
			flag = ag_kuat_invasion_fleet
			is_boss = yes  can_disband = no
			Fleet_owner = event_target:eternal_fleet_country
			bombardment = exe_invasion_bombardment
			Eternal_battleship = @eternal_fleet_battleship_T2 Eternal_flagship = @eternal_fleet_flagship_T2  DIFF = 1
			Initial_invisable = yes
			Location = prev Disable_health = 0.01
		} }
		easy_exe_invasion = { create_exe_invasion_fleet = {
			#NAME = Name_Eternal
			flag = ag_kuat_invasion_fleet
			is_boss = yes  can_disband = no
			Fleet_owner = event_target:eternal_fleet_country
			bombardment = exe_invasion_bombardment
			Eternal_battleship = @eternal_fleet_battleship_T2 Eternal_flagship = @eternal_fleet_flagship_T2  DIFF = 2
			Initial_invisable = yes
			Location = prev Disable_health = 0.01
		} }
		ban_exe_invasion = { create_exe_invasion_fleet = {
			#NAME = Name_Eternal
			flag = ag_kuat_invasion_fleet
			is_boss = yes  can_disband = no
			Fleet_owner = event_target:eternal_fleet_country
			bombardment = exe_invasion_bombardment
			Eternal_battleship = @eternal_fleet_battleship_T2 Eternal_flagship = @eternal_fleet_flagship_T2  DIFF = 1
			Initial_invisable = yes
			Location = prev Disable_health = 0.01
		} }
		default = { create_exe_invasion_fleet = {
			#NAME = Name_Eternal
			flag = ag_kuat_invasion_fleet
			is_boss = yes  can_disband = no
			Fleet_owner = event_target:eternal_fleet_country
			bombardment = exe_invasion_bombardment
			Eternal_battleship = @eternal_fleet_battleship_T2 Eternal_flagship = @eternal_fleet_flagship_T2  DIFF = 3
			Initial_invisable = yes
			Location = prev Disable_health = 0.01
		} }
	}
}

#CREATE FLEET SCRIPT
create_exe_invasion_fleet = {
	optimize_memory
	create_fleet = {
		[[NAME] name = $NAME$ ]
		settings = { uses_naval_capacity = no spawn_debris = no can_disband = $can_disband$ is_boss = $is_boss$ }
		effect = {
			[[flag] set_fleet_flag = $flag$ ]
			[[Fleet_owner] set_owner = $Fleet_owner$ ]
			[[bombardment] set_fleet_bombardment_stance = $bombardment$ ] 

			#special ships
			[[Annihilator] while = { count = $Annihilator$ create_ship = { design = NAME_KUAT_Annihilator } }]
			[[Eclipse] while = { count = $Eclipse$ create_ship = { design = Name_boss_eclipse } }]

			#invasion ships
			[[Infinite_Battleship] while = { count = $Infinite_Battleship$ create_ship = { design = Name_boss_crisis_IBC_$DIFF$ } }]
			[[Infinite_Crusier] while = { count = $Infinite_Crusier$ create_ship = { design = Name_boss_crisis_IC_$DIFF$ } }]
			[[Infinite_Mothership] while = { count = $Infinite_Mothership$ create_ship = { design = Name_boss_crisis_IMS_$DIFF$ } }]

			#Drift ships
			[[Drift_Battleship] while = { count = $Drift_Battleship$ create_ship = { design = Name_boss_crisis_DB_$DIFF$ effect = {
				set_ship_flag = enable_drft_ship_inital set_disable_at_health = 0.01
				set_variable = { which = DRFT_SHIP_HEALTH_VAR value = $HEALTH|1$ }
			} } }]
			[[Drift_Crusier] while = { count = $Drift_Crusier$ create_ship = { design = Name_boss_crisis_DC_$DIFF$ effect = {
				set_ship_flag = enable_drft_ship_inital set_disable_at_health = 0.01
				set_variable = { which = DRFT_SHIP_HEALTH_VAR value = $HEALTH|1$ }
			} } }]

			#player ships
			[[Balletor] while = { count = $Balletor$ create_ship = { design = Name_boss_CRISIS_Balletor_$DIFF$ } }]
			[[Titan] while = { count = $Titan$ create_ship = { design = Name_boss_CRISIS_Titan_$DIFF$ } }]
			[[Tyrant] while = { count = $Tyrant$ create_ship = { design = Name_criss_boss_Tyrant_$DIFF$ } }]

			[[Sector] while = { count = $Sector$ create_ship = { design = Name_boss_crisis_Sector_$DIFF$ } }]
			[[Venganza] while = { count = $Venganza$ create_ship = { design = Name_boss_crisis_Venganza_$DIFF$ } }]
			[[Dominance] while = { count = $Dominance$ create_ship = { design = Name_boss_CRISIS_Dominance_$DIFF$ } }]
			[[Resugrant] while = { count = $Resugrant$ create_ship = { design = Name_boss_crisis_Resugrant_$DIFF$ } }]
			[[Imperial] while = { count = $Imperial$ create_ship = { design = Name_boss_crisis_EMPIRE_$DIFF$ } }]
			[[high_Imperial] while = { count = $high_Imperial$ create_ship = { design = Name_boss_crisis_HIGH_EMPIRE_$DIFF$ } }]
			[[Harrower] while = { count = $Harrower$ create_ship = { design = Name_criss_boss_Horriwer_$DIFF$ } }]
			[[Eternal_battleship] while = { count = $Eternal_battleship$ create_ship = { design = Name_boss_crisis_EBC_$DIFF$ } }] 
			[[Eternal_flagship] while = { count = $Eternal_flagship$ create_ship = { design = Name_boss_crisis_EFS_$DIFF$ } }] 

			#String varaible
			[[Location] set_location = { target = $Location$ distance = 25 angle = random }]
			[[Initial_invisable] fleet_event = { id = exe_invasion.1987 }]
			[[Fleet_action] fleet_event = { id = $Fleet_action$ }]
			[[Flagship_flag] random_owned_ship = { limit = { is_ship_size = $ship_class$ } set_ship_flag = $Flagship_flag$ }]
			[[Disable_health] every_owned_ship = { set_disable_at_health = $Disable_health$ }]
			[[modifier] add_modifier = { modifier = $modifier$ }]

			#fleet target
			[[CTL_TARGET] $CTL_TARGET$ = { change_variable = { which = fleet_id value = 1 } } set_variable = { 
				which = fleet_id value = $CTL_TARGET$.fleet_id } 
				solar_system = { set_variable = { which = kuat_fleet_id value = prev.fleet_id } 
			}]
			[[SAV_TARGET] save_event_target_as = $SAV_TARGET$ ]
		}
	}
}

#MILLATERY BASE AND STARKILLER BASE
create_kuat_fleet_country_type = {
	optimize_memory
	set_update_modifiers_batch = begin
	create_country = {
		name = "Kuat Military Base"
		type = kuat_fleet
		name_list = "MAM3"
		species = event_target:kuat_player_target_species
		flag = {
			icon = {
				category = "Kuat"
				file = "Kuat_flags_01.dds"
			}
			background = {
				category = "backgrounds"
				file = "00_solid.dds"
			}
			colors = { "blue" "blue" "null" "null" }
		}
		effect = {
			add_modifier = { modifier = Elternal_creating }
			save_global_event_target_as = fallen_empire_kuat_fleet
			set_graphical_culture = fallen_empire_kuat_01
			set_country_flag = fallen_empire_kuat_fleet
			add_resource = {
				minerals = 1000000
				energy = 1000000
				food = 1000000
				influence = 1000000
				sr_dark_matter = 1000000
				sr_living_metal = 100000
				sr_zro = 1000000
				consumer_goods = 1000000
			}
			add_modifier = { modifier = Kuat_ship }
			create_ship_design = { design = "NAME_KUAT_Starbase" }
			add_ship_design = last_created_design
			set_faction_hostility = {
				target = event_target:fallen_empire_kuat
				set_friendly = yes set_hostile = no
			}
		}
	}
	set_update_modifiers_batch = end
}

create_kuat_fleet_country_type_defend_army = {
	optimize_memory
	switch = {
		trigger = has_global_flag
		difficult_exe_invasion = { create_exe_invasion_fleet = {
			is_boss = yes  can_disband = no
			Fleet_owner = event_target:fallen_empire_kuat_fleet
			flag = kuat_fundation_main_fleet
			bombardment = indiscriminate
			Venganza = @kuat_invasion_flagship_num_T1  
			Tyrant = @kuat_invasion_flagship_num_T2 
			Resugrant = @kuat_invasion_Battleship_num_T3  
			high_Imperial = @kuat_invasion_BattleCruser_num_T3  
			Harrower = @kuat_invasion_Cruser_num_T4  DIFF = 1
			Location = prev
		} }
		normal_exe_invasion = { create_exe_invasion_fleet = {
			is_boss = yes  can_disband = no
			Fleet_owner = event_target:fallen_empire_kuat_fleet
			flag = kuat_fundation_main_fleet
			bombardment = indiscriminate
			Venganza = @kuat_invasion_flagship_num_T1   
			Balletor = @kuat_invasion_flagship_num_T2
			Resugrant = @kuat_invasion_Battleship_num_T3  
			high_Imperial = @kuat_invasion_BattleCruser_num_T3  
			Harrower = @kuat_invasion_Cruser_num_T4  DIFF = 2
			Location = prev
		} }
		easy_exe_invasion = { create_exe_invasion_fleet = {
			is_boss = yes  can_disband = no
			Fleet_owner = event_target:fallen_empire_kuat_fleet
			flag = kuat_fundation_main_fleet
			bombardment = indiscriminate
			Venganza = @kuat_invasion_flagship_num_T1  
			Titan = @kuat_invasion_flagship_num_T2 
			Resugrant = @kuat_invasion_Battleship_num_T3  
			high_Imperial = @kuat_invasion_BattleCruser_num_T3  
			Harrower = @kuat_invasion_Cruser_num_T4  DIFF = 3
			Location = prev
		} }
		ban_exe_invasion = { create_exe_invasion_fleet = {
			is_boss = yes  can_disband = no
			Fleet_owner = event_target:fallen_empire_kuat_fleet
			flag = kuat_fundation_main_fleet
			bombardment = indiscriminate
			Venganza = @kuat_invasion_flagship_num_T1   
			Tyrant = @kuat_invasion_flagship_num_T2
			Resugrant = @kuat_invasion_Battleship_num_T3  
			high_Imperial = @kuat_invasion_BattleCruser_num_T3  
			Harrower = @kuat_invasion_Cruser_num_T4  DIFF = 1
			Location = prev
		} }
		default = { create_exe_invasion_fleet = {
			is_boss = yes  can_disband = no
			Fleet_owner = event_target:fallen_empire_kuat_fleet
			flag = kuat_fundation_main_fleet
			bombardment = indiscriminate
			Venganza = @kuat_invasion_flagship_num_T1  
			Balletor = @kuat_invasion_flagship_num_T2 
			Resugrant = @kuat_invasion_Battleship_num_T3  
			high_Imperial = @kuat_invasion_BattleCruser_num_T3  
			Harrower = @kuat_invasion_Cruser_num_T4  DIFF = 3
			Location = prev
		} }
	}
}

create_kuat_fire_base_country_type_defend_army = {
	optimize_memory
	switch = {
		trigger = has_global_flag
		difficult_exe_invasion = { create_exe_invasion_fleet = {
			is_boss = yes  can_disband = no
			Fleet_owner = event_target:kuat_firebase_country
			bombardment = indiscriminate
			Venganza = @kuat_invasion_flagship_num_T1   
			Tyrant = @kuat_invasion_flagship_num_T2
			Resugrant = @kuat_invasion_Battleship_num_T3  
			high_Imperial = @kuat_invasion_BattleCruser_num_T3  
			Harrower = @kuat_invasion_Cruser_num_T4  DIFF = 3
			Location = prev
		} }
		normal_exe_invasion = { create_exe_invasion_fleet = {
			is_boss = yes  can_disband = no
			Fleet_owner = event_target:kuat_firebase_country
			bombardment = indiscriminate
			Venganza = @kuat_invasion_flagship_num_T1   
			Balletor = @kuat_invasion_flagship_num_T2
			Resugrant = @kuat_invasion_Battleship_num_T3  
			high_Imperial = @kuat_invasion_BattleCruser_num_T3  
			Harrower = @kuat_invasion_Cruser_num_T4  DIFF = 3
			Location = prev
		} }
		easy_exe_invasion = { create_exe_invasion_fleet = {
			is_boss = yes  can_disband = no
			Fleet_owner = event_target:kuat_firebase_country
			bombardment = indiscriminate
			Venganza = @kuat_invasion_flagship_num_T1   
			Titan = @kuat_invasion_flagship_num_T2
			Resugrant = @kuat_invasion_Battleship_num_T3  
			high_Imperial = @kuat_invasion_BattleCruser_num_T3  
			Harrower = @kuat_invasion_Cruser_num_T4  DIFF = 3
			Location = prev
		} }
		ban_exe_invasion = { create_exe_invasion_fleet = {
			is_boss = yes  can_disband = no
			Fleet_owner = event_target:kuat_firebase_country
			bombardment = indiscriminate
			Venganza = @kuat_invasion_flagship_num_T1   
			Tyrant = @kuat_invasion_flagship_num_T2
			Resugrant = @kuat_invasion_Battleship_num_T3  
			high_Imperial = @kuat_invasion_BattleCruser_num_T3  
			Harrower = @kuat_invasion_Cruser_num_T4  DIFF = 1
			Location = prev
		} }
		default = { create_exe_invasion_fleet = {
			is_boss = yes  can_disband = no
			Fleet_owner = event_target:kuat_firebase_country
			bombardment = indiscriminate
			Venganza = @kuat_invasion_flagship_num_T1   
			Balletor = @kuat_invasion_flagship_num_T2
			Resugrant = @kuat_invasion_Battleship_num_T3  
			high_Imperial = @kuat_invasion_BattleCruser_num_T3  
			Harrower = @kuat_invasion_Cruser_num_T4  DIFF = 3
			Location = prev
		} }
	}
}

#starkiller check effect
starkiller_destroyed_system_everything = {
	optimize_memory
	set_update_modifiers_batch = begin
	if = {
		limit = { exists = event_target:crisis_country }
		fire_on_action = {
			on_action = on_destroy_star_system
			scopes = { from = event_target:crisis_country }
		}
	}
	else = { fire_on_action = { on_action = on_destroy_star_system } }
	set_star_flag = star_cracked
	every_system_planet = {
		limit = { is_star = yes }
		create_ambient_object = { type = "star_explosion" play_animation_once = yes location = this }
		last_created_ambient_object = { set_location = { target = prev distance = 0 angle = random } }
		create_ambient_object = { type = "destroyed_system" location = this }
        last_created_ambient_object = { set_ambient_object_flag = destroyed_system_effect set_location = { target = prev  distance = 0  angle = random  } }
	}
	every_system_planet = {
		clear_deposits = yes
		clear_planet_modifiers = yes
		prevent_anomaly = yes
	}
	root = { random_owned_fleet = { 
		save_event_target_as = foa_target_fleet 
		random_owned_ship = { save_event_target_as = foa_target_ship }
	} }
	every_fleet_in_system = {
		limit = { 
			exists = owner
			owner = { NOR = { 
				is_same_value = root 
				is_kuat_fallen_empire = yes
			} } 
		}
		foa_effect_the_crisis_fleet = yes
		foa_effect_the_crisis_ship = yes
		foa_effect_the_crisis_starbase = yes
		destroy_fleet = { target = this destroy_template = yes kill_leader = yes }
	}
	every_system_megastructure = {
		if = {
			limit = { OR = {
				is_megastructure_type = ring_world_restored 
				is_megastructure_type = ring_world_ruined
				is_megastructure_type = ring_world_2
				is_megastructure_type = kuat_ring_world_1
				is_megastructure_type = kuat_ring_world_2
			} }
			solar_system = {
				spawn_planet = {
					class = "pc_ringworld_tech_damaged"
					location = prev
					orbit_angle_offset = 30
				}
				spawn_planet = {
					class = "pc_ringworld_seam_damaged"
					location = prev
				}
				spawn_planet = {
					class = "pc_ringworld_habitable_damaged"
					location = prev
					orbit_angle_offset = -30
				}
			}
			remove_megastructure = this
		}
		else_if = {
			limit = { OR = {
				is_megastructure_type = spy_orb_1
				is_megastructure_type = spy_orb_2
				is_megastructure_type = spy_orb_3
				is_megastructure_type = spy_orb_4
				is_megastructure_type = spy_orb_ruined
				is_megastructure_type = spy_orb_restored
			} }
			solar_system = {
				spawn_megastructure = { 
					type = "spy_orb_permanently_ruined"
					coords_from = prev
				}
			}
			remove_megastructure = this
		}
		else_if = {
			limit = { OR = {
				is_megastructure_type = think_tank_1
				is_megastructure_type = think_tank_2
				is_megastructure_type = think_tank_3
				is_megastructure_type = think_tank_4
				is_megastructure_type = think_tank_ruined
				is_megastructure_type = think_tank_restored
			} }
			solar_system = {
				spawn_megastructure = { 
					type = "think_tank_permanently_ruined"
					coords_from = prev
				}
			}
			remove_megastructure = this
		}
		else_if = {
			limit = { OR = {
				is_megastructure_type = strategic_coordination_center_1
				is_megastructure_type = strategic_coordination_center_2
				is_megastructure_type = strategic_coordination_center_3
				is_megastructure_type = strategic_coordination_center_ruined
				is_megastructure_type = strategic_coordination_center_restored
			} }
			solar_system = {
				spawn_megastructure = { 
					type = "strategic_coordination_center_permanently_ruined"
					coords_from = prev
				}
			}
			remove_megastructure = this
		}
		else_if = {
			limit = {
				OR = {
					is_megastructure_type = mega_art_installation_1
					is_megastructure_type = mega_art_installation_2
					is_megastructure_type = mega_art_installation_3
					is_megastructure_type = mega_art_installation_4
					is_megastructure_type = strategic_coordination_center_ruined
					is_megastructure_type = strategic_coordination_center_restored
				}
			}
			solar_system = {
				spawn_megastructure = { 
					type = "mega_art_installation_permanently_ruined"
					coords_from = prev
				}
			}
			remove_megastructure = this
		}
		else_if = {
			limit = { OR = {
				is_megastructure_type = interstellar_assembly_1
				is_megastructure_type = interstellar_assembly_2
				is_megastructure_type = interstellar_assembly_3
				is_megastructure_type = interstellar_assembly_4
				is_megastructure_type = interstellar_assembly_ruined
				is_megastructure_type = interstellar_assembly_restored
			} }
			solar_system = {
				spawn_megastructure = { 
					type = "interstellar_assembly_permanently_ruined"
					coords_from = prev
				}
			}
			remove_megastructure = this
		}
		else_if = {
			limit = { OR = {
				is_megastructure_type = mega_shipyard_1
				is_megastructure_type = mega_shipyard_2
				is_megastructure_type = mega_shipyard_3
				is_megastructure_type = mega_shipyard_ruined
				is_megastructure_type = mega_shipyard_restored
			} }
			solar_system = {
				spawn_megastructure = { 
					type = "mega_shipyard_permanently_ruined"
					coords_from = prev
				}
			}
			remove_megastructure = this
		}
		else_if = {
			limit = { OR = {
				is_megastructure_type = matter_decompressor_1
				is_megastructure_type = matter_decompressor_2
				is_megastructure_type = matter_decompressor_3
				is_megastructure_type = matter_decompressor_4
				is_megastructure_type = matter_decompressor_ruined
				is_megastructure_type = matter_decompressor_restored
			} }
			solar_system = {
				spawn_megastructure = { 
					type = "matter_decompressor_permanently_ruined"
					coords_from = prev
				}
			}
			remove_megastructure = this
		}
		else_if = {
			limit = {
				OR = {
					is_megastructure_type = quantum_catapult_1
					is_megastructure_type = quantum_catapult_2
					is_megastructure_type = quantum_catapult_3
					is_megastructure_type = quantum_catapult_ruined
					is_megastructure_type = quantum_catapult_restored
				}
			}
			solar_system = {
				spawn_megastructure = {
					type = "quantum_catapult_permanently_ruined"
					coords_from = prev
				}
			}
			remove_megastructure = this
		}
		else_if = {
			limit = {
				OR = {
					is_megastructure_type = hyper_relay
					is_megastructure_type = hyper_relay_restored
				}
			}
			solar_system = {
				spawn_megastructure = {
					type = "hyper_relay_ruined"
					coords_from = prev
				}
			}
			remove_megastructure = this
		}
		else_if = {
			limit = { is_crisis_sphere = yes }
			solar_system = {
				spawn_megastructure = {
					type = crisis_sphere_ruined
					coords_from = prev
					init_effect = {
						random_country = {
							limit = {
								prev = { has_megastructure_flag = crisis_sphere_of@prev }
							}
							save_event_target_as = former_owner
						}
						set_megastructure_flag = crisis_sphere_of@event_target:former_owner
					}
				}
			}
			remove_megastructure = this
		}
		else_if = {
			limit = { OR = {
				is_megastructure_type = kuat_starkiller_marker_2 
				is_megastructure_type = kuat_starkiller_marker_2_1
			} }
			set_megastructure_flag = kuat_starkiller_marker_2
		}
		else_if = {
			limit = { OR = {
				is_megastructure_type = exe_outer_gate
				is_megastructure_type = exe_outer_gate_locked
				is_megastructure_type = exe_outer_gate_disable
				is_megastructure_type = Shield_Gate
			} }
			set_timed_megastructure_flag = { flag = kuat_gate_being_attack days = 1 }
		}
		else = { remove_megastructure = this }
	}
	system_event = { id = kuat_starkiller.8 days = 120 }
	set_update_modifiers_batch = end
}

#scope: fleet
foa_effect_the_crisis_fleet = {
	optimize_memory
	root = { fire_on_action = {
		on_action = on_fleet_destroyed_perp
		scopes = {
			from = prev.owner
			fromfrom = event_target:foa_target_fleet
			fromfromfrom = prev
		}
	} }
	owner = { fire_on_action = {
		on_action = on_fleet_destroyed_victim
		scopes = {
			from = root
			fromfrom = prev
			fromfromfrom = event_target:foa_target_fleet
		}
	} }
}

#scope: ship
foa_effect_the_crisis_ship = {
	optimize_memory
	every_owned_ship = {
		root = { fire_on_action = {
			on_action = on_ship_destroyed_perp
			scopes = {
				from = prev.owner
				fromfrom = event_target:foa_target_ship
				fromfromfrom = prev
			}
		} }
		owner = { fire_on_action = {
			on_action = on_ship_destroyed_victim
			scopes = {
				from = root
				fromfrom = prev
				fromfromfrom = event_target:foa_target_ship
			}
		} }
	}
}

#scope: starbase
foa_effect_the_crisis_starbase = {
	optimize_memory
	if = {
		limit = { is_ship_class = shipclass_starbase }
		starbase = { fire_on_action = {
			on_action = on_starbase_destroyed
			scopes = { from = event_target:foa_target_fleet }
		} }
	}
}

reset_return_eternal_fleet = {
	optimize_memory
	if = {
		limit = { has_origin = origin_kuat_apocalyptic }
		remove_global_flag = enable_the_eternal_starbase
		remove_global_flag = can_win_the_fleet
		remove_global_flag = exe_return_invasion_seed
		remove_global_flag = exe_return_invasion_3_fired
		remove_global_flag = exe_return_invasion_5_fired
		remove_global_flag = exe_return_invasion_7_fired
		remove_global_flag = exe_return_invasion_begin
		remove_global_flag = exe_return_invasion_ended
		remove_global_flag = enbale_last_invasion
		remove_global_flag = ban_exe_invasion
		remove_global_flag = can_win_the_fleet_stage_1
		remove_country_flag = fire_first_find
		remove_country_flag = second_first_find
		remove_country_flag = third_first_find
		clear_variable = num_vaild_system
		clear_variable = num_finish
		every_system = {
			limit = {
				OR = {
					has_star_flag = final_1_system
					has_star_flag = final_2_system
					has_star_flag = final_3_system
				}
			}
			remove_star_flag = final_1_system
			remove_star_flag = final_2_system
			remove_star_flag = final_3_system
		}
		remove_country_flag = exe_return_invasion_2_fired
		if = {
			limit = {
				OR = {
					has_global_flag = ban_exe_invasion
					has_global_flag = normal_exe_invasion
					has_global_flag = easy_exe_invasion
					has_global_flag = difficult_exe_invasion
				}
			}
			remove_global_flag = ban_exe_invasion
			remove_global_flag = normal_exe_invasion
			remove_global_flag = easy_exe_invasion
			remove_global_flag = difficult_exe_invasion
		}
		set_global_flag = difficult_exe_invasion
		event_target:global_event_country = { 
			set_variable = { which = exe_invasion_difficult_global_var value = 3 } 
			if = {
				limit = { has_global_flag = enable_modifer_check }
				multiply_variable = { which = exe_invasion_difficult_global_var value = 2 }
			}
			if = {
				limit = { has_global_flag = kuat_impulse_mod_settings }
				multiply_variable = { which = exe_invasion_difficult_global_var value = 3 }
			}
		}
		set_global_flag = enbale_last_invasion
	}
	else = {
		remove_global_flag = enbale_last_invasion
		remove_global_flag = can_win_the_fleet
		remove_global_flag = exe_return_invasion_seed
		remove_global_flag = exe_return_invasion_3_fired
		remove_global_flag = exe_return_invasion_5_fired
		remove_global_flag = exe_return_invasion_7_fired
		remove_global_flag = exe_return_invasion_begin
		remove_global_flag = exe_return_invasion_ended
		remove_global_flag = can_win_the_fleet_stage_1
		remove_country_flag = fire_first_find
		remove_country_flag = second_first_find
		remove_country_flag = third_first_find
		clear_variable = num_vaild_system
		clear_variable = num_finish
		every_system = {
			limit = {
				OR = {
					has_star_flag = final_1_system
					has_star_flag = final_2_system
					has_star_flag = final_3_system
				}
			}
			remove_star_flag = final_1_system
			remove_star_flag = final_2_system
			remove_star_flag = final_3_system
		}
		remove_country_flag = exe_return_invasion_2_fired
		set_global_flag = enbale_last_invasion
		remove_global_flag = enable_the_eternal_starbase
	}
}

kuat_orgin_initial_starbase_kuat_system = {
	optimize_memory
	event_target:Kuat_system_int = {
		create_starbase = {
			size = "starbase_citadel"
			module = "shipyard"
			module = "shipyard"
			module = "shipyard"
			module = "shipyard"
			module = "shipyard"
			module = "shipyard"
			building = "target_uplink_computer"
			building = "colossus_yards"
			building = "titan_yards"
			building = "crew_quarters"
			owner = root
		}
	}
	event_target:Kuat_system_int_1 = {
		create_starbase = {
			size = "starbase_citadel"
			module = "shipyard"
			module = "shipyard"
			module = "shipyard"
			module = "shipyard"
			module = "shipyard"
			module = "shipyard"
			building = "target_uplink_computer"
			building = "colossus_yards"
			building = "titan_yards"
			building = "crew_quarters"
			owner = root
		}
	}
	event_target:Kuat_system_int_2 = {
		create_starbase = {
			size = "starbase_citadel"
			module = "shipyard"
			module = "shipyard"
			module = "shipyard"
			module = "shipyard"
			module = "shipyard"
			module = "shipyard"
			building = "target_uplink_computer"
			building = "colossus_yards"
			building = "titan_yards"
			building = "crew_quarters"
			owner = root
		}
	}
	event_target:Kuat_system_int_3 = {
		create_starbase = {
			size = "starbase_citadel"
			module = "shipyard"
			module = "shipyard"
			module = "shipyard"
			module = "shipyard"
			module = "shipyard"
			module = "shipyard"
			building = "target_uplink_computer"
			building = "colossus_yards"
			building = "titan_yards"
			building = "crew_quarters"
			owner = root
		}
	}
	event_target:Kuat_system_int_4 = {
		create_starbase = {
			size = "starbase_citadel"
			module = "shipyard"
			module = "shipyard"
			module = "shipyard"
			module = "shipyard"
			module = "shipyard"
			module = "shipyard"
			building = "target_uplink_computer"
			building = "colossus_yards"
			building = "titan_yards"
			building = "crew_quarters"
			owner = root
		}
	}
}

kuat_origin_give_all_ship_and_tech = {
	optimize_memory
	set_country_flag = kuat_can_buid_kuat_building
	set_country_flag = can_restore_the_black_hole
	set_country_flag = kuat_unlock_the_flagship_designable
	set_country_flag = can_build_supermacy
	set_country_flag = kuat_debug_give_all_tech_flag
	give_technology = { tech = tech_kuat_ground_yards message = no }
	give_technology = { tech = tech_kuat_megastructrue message = no }
	give_technology = { tech = tech_kuat_resource_center message = no }
	give_technology = { tech = tech_kuat_command_center message = no }
	give_technology = { tech = tech_kuat_founfry message = no }
	give_technology = { tech = tech_kuat_databank message = no }
	give_technology = { tech = tech_kuat_shield message = no }
	give_technology = { tech = tech_kuat_reactor message = no }
	give_technology = { tech = tech_kuat_THRUSTER message = no }
	give_technology = { tech = tech_exe_jump_drive message = no }
	give_technology = { tech = tech_kuat_noway message = no }
	give_technology = { tech = tech_eternal_fleet message = no }
	give_technology = { tech = tech_kuat_starbase message = no }
	give_technology = { tech = tech_kuat_megastructrue message = no }
	if = {
		limit = { NOT = { has_existing_ship_design = Venator_modifier } }
		create_ship_design = { design = "Name_boss_Venator" }
		add_ship_design = last_created_design
	}
	if = {
		limit = { NOT = { has_existing_ship_design = swfo_resurgent } }
		create_ship_design = { design = "Name_boss_Resugrant" }
		add_ship_design = last_created_design
	}
	if = {
		limit = { NOT = { has_existing_ship_design = horrizone } }
		create_ship_design = { design = "Name_boss_Horriwer" }
		add_ship_design = last_created_design
	}
	if = {
		limit = { NOT = { has_existing_ship_design = high_Imperial_star_destroyer } }
		create_ship_design = { design = "Name_boss_HIGH_EMPIRE" }
		add_ship_design = last_created_design
	}
	if = {
		limit = { NOT = { has_existing_ship_design = Vengeance } }
		create_ship_design = { design = "Name_boss_Venganza" }
		add_ship_design = last_created_design
	}
	if = {
		limit = { NOT = { has_existing_ship_design = nebula_dominance } }
		create_ship_design = { design = "Name_boss_Dominance" }
		add_ship_design = last_created_design
	}
	if = {
		limit = { NOT = { has_existing_ship_design = eclipse } }
		create_ship_design = { design = "Name_boss_eclipse" }
		add_ship_design = last_created_design
	}
	if = {
		limit = { NOT = { has_existing_ship_design = X308_Balletor } }
		create_ship_design = { design = "Name_boss_X308_Balletor" }
		add_ship_design = last_created_design
	}
	if = {
		limit = { NOT = { has_existing_ship_design = X308_Titan } }
		create_ship_design = { design = "Name_boss_X308_Titan" }
		add_ship_design = last_created_design
	}
	if = {
		limit = { NOT = { has_existing_ship_design = X308_Tyrant } }
		create_ship_design = { design = "NAME_KUAT_Tyrant" }
		add_ship_design = last_created_design
	}
	if = {
		limit = { NOT = { has_existing_ship_design = Annihilator } }
		create_ship_design = { design = "NAME_KUAT_Annihilator" }
		add_ship_design = last_created_design
	}
	if = {
		limit = { NOT = { has_existing_ship_design = kuat_sector } }
		create_ship_design = { design = "Name_boss_Sector" }
		add_ship_design = last_created_design
	}
}

kuat_research_all_technology = {
	optimize_memory
	create_country = {
		name = random
		type = fallen_empire
		ignore_initial_colony_error = yes
		authority = auth_imperial
		civics = {
			civic = civic_lethargic_leadership
			civic = civic_empire_in_decline
		}
		species = root
		ethos = { ethic = ethic_fanatic_materialist }
		flag = random
		origin = "origin_fallen_empire"
		effect = {
			save_event_target_as = kuat_tech_country
			set_graphical_culture = "fallen_empire_02"
			set_city_graphical_culture = "fallen_empire_02"
		}
	}
	copy_techs_from = { target = event_target:kuat_tech_country }
}

#######################
#eternal empire origin#
#######################
create_elternal_origin_system_warbase = {
	optimize_memory
	set_star_flag = eternal_origin_starbase_megastructure_in_system
	system_star = {
		set_planet_size = -1
		set_planet_entity = { entity = starforge_avoid_entity }
		create_fleet = {
			name = "Name_Eternal_station_fleet"
			settings = { spawn_debris = no can_disband = no }
			effect = {
				save_event_target_as = eternal_origin_station_elternal
				set_owner = event_target:eternal_support_country
				create_ship = { design = "NAME_EXE_STARBASE_MEGASTRUCTURE" }
				set_location = { target = prev distance = -1 angle = 0 }
				set_fleet_flag = eternal_support_country_starbase
				[[LOCK] set_event_locked = $LOCK$ ]
				add_modifier = { modifier = ship_firing_starbase_debuff_own days = $DAYS|-1$ }
			}
		}
		create_ambient_object = { type = "contingency_1" location = this }
		last_created_ambient_object = {
			set_ambient_object_flag = space_storm_object
			set_location = { target = prev distance = 0 angle = random }
		}
	}
	every_system_planet = {
		limit = {
			exists = owner
			is_colony = yes
		}
		add_modifier = { modifier = "exe_megastructure_starbase_in_system" }
	}
}

# scope: planet
create_eternal_origin_eternal_fleet = {
	optimize_memory
	create_exe_invasion_fleet = {
		#NAME = Name_Eternal
		flag = eternal_kuat_invasion_fleet
		is_boss = yes  can_disband = no
		Fleet_owner = event_target:eternal_support_country
		bombardment = exe_invasion_bombardment
		Eternal_battleship = @eternal_fleet_battleship_T0 Eternal_flagship = @eternal_fleet_flagship_T1  DIFF = 0
		Location = prev Disable_health = 0.01
	}
	last_created_fleet = { if = {
		limit = { owner = { is_country_type = eternal_support_guadian } }
		set_fleet_flag = eternal_support_guadian_fleet
		fleet_event = { id = ag_kae_ge_invasion.218 days = 60 }
	} }
}

create_mult_eternal_origin_eternal_fleet = {
	optimize_memory
	while = { count = $NUM$ create_eternal_origin_eternal_fleet = yes }
}

# scope: fleet
# prev: eternal country
# prevprev: system
eternal_player_fleet_order_1 = {
	optimize_memory
	queue_actions = {
		wait = 2
		repeat = {
			find_closest_planet = {
				trigger = {
					id = executing_eternal_fleet.1
					is_colony = yes exists = owner
					owner = { is_hostile = event_target:eternal_support_country }
					solar_system = { is_same_value = prevprevprevprev }
				}
				found_planet = {
					orbit_planet = this
					effect = {
						id = executing_eternal_fleet.2
						set_planet_flag = ruins_planet
						root = { set_fleet_flag = eternal_fallen_bombaring_fleet }
					}
					repeat = {
						while = { 
							id = executing_eternal_fleet.3 
							root = { has_fleet_flag = eternal_fallen_bombaring_fleet } 
						}
						effect = {
							id = executing_eternal_fleet.4
							if = { 
								limit = { is_colony = no } 
								root = { remove_fleet_flag = eternal_fallen_bombaring_fleet } 
							}
						} 
						wait = 5
					}
				}
				failed = {
					wait = 60
					effect = {
						id = executing_eternal_fleet.5
						remove_fleet_flag = choosen_eternal_fleet
						remove_fleet_flag = executing_eternal_fleet
						clear_orders = yes
						clear_fleet_actions = this
						event_target:Eternalempire = {
							if = {
								limit = { has_country_flag = eternal_fleet_destroy_enenmy }
								event_target:eternal_support_country = { 
									subtract_variable = { which = list_owned_eternal_fleet value = 1 } 
									change_variable = { which = mission_finished_eternal_fleet value = 1 }
								}
								if = {
									limit = { event_target:eternal_support_country = { OR = {
										check_variable = { which = list_owned_eternal_fleet value <= 0 } 
										check_variable = { which = mission_finished_eternal_fleet value >= mission_pending_eternal_fleet }
									} } }
									set_timed_country_flag = { flag = have_been_ordered_eternal_fleet days = 1800 } 
									country_event = { id = kuat_starkiller.18 }
									event_target:eternal_support_country = {
										clear_variable = list_owned_eternal_fleet
										clear_variable = page_owned_eternal_fleet
										clear_variable = count_eternal_center_target
										clear_variable = mission_pending_eternal_fleet
										clear_variable = mission_finished_eternal_fleet
										every_owned_fleet = { remove_fleet_flag = choosen_eternal_fleet }
									}
								}
							}
							if = {
								limit = { has_country_flag = eternal_fleet_attack_enenmy }
								set_timed_country_flag = { flag = have_been_ordered_eternal_fleet days = 360 } 
								country_event = { id = kuat_starkiller.18 }
							}
						}
						set_location = event_target:zakuul_system.system_star
					}
				}
			}
		}
	}
}


# swapper planet districts
# DISTRICT1 = district_city
# DISTRICT2 = district_industrial
# DISTRICT3 = district_arcology_swgs_science
# PLANET = pc_swgs_engineer
kuat_swapping_planet_artificial_planet_district = {
	optimize_memory
	if = {
		limit = { OR = {
			has_district = $DISTRICT1$
			has_district = $DISTRICT2$
		} }
		export_trigger_value_to_variable = {
			trigger = num_districts
			parameters = { type = $DISTRICT1$ }
			variable = swap_$DISTRICT1$_variable
		}
		export_trigger_value_to_variable = {
			trigger = num_districts
			parameters = { type = $DISTRICT2$ }
			variable = swap_$DISTRICT2$_variable
		}
		clear_deposits = yes
		change_pc = $PLANET$
		while = {
			count = swap_$DISTRICT1$_variable
			remove_district = $DISTRICT1$
			add_district = $DISTRICT3$
		}
		while = {
			count = swap_$DISTRICT2$_variable
			remove_district = $DISTRICT2$
			add_district = $DISTRICT3$
		}
	}
	else_if = {
		limit = { has_district = $DISTRICT1$ NOT = {
			has_district = $DISTRICT2$
		} }
		export_trigger_value_to_variable = {
			trigger = num_districts
			parameters = { type = $DISTRICT1$ }
			variable = swap_$DISTRICT1$_variable
		}
		clear_deposits = yes
		change_pc = $PLANET$
		while = {
			count = swap_$DISTRICT1$_variable
			remove_district = $DISTRICT1$
			add_district = $DISTRICT3$
		}
	}
	else_if = {
		limit = { has_district = $DISTRICT2$ NOT = {
			has_district = $DISTRICT1$
		} }
		export_trigger_value_to_variable = {
			trigger = num_districts
			parameters = { type = $DISTRICT2$ }
			variable = swap_$DISTRICT2$_variable
		}
		clear_deposits = yes
		change_pc = $PLANET$
		while = {
			count = swap_$DISTRICT2$_variable
			remove_district = $DISTRICT2$
			add_district = $DISTRICT3$
		}
	}	
	else = {
		remove_all_districts = yes
		clear_deposits = yes change_pc = $PLANET$
	}
}


# Galatic council focus
kuat_repeal_all_crisis_resolutions = {
	optimize_memory
	remove_global_flag = galactic_focus_crisis_eternal_fleet
	cancel_resolution = resolution_galactic_focus_crisis_eternal_fleet
	remove_global_flag = galactic_focus_crisis_return_eternal_fleet
	cancel_resolution = resolution_galactic_focus_crisis_return_eternal_fleet
}

#scope:ship
flagship_building_check = {
	optimize_memory
	owner = {
		set_variable = { which = SHIP_LIMIT_VAR_$SHIPSIZE$ value = 0 }
		set_variable = { which = SHIP_LIMIT_STANDARD_VAR_$SHIPSIZE$ value = $SHIP_LIMIT$ }
		if = { limit = { has_country_flag = all_flagship_building_limit_1 } set_variable = { which = SHIP_LIMIT_ADDON_VAR_$SHIPSIZE$ value = 1 } }
		if = { limit = { has_country_flag = all_flagship_building_limit_2 } set_variable = { which = SHIP_LIMIT_ADDON_VAR_$SHIPSIZE$ value = 2 } }
		if = { limit = { has_country_flag = all_flagship_building_limit_3 } set_variable = { which = SHIP_LIMIT_ADDON_VAR_$SHIPSIZE$ value = 3 } }
		if = { limit = { has_country_flag = all_flagship_building_limit_4 } set_variable = { which = SHIP_LIMIT_ADDON_VAR_$SHIPSIZE$ value = 4 } }
		if = { limit = { has_country_flag = all_flagship_building_limit_5 } set_variable = { which = SHIP_LIMIT_ADDON_VAR_$SHIPSIZE$ value = 5 } }
		if = { limit = { has_country_flag = all_flagship_building_limit_6 } set_variable = { which = SHIP_LIMIT_ADDON_VAR_$SHIPSIZE$ value = 6 } }
		if = { limit = { has_country_flag = all_flagship_building_limit_7 } set_variable = { which = SHIP_LIMIT_ADDON_VAR_$SHIPSIZE$ value = 7 } }
		if = { limit = { has_country_flag = all_flagship_building_limit_8 } set_variable = { which = SHIP_LIMIT_ADDON_VAR_$SHIPSIZE$ value = 8 } }
		if = { limit = { has_country_flag = all_flagship_building_limit_9 } set_variable = { which = SHIP_LIMIT_ADDON_VAR_$SHIPSIZE$ value = 9 } }
		change_variable = { which = SHIP_LIMIT_VAR_$SHIPSIZE$ value = SHIP_LIMIT_STANDARD_VAR_$SHIPSIZE$ }
		change_variable = { which = SHIP_LIMIT_VAR_$SHIPSIZE$ value = SHIP_LIMIT_ADDON_VAR_$SHIPSIZE$ }
		if = {
			limit = { any_owned_ship = { NOT = { is_same_value = prevprev } is_ship_size = $SHIPSIZE$ } }
			export_trigger_value_to_variable = {
				trigger = count_owned_ship
				parameters = { limit = { NOT = { is_same_value = prevprev } is_ship_size = $SHIPSIZE$ } }
				variable = system_active_check_$SHIPSIZE$
			}
		}
		else_if = {
			limit = { count_owned_ship = { limit = { NOT = { is_same_value = prevprev } is_ship_size = $SHIPSIZE$ } count = 0 } }
			set_variable = { which = system_active_check_$SHIPSIZE$ value = 0 }
		}
		set_variable = { which = system_active_$SHIPSIZE$ value = system_active_check_$SHIPSIZE$ }
		change_variable = { which = system_active_$SHIPSIZE$ value = 1 }
	}
	if = { 
		limit = { owner = { check_variable = { which = system_active_$SHIPSIZE$ value > SHIP_LIMIT_VAR_$SHIPSIZE$ } } } 
		owner = { subtract_variable = { which = system_active_$SHIPSIZE$ value = 1 } country_event = { id = kuat_starkiller.12 } add_resource = { alloys = 3500 } } 
		destroy_ship = this 
	}
}

kuat_automatic_ai_colony = {
	set_update_modifiers_batch = begin
	owner = { save_event_target_as = changing_country }
	set_planet_flag = has_building_kuat_command_center_auto
	set_variable = { which = planet_production_ascension_tier value = trigger:has_planetary_ascension_tier }
	if = {
		limit = { has_planet_flag = PR_flg_plnt_VALID }
		set_variable = { which = planet_production_array_base value = value:PR_sv_plnt_HC }
	}
	else = { set_variable = { which = planet_production_array_base value = trigger:num_pops } }
	multiply_variable = { which = planet_production_array_base value = 0.2 }
	set_variable = { which = planet_production_array_pop_speed_total value = 0 }
	if = {
		limit = { check_modifier_value = { modifier = pop_growth_speed value >= 0 } }
		set_variable = { which = planet_production_array_growpop_speed_base value = modifier:pop_growth_speed }
		change_variable = { which = planet_production_array_pop_speed_total value = planet_production_array_growpop_speed_base }
	}
	if = {
		limit = { check_modifier_value = { modifier = planet_pop_assembly_organic_add value >= 0 } }
		set_variable = { which = planet_production_array_organicpop_speed_base value = modifier:planet_pop_assembly_organic_add }
		if = {
			limit = { check_modifier_value = { modifier = planet_pop_assembly_organic_mult value >= 0 } }
			multiply_variable = { which = planet_production_array_organicpop_speed_base value = modifier:planet_pop_assembly_organic_mult }
		}
		change_variable = { which = planet_production_array_pop_speed_total value = planet_production_array_organicpop_speed_base }
	}
	if = {
		limit = { check_modifier_value = { modifier = planet_pop_assembly_add value >= 0 } }
		set_variable = { which = planet_production_array_pop_speed_base value = modifier:planet_pop_assembly_add }
		if = {
			limit = { check_modifier_value = { modifier = planet_pop_assembly_mult value >= 0 } }
			multiply_variable = { which = planet_production_array_pop_speed_base value = modifier:planet_pop_assembly_mult }
		}
		change_variable = { which = planet_production_array_pop_speed_total value = planet_production_array_pop_speed_base }
	}

	if = { limit = { is_capital = yes } set_timed_planet_flag = { flag = destroy_colony_capital_temple days = 1 } }
	every_owned_pop = { kill_pop = yes }
	if = { limit = { is_capital = no } clear_deposits = yes }
	clear_blockers = yes
	remove_all_buildings = yes
	remove_all_districts = yes
	clear_planet_modifiers = yes
	destroy_colony = yes

	add_building = building_kuat_command_center_auto
	add_building = building_kuat_databank_auto
	add_building = building_kuat_ancient_databank_auto
	add_building = building_kuat_foundry_auto
	add_building = building_kuat_resource_center_auto
	add_building = building_kuat_shield_auto
	add_building = building_kuat_ground_yards_auto
	add_building = building_kuat_research_center_auto

	set_owner = event_target:changing_country
	while = { count = 5 create_pop = { species = owner_main_species } }
	add_modifier = { modifier = planet_population_control }
	add_modifier = { modifier = planet_population_control_gestalt }
	add_modifier = { modifier = planet_robot_assembly_control }
	add_modifier = { modifier = kuat_automatic_colony }
	if = { limit = { has_planet_flag = destroy_colony_capital_temple } set_capital = yes }
	set_planetary_ascension_tier = planet_production_ascension_tier
	kuat_reset_auto_colony_variable = yes
	set_update_modifiers_batch = end
}

kuat_reset_auto_colony_variable = {
	if = {
		limit = { OR = {
			NOT = { has_building = building_kuat_command_center_auto }
			NOT = { has_building = building_kuat_databank_auto }
			NOT = { has_building = building_kuat_ancient_databank_auto }
			NOT = { has_building = building_kuat_foundry_auto }
			NOT = { has_building = building_kuat_resource_center_auto }
			NOT = { has_building = building_kuat_shield_auto }
			NOT = { has_building = building_kuat_ground_yards_auto }
			NOT = { has_building = building_kuat_research_center_auto }
		} }
		remove_all_buildings = yes
		add_building = building_kuat_command_center_auto
		add_building = building_kuat_databank_auto
		add_building = building_kuat_ancient_databank_auto
		add_building = building_kuat_foundry_auto
		add_building = building_kuat_resource_center_auto
		add_building = building_kuat_shield_auto
		add_building = building_kuat_ground_yards_auto
		add_building = building_kuat_research_center_auto
	}
	if = {
		limit = { NOT = { num_pops = 5 } NOT = { has_planet_flag = PR_flg_plnt_VALID } }
		set_variable = { which = planet_temple_return_pop value = trigger:num_pops }
		subtract_variable = { which = planet_temple_return_pop value = 5 }
		multiply_variable = { which = planet_temple_return_pop value = -1 }
		if = {
			limit = { check_variable = { which = planet_temple_return_pop value > 0 } }
			while = { 
				count = planet_temple_return_pop create_pop = { species = owner_main_species } 
				subtract_variable = { which = planet_production_array value = 1 }
			}
		}
		else_if = {
			limit = { check_variable = { which = planet_temple_return_pop value < 0 } }
			multiply_variable = { which = planet_temple_return_pop value = -1 }
			while = { 
				count = planet_temple_return_pop random_owned_pop = { kill_pop = yes } 
				change_variable = { which = planet_production_array value = 0.2 }
			}
		}
	}
	change_variable = { which = planet_production_array_pop_speed_total_dynamic value = planet_production_array_pop_speed_total }
	if = {
		limit = { check_variable = { which = planet_production_array_pop_speed_total_dynamic value > 2000 } }
		set_variable = { which = planet_production_array_pop_speed_total_dynamic value = 2000 }
	}
	set_variable = { which = planet_production_array value = trigger:years_passed }
	change_variable = { which = planet_production_array value = planet_production_array_pop_speed_total_dynamic }
	multiply_variable = { which = planet_production_array value = 0.2 }
	change_variable = { which = planet_production_array value = trigger:planet_size }
	change_variable = { which = planet_production_array value = planet_production_array_base }
	multiply_variable = { which = planet_production_array value = trigger:planet_size }
	multiply_variable = { which = planet_production_array value = 0.1 }
	if = { limit = { years_passed >= 100 } multiply_variable = { which = planet_production_array value = 1 } }
	else_if = { limit = { years_passed >= 90 } multiply_variable = { which = planet_production_array value = 0.9 } }
	else_if = { limit = { years_passed >= 80 } multiply_variable = { which = planet_production_array value = 0.8 } }
	else_if = { limit = { years_passed >= 70 } multiply_variable = { which = planet_production_array value = 0.7 } }
	else_if = { limit = { years_passed >= 60 } multiply_variable = { which = planet_production_array value = 0.6 } }
	else_if = { limit = { years_passed >= 50 } multiply_variable = { which = planet_production_array value = 0.5 } }
	else_if = { limit = { years_passed >= 40 } multiply_variable = { which = planet_production_array value = 0.3 } }
	else = { multiply_variable = { which = planet_production_array value = 0.2 } }
	floor_variable = planet_production_array
}


create_kuat_shipyard_country = {
	create_country = {
		name = "Name_Kuat_Shipyard"
		type = kuat_shipyard
		flag = {
			icon = {
				category = "Kuat"
				file = "Kuat_flags_01.dds"
			}
			background = {
				category = "backgrounds"
				file = "00_solid.dds"
			}
			colors = { "blue" "blue" "null" "null" }
		}
		effect = {
			add_modifier = { modifier = Elternal_creating }
			save_global_event_target_as = kuat_shipyard_country
		}
	}
	random_system = {
		limit = { is_capital_system = no }
		spawn_megastructure = {
			type = exe_outer_gate_disable
			orbit_angle = 225
			orbit_distance = 200
			planet = system_star
			owner = event_target:kuat_shipyard_country
		}
	}
	establish_communications_no_message = event_target:kuat_shipyard_country
}

kuat_rift_award = {
	add_monthly_resource_mult = {
		resource = engineering_research
		value = @tier3researchreward
		min = @tier3researchmin
		max = @tier3researchmax
	}
	add_monthly_resource_mult = {
		resource = physics_research
		value = @tier3researchreward
		min = @tier3researchmin
		max = @tier3researchmax
	}
	add_monthly_resource_mult = {
		resource = society_research
		value = @tier3researchreward
		min = @tier3researchmin
		max = @tier3researchmax
	}
	add_monthly_resource_mult = {
		resource = unity
		value = @tier1unityreward
		min = @tier1unitymin
		max = @tier1unitymax
	}
}

kuat_astral_thread_small_reward = {
	kuat_astral_thread_reward = { ADD = 0 }
}

kuat_astral_thread_medium_reward = {
	kuat_astral_thread_reward = { ADD = 50 }
}

kuat_astral_thread_large_reward = {
	kuat_astral_thread_reward = { ADD = 100 }
}

kuat_astral_thread_reward = {
	custom_tooltip = astral_threads_found
	locked_random_list = {
		1 = { kuat_add_resource_astral_threads = { VALUE = 60 ADD = $ADD$ } }
		1 = { kuat_add_resource_astral_threads = { VALUE = 80 ADD = $ADD$ } }
		1 = { kuat_add_resource_astral_threads = { VALUE = 100 ADD = $ADD$ } }
	}
}

kuat_add_resource_astral_threads = {
	if = {
		limit = { check_variable = { which = astral_threads_scripted_rewards_mult value < 1 } }
		set_variable = {
			which = astral_threads_scripted_rewards_mult
			value = 1
		}
	}
	add_resource = {
		astral_threads =  @\[( $VALUE$ * $MULT|1$ + $ADD|0$ )]
		mult = astral_threads_scripted_rewards_mult
	}
	hidden_effect = { country_event = { id = tutorial.1340 days = 5 } }
}

kuat_enable_settings_hell_tradition = {
	if = {
		limit = { NOT = { has_global_flag = ban_exe_invasion } }
		remove_global_flag = normal_exe_invasion
		remove_global_flag = easy_exe_invasion
		remove_global_flag = ban_exe_invasion
		remove_global_flag = difficult_exe_invasion
		set_global_flag = ban_exe_invasion
	}
	if = {
		limit = { NOT = { has_global_flag = enable_modifer_check } }
		remove_global_flag = disable_modifer_check
		remove_global_flag = enable_modifer_check
		set_global_flag = enable_modifer_check
	}
	switch = {
		trigger = has_global_flag
		easy_exe_invasion = { event_target:global_event_country = {
			set_variable = { which = exe_invasion_difficult_global_var value = 1 } 
			multiply_variable = { which = exe_invasion_difficult_global_var value = 1 }
			if = {
				limit = { has_global_flag = kuat_impulse_mod_settings }
				multiply_variable = { which = exe_invasion_difficult_global_var value = 1 }
			}
		} }
		normal_exe_invasion = { event_target:global_event_country = {
			set_variable = { which = exe_invasion_difficult_global_var value = 2 } 
			multiply_variable = { which = exe_invasion_difficult_global_var value = 1.5 }
			if = {
				limit = { has_global_flag = kuat_impulse_mod_settings }
				multiply_variable = { which = exe_invasion_difficult_global_var value = 2 }
			}
		} }
		difficult_exe_invasion = { event_target:global_event_country = {
			set_variable = { which = exe_invasion_difficult_global_var value = 3 } 
			multiply_variable = { which = exe_invasion_difficult_global_var value = 2 }
			if = {
				limit = { has_global_flag = kuat_impulse_mod_settings }
				multiply_variable = { which = exe_invasion_difficult_global_var value = 3 }
			}
		} }
		ban_exe_invasion = { event_target:global_event_country = {
			set_variable = { which = exe_invasion_difficult_global_var value = 4 } 
			multiply_variable = { which = exe_invasion_difficult_global_var value = 2.5 }
			if = {
				limit = { has_global_flag = kuat_impulse_mod_settings }
				multiply_variable = { which = exe_invasion_difficult_global_var value = 4 }
			}
		} }
	}
	country_event = { id = exe_invasion.1004 }
}