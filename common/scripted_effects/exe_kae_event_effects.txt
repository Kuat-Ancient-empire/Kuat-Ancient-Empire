
@ag_jumpdrive_effect_scale = 0.05
@ag_kae_num_ships_eclipse = 1
@ag_kae_num_ships_venator = 5
@ag_kae_ge_fleet_jumpdrive_to_target_distance = 200

ag_kae_e_area_guardian_fleet_spawn = {
	optimize_memory
	random_list = {
		1 = { create_exe_invasion_fleet = {
			NAME = NAME_ag_kae_e_area_guardian_fleet
			is_boss = yes can_disband = no
			Fleet_owner = event_target:ag_kae_e_area_guardian
			flag = ag_kae_e_area_guardian_fleet
			bombardment = indiscriminate
			Annihilator = 1  Resugrant = 25  high_Imperial = 50  Harrower = 75  DIFF = 0
			Location = prev
		} }
		1 = { create_exe_invasion_fleet = {
			NAME = NAME_ag_kae_e_area_guardian_fleet
			is_boss = yes can_disband = no
			Fleet_owner = event_target:ag_kae_e_area_guardian
			flag = ag_kae_e_area_guardian_fleet
			bombardment = indiscriminate
			Venganza = 1  Resugrant = 25  high_Imperial = 50  Harrower = 75  DIFF = 0
			Location = prev
		} }
		1 = { create_exe_invasion_fleet = {
			NAME = NAME_ag_kae_e_area_guardian_fleet
			is_boss = yes can_disband = no
			Fleet_owner = event_target:ag_kae_e_area_guardian
			flag = ag_kae_e_area_guardian_fleet
			bombardment = indiscriminate
			Dominance = 1  Resugrant = 25  high_Imperial = 50  Harrower = 75  DIFF = 0
			Location = prev
		} }
		1 = { create_exe_invasion_fleet = {
			NAME = NAME_ag_kae_e_area_guardian_fleet
			is_boss = yes can_disband = no
			Fleet_owner = event_target:ag_kae_e_area_guardian
			flag = ag_kae_e_area_guardian_fleet
			bombardment = indiscriminate
			Eclipse = 1  Resugrant = 25  high_Imperial = 50  Harrower = 75  DIFF = 0
			Location = prev
		} }
		1 = { create_exe_invasion_fleet = {
			NAME = NAME_ag_kae_e_area_guardian_fleet
			is_boss = yes can_disband = no
			Fleet_owner = event_target:ag_kae_e_area_guardian
			flag = ag_kae_e_area_guardian_fleet
			bombardment = indiscriminate
			Balletor = 1  Resugrant = 25  high_Imperial = 50  Harrower = 75  DIFF = 0
			Location = prev
		} }
		1 = { create_exe_invasion_fleet = {
			NAME = NAME_ag_kae_e_area_guardian_fleet
			is_boss = yes can_disband = no
			Fleet_owner = event_target:ag_kae_e_area_guardian
			flag = ag_kae_e_area_guardian_fleet
			bombardment = indiscriminate
			Titan = 1  Resugrant = 25  high_Imperial = 50  Harrower = 75  DIFF = 0
			Location = prev
		} }
	}
}

ag_kae_ge_invasion_create_secondary_portal_system = {
	optimize_memory
	random_system = {
		limit = { NOR = {
			has_star_flag = ag_kae_e_area_system
			has_star_flag = ag_kae_portal_system
		} }
		spawn_system = {
			min_distance >= 20
			max_distance <= 50
			initializer = "ag_kae_portal_system_init"
			hyperlane = yes
		}
		last_created_system = {
			save_global_event_target_as = ag_kae_portal_system
			if = {
				limit = { event_target:global_event_country = { check_variable = { which = ag_kae_ge_invasion_num_portals value = 1 } } }
				set_star_flag = ag_kae_portal_system_1
			}
			else_if = {
				limit = { event_target:global_event_country = { check_variable = { which = ag_kae_ge_invasion_num_portals value = 2 } } }
				set_star_flag = ag_kae_portal_system_2
			}
			else_if = {
				limit = { event_target:global_event_country = { check_variable = { which = ag_kae_ge_invasion_num_portals value = 3 } } }
				set_star_flag = ag_kae_portal_system_3
			}
			else_if = {
				limit = { event_target:global_event_country = { check_variable = { which = ag_kae_ge_invasion_num_portals value = 4 } } }
				set_star_flag = ag_kae_portal_system_4
			}
			else_if = {
				limit = { event_target:global_event_country = { check_variable = { which = ag_kae_ge_invasion_num_portals value = 5 } } }
				set_star_flag = ag_kae_portal_system_5
			}
			else_if = {
				limit = { always = yes }
				set_star_flag = ag_kae_portal_system_6
			}
		}
	}
	event_target:global_event_country = { change_variable = { which = ag_kae_ge_invasion_num_portals value = 1 } }
}

ag_kae_ge_invasion_primary_portal_spawn = {
	optimize_memory
	solar_system = { spawn_megastructure = {
		type = "ag_kae_ge_invasion_crisis_portal"
		owner = event_target:ag_kae_ge_invasion_country
		planet = star
	} }
	set_planet_size = -1
	set_planet_entity = { entity = starforge_avoid_entity }
	create_fleet = {
		name = "NAME_ag_kae_ge_portal_fleet"
		settings = { spawn_debris = no can_disband = no is_boss = yes }
		effect = {
			solar_system = { set_star_flag = kuat_starbase_megastructure_in_system }
			set_owner = event_target:ag_kae_ge_invasion_country
			create_ship = { 
				name = "NAME_ag_kae_ge_portal" 
				design = "NAME_EXE_STARBASE_MEGASTRUCTURE_1" prefix = no 
				effect = { set_ship_flag = ag_kae_ge_primary_portal }
			}
			set_location = { target = prev distance = -1 angle = 0 }
			set_fleet_flag = ag_kae_ge_primary_portal
			set_event_locked = no
		}
	}
	create_ambient_object = { type = "space_storm_1" location = this }
	last_created_ambient_object = {
		set_ambient_object_flag = space_storm_object
		set_location = { target = prev distance = 0 angle = random }
	}
	solar_system = { every_system_planet = {
		limit = { exists = owner is_colony = yes }
		add_modifier = { modifier = "exe_megastructure_starbase_in_system" }
	} }
}

ag_kae_ge_invasion_secondary_portal_spawn = {
	optimize_memory
	solar_system = { spawn_megastructure = {
		type = "ag_kae_ge_invasion_crisis_portal"
		owner = event_target:ag_kae_ge_invasion_country
		planet = star
	} }
	set_planet_size = -1
	set_planet_entity = { entity = starforge_avoid_entity }
	create_fleet = {
		name = "NAME_ag_kae_ge_portal_fleet"
		settings = { spawn_debris = no can_disband = no is_boss = yes }
		effect = {
			solar_system = { set_star_flag = kuat_starbase_megastructure_in_system }
			set_owner = event_target:ag_kae_ge_invasion_country
			create_ship = { 
				name = "NAME_ag_kae_ge_portal" 
				design = "NAME_EXE_STARBASE_MEGASTRUCTURE_1" prefix = no 
				effect = { set_ship_flag = ag_kae_ge_secondary_portal }
			}
			set_location = { target = prev distance = -1 angle = 0 }
			set_fleet_flag = ag_kae_ge_secondary_portal
			set_event_locked = no
		}
	}
	create_ambient_object = { type = "space_storm_1" location = this }
	last_created_ambient_object = {
		set_ambient_object_flag = space_storm_object
		set_location = { target = prev distance = 0 angle = random }
	}
	solar_system = { every_system_planet = {
		limit = { exists = owner is_colony = yes }
		add_modifier = { modifier = "exe_megastructure_starbase_in_system" }
	} }
}

ag_kae_ge_invasion_primary_portal_guradian_spawn = {
	optimize_memory
	random_list = {
		1 = { create_exe_invasion_fleet = {
			NAME = NAME_ag_kae_e_kuat_defender_fleet
			is_boss = yes can_disband = no
			Fleet_owner = event_target:ag_kae_ge_invasion_country
			flag = ag_kae_ge_primary_portal_guradian
			bombardment = indiscriminate
			Annihilator = 1  Resugrant = 25  high_Imperial = 50  Harrower = 75  DIFF = 0
			Location = prev
		} }
		1= { create_exe_invasion_fleet = {
			NAME = NAME_ag_kae_e_kuat_defender_fleet
			is_boss = yes can_disband = no
			Fleet_owner = event_target:ag_kae_ge_invasion_country
			flag = ag_kae_ge_primary_portal_guradian
			bombardment = indiscriminate
			Eclipse = 1  Resugrant = 25  high_Imperial = 50  Harrower = 75  DIFF = 0
			Location = prev
		} }
	}
}

ag_kae_ge_invasion_secondary_portal_guradian_spawn = {
	optimize_memory
	random_list = {
		1 = { create_exe_invasion_fleet = {
			NAME = NAME_ag_kae_e_kuat_defender_fleet
			is_boss = yes can_disband = no
			Fleet_owner = event_target:ag_kae_ge_invasion_country
			flag = ag_kae_ge_secondary_portal_guradian
			bombardment = indiscriminate
			Annihilator = 1  Resugrant = 25  high_Imperial = 50  Harrower = 75  DIFF = 0
			Location = prev
		} }
		1= { create_exe_invasion_fleet = {
			NAME = NAME_ag_kae_e_kuat_defender_fleet
			is_boss = yes can_disband = no
			Fleet_owner = event_target:ag_kae_ge_invasion_country
			flag = ag_kae_ge_secondary_portal_guradian
			bombardment = indiscriminate
			Eclipse = 1  Resugrant = 25  high_Imperial = 50  Harrower = 75  DIFF = 0
			Location = prev
		} }
	}
}

ag_kae_ge_invasion_assault_fleet_spawn = {
	optimize_memory
	random_list = {
		1 = { create_exe_invasion_fleet = {
			NAME = NAME_ag_kae_e_kuat_attacker_fleet
			is_boss = yes can_disband = no
			Fleet_owner = event_target:ag_kae_ge_invasion_country
			flag = ag_kae_ge_assault_fleet
			bombardment = indiscriminate
			Venganza = 1  Resugrant = 25  high_Imperial = 50  Harrower = 75  DIFF = 0
			Location = prev
		} }
		1 = { create_exe_invasion_fleet = {
			NAME = NAME_ag_kae_e_kuat_attacker_fleet
			is_boss = yes can_disband = no
			Fleet_owner = event_target:ag_kae_ge_invasion_country
			flag = ag_kae_ge_assault_fleet
			bombardment = indiscriminate
			Dominance = 1  Resugrant = 25  high_Imperial = 50  Harrower = 75  DIFF = 0
			Location = prev
		} }
		1 = { create_exe_invasion_fleet = {
			NAME = NAME_ag_kae_e_kuat_attacker_fleet
			is_boss = yes can_disband = no
			Fleet_owner = event_target:ag_kae_ge_invasion_country
			flag = ag_kae_ge_assault_fleet
			bombardment = indiscriminate
			Balletor = 1  Resugrant = 25  high_Imperial = 50  Harrower = 75  DIFF = 0
			Location = prev
		} }
		1 = { create_exe_invasion_fleet = {
			NAME = NAME_ag_kae_e_kuat_attacker_fleet
			is_boss = yes can_disband = no
			Fleet_owner = event_target:ag_kae_ge_invasion_country
			flag = ag_kae_ge_assault_fleet
			bombardment = indiscriminate
			Titan = 1  Resugrant = 25  high_Imperial = 50  Harrower = 75  DIFF = 0
			Location = prev
		} }
	}
	last_created_fleet = { fleet_event = { id = ag_kae_ge_invasion.241 days = 2 random = 2 } }
}

ag_kae_ge_invasion_starbase_spawn = {
	create_starbase = { size = exe_starbase owner = event_target:ag_kae_ge_invasion_country }
}

ag_kae_create_faction_species = {
	create_species = {
		name = ETERNAL_LEADER
		plural = ETERNAL_LEADER
		class = Eternal_Throne
		portrait = eternal_center
		name_list = HUM1
		effect = { 
			set_species_flag = ETERNAL_LEADER
			save_global_event_target_as = CHECK_ETERNAL_LEADER
			save_global_event_target_as = ETERNAL_LEADER 
		}
	}
}


ag_kae_ge_jumpdrive_to_target = {
	optimize_memory
	every_controlled_ship = {
		create_ambient_object = {
			type = horror_spawn_object
			location = this
			use_3d_location = yes
			entity_offset = { min = 0 max = 0 }
			entity_offset_angle = { min = 0 max = 0 }
			entity_offset_height = { min = 0 max = 0 }
			entity_scale_to_size = yes
			scale = @ag_jumpdrive_effect_scale
		}
	}
	set_location = { target = prev distance = @ag_kae_ge_fleet_jumpdrive_to_target_distance angle = random }
	every_controlled_ship = {
		create_ambient_object = {
			type = horror_spawn_object
			location = this
			use_3d_location = yes
			entity_offset = { min = 0 max = 0 }
			entity_offset_angle = { min = 0 max = 0 }
			entity_offset_height = { min = 0 max = 0 }
			entity_scale_to_size = yes
			scale = @ag_jumpdrive_effect_scale
		}
	}
	if = {
		limit = { prev = { is_scope_type = planet } }
		auto_move_to_planet = { target = prev clear_auto_move_on_arrival = yes }
	}
	else_if = {
		limit = { prev = { is_scope_type = fleet } }
		auto_follow_fleet = { target = prev attack_fleet = yes }
	}
}

# [TODO]： 直接复制的虚境侵军，批量替换了flag，可能存在bug，需要测试。
ag_kae_ge_assault_fleet_action = {
	optimize_memory
	if = {
		limit = {
			root = {
				exists = solar_system
				solar_system = {
					any_system_planet = {
						exists = owner
						owner = {
							is_hostile = event_target:ag_kae_ge_invasion_country
						}
						exists = controller
						controller = {
							is_hostile = event_target:ag_kae_ge_invasion_country
						}
						OR = {
							is_colony = yes
							is_under_colonization = yes
						}
						NOT = {
							any_fleet_in_orbit = {
								exists = owner
								owner = {
									is_same_value = event_target:ag_kae_ge_invasion_country
								}
								NOT = { is_same_value = root }
							}
						}
					}
				}
			}
		}
		root.solar_system = {
			random_system_planet = {
				limit = {
					exists = owner
					owner = {
						is_hostile = event_target:ag_kae_ge_invasion_country
					}
					exists = controller
					controller = {
						is_hostile = event_target:ag_kae_ge_invasion_country
					}
					OR = {
						is_colony = yes
						is_under_colonization = yes
					}
					NOT = {
						any_fleet_in_orbit = {
							exists = owner
							owner = {
								is_same_value = event_target:ag_kae_ge_invasion_country
							}
							NOT = { is_same_value = root }
						}
					}
				}
				prevprev = {
					auto_move_to_planet = {
						target = prev
						clear_auto_move_on_arrival = yes
					}
				}
			}
		}
	}
	else_if = {
		limit = {
			root = {
				exists = solar_system
				solar_system = {
					any_ship_in_system = {
						is_disabled = no
						is_ship_class = shipclass_military
						exists = owner
						owner = {
							is_hostile = event_target:ag_kae_ge_invasion_country
						}
					}
				}
			}
		}
		root.solar_system = {
			random_fleet_in_system = {
				limit = {
					exists = owner
					owner = {
						is_hostile = event_target:ag_kae_ge_invasion_country
					}
					any_controlled_ship = {
						is_disabled = no
						is_ship_class = shipclass_military
					}
				}
				prevprev = {
					auto_follow_fleet = {
						target = prev
						attack_fleet = yes
					}
				}
			}
		}
	}
	else_if = {
		limit = {
			root = { exists = solar_system }
			root.solar_system = {
				has_star_flag = ag_kae_e_area_system
			}
			any_system = {
				NOT = {
					has_star_flag = ag_kae_e_area_system
				}
				any_ship_in_system = {
					is_ship_size = exe_megastructure_starbase
				}
			}
		}
		random_system = {
			limit = {
				NOT = {
					has_star_flag = ag_kae_e_area_system
				}
				any_ship_in_system = {
					is_ship_size = exe_megastructure_starbase
				}
			}
			random_system_planet = {
				limit = {
					is_primary_star = yes
				}
				prevprev = {
					auto_move_to_planet = {
						target = prev
						clear_auto_move_on_arrival = yes
					}
				}
			}
		}
	}
	else_if = {
		limit = {
			root = { exists = solar_system }
			root.solar_system = {
				any_neighbor_system = {
					exists = starbase
					starbase = {
						exists = owner
						owner = {
							is_hostile = event_target:ag_kae_ge_invasion_country
						}
					}
				}
			}
		}
		root.solar_system = {
			random_neighbor_system = {
				limit = {
					exists = starbase
					starbase = {
						exists = owner
						owner = {
							is_hostile = event_target:ag_kae_ge_invasion_country
						}
					}
				}
				random_system_planet = {
					limit = {
						is_primary_star = yes
					}
					prevprevprev = {
						auto_move_to_planet = {
							target = prev
							clear_auto_move_on_arrival = yes
						}
					}
				}
			}
		}
	}
	else_if = {
		limit = { always = yes }
		random_list = {
			25 = {
				closest_system = {
					use_bypasses = yes
					max_steps = 15
					limit = {
						NOT = { is_same_value = root.solar_system }
						OR = {
							AND = {
								exists = starbase
								starbase = {
									exists = owner
									owner = {
										is_hostile = event_target:ag_kae_ge_invasion_country
									}
								}
							}
							any_system_planet = {
								exists = owner
								owner = {
									is_hostile = event_target:ag_kae_ge_invasion_country
								}
								exists = controller
								controller = {
									is_hostile = event_target:ag_kae_ge_invasion_country
								}
								OR = {
									is_colony = yes
									is_under_colonization = yes
								}
								NOT = {
									any_fleet_in_orbit = {
										exists = owner
										owner = {
											is_same_value = event_target:ag_kae_ge_invasion_country
										}
										NOT = { is_same_value = root }
									}
								}
							}
						}
						prev = { can_access_system = prev }
					}
					save_event_target_as = ag_kae_ge_assault_fleet_action_target
				}
				if = {
					limit = {
						exists = event_target:ag_kae_ge_assault_fleet_action_target
					}
					event_target:ag_kae_ge_assault_fleet_action_target = {
						if = {
							limit = {
								any_system_planet = {
									exists = owner
									owner = {
										is_hostile = event_target:ag_kae_ge_invasion_country
									}
									exists = controller
									controller = {
										is_hostile = event_target:ag_kae_ge_invasion_country
									}
									OR = {
										is_colony = yes
										is_under_colonization = yes
									}
									NOT = {
										any_fleet_in_orbit = {
											exists = owner
											owner = {
												is_same_value = event_target:ag_kae_ge_invasion_country
											}
											NOT = { is_same_value = root }
										}
									}
								}
							}
							random_system_planet = {
								limit = {
									exists = owner
									owner = {
										is_hostile = event_target:ag_kae_ge_invasion_country
									}
									exists = controller
									controller = {
										is_hostile = event_target:ag_kae_ge_invasion_country
									}
									OR = {
										is_colony = yes
										is_under_colonization = yes
									}
									NOT = {
										any_fleet_in_orbit = {
											exists = owner
											owner = {
												is_same_value = event_target:ag_kae_ge_invasion_country
											}
											NOT = { is_same_value = root }
										}
									}
								}
								random_list = {
									99 = {
										prevprev = {
											auto_move_to_planet = {
												target = prev
												clear_auto_move_on_arrival = yes
											}
										}
									}
									1 = {
										modifier = {
											factor = 0
											prevprev = {
												any_controlled_ship = {
													has_ship_flag = ag_jump_drive_cooldown
												}
											}
										}
										prevprev = { ag_kae_ge_jumpdrive_to_target = yes }
									}
								}
							}
						}
						else = {
							random_system_planet = {
								limit = {
									is_primary_star = yes
								}
								prevprev = {
									auto_move_to_planet = {
										target = prev
										clear_auto_move_on_arrival = yes
									}
								}
							}
						}
					}
				}
				else = {
					closest_system = {
						use_bypasses = yes
						max_steps = 15
						limit = {
							NOT = { is_same_value = root.solar_system }
							OR = {
								AND = {
									exists = starbase
									starbase = {
										exists = owner
										owner = {
											is_hostile = event_target:ag_kae_ge_invasion_country
										}
									}
								}
								any_system_planet = {
									exists = owner
									owner = {
										is_hostile = event_target:ag_kae_ge_invasion_country
									}
									exists = controller
									controller = {
										is_hostile = event_target:ag_kae_ge_invasion_country
									}
									OR = {
										is_colony = yes
										is_under_colonization = yes
									}
									NOT = {
										any_fleet_in_orbit = {
											exists = owner
											owner = {
												is_same_value = event_target:ag_kae_ge_invasion_country
											}
											NOT = { is_same_value = root }
										}
									}
								}
							}
						}
						save_event_target_as = ag_kae_ge_assault_fleet_action_target
					}
					if = {
						limit = {
							exists = event_target:ag_kae_ge_assault_fleet_action_target
						}
						random_list = {
							20 = {
								modifier = {
									factor = 0
									any_controlled_ship = {
										has_ship_flag = ag_jump_drive_cooldown
									}
								}
								event_target:ag_kae_ge_assault_fleet_action_target = {
									if = {
										limit = {
											any_system_planet = {
												exists = owner
												owner = {
													is_hostile = event_target:ag_kae_ge_invasion_country
												}
												exists = controller
												controller = {
													is_hostile = event_target:ag_kae_ge_invasion_country
												}
												OR = {
													is_colony = yes
													is_under_colonization = yes
												}
												NOT = {
													any_fleet_in_orbit = {
														exists = owner
														owner = {
															is_same_value = event_target:ag_kae_ge_invasion_country
														}
														NOT = { is_same_value = root }
													}
												}
											}
										}
										random_system_planet = {
											limit = {
												exists = owner
												owner = {
													is_hostile = event_target:ag_kae_ge_invasion_country
												}
												exists = controller
												controller = {
													is_hostile = event_target:ag_kae_ge_invasion_country
												}
												OR = {
													is_colony = yes
													is_under_colonization = yes
												}
												NOT = {
													any_fleet_in_orbit = {
														exists = owner
														owner = {
															is_same_value = event_target:ag_kae_ge_invasion_country
														}
														NOT = { is_same_value = root }
													}
												}
											}
											prevprev = { ag_kae_ge_jumpdrive_to_target = yes }
										}
									}
									else = {
										random_system_planet = {
											limit = {
												is_primary_star = yes
											}
											prevprev = { ag_kae_ge_jumpdrive_to_target = yes }
										}
									}
								}
							}
							80 = {
								fleet_event = { id = ag_kae_ge_invasion.241 days = 10 random = 10 }
							}
						}
					}
					else = {
						fleet_event = { id = ag_kae_ge_invasion.241 days = 10 random = 10 }
					}
				}
			}
			25 = {
				random_system = {
					limit = {
						NOT = { is_same_value = root.solar_system }
						distance = {
							source = root.solar_system
							type = hyperlane
							use_bypasses = yes
							min_jumps = 1
							max_jumps = 15
						}
						OR = {
							AND = {
								exists = starbase
								starbase = {
									exists = owner
									owner = {
										is_hostile = event_target:ag_kae_ge_invasion_country
									}
								}
							}
							any_system_planet = {
								exists = owner
								owner = {
									is_hostile = event_target:ag_kae_ge_invasion_country
								}
								exists = controller
								controller = {
									is_hostile = event_target:ag_kae_ge_invasion_country
								}
								OR = {
									is_colony = yes
									is_under_colonization = yes
								}
								NOT = {
									any_fleet_in_orbit = {
										exists = owner
										owner = {
											is_same_value = event_target:ag_kae_ge_invasion_country
										}
										NOT = { is_same_value = root }
									}
								}
							}
						}
						prev = { can_access_system = prev }
					}
					save_event_target_as = ag_kae_ge_assault_fleet_action_target
				}
				if = {
					limit = {
						exists = event_target:ag_kae_ge_assault_fleet_action_target
					}
					event_target:ag_kae_ge_assault_fleet_action_target = {
						if = {
							limit = {
								any_system_planet = {
									exists = owner
									owner = {
										is_hostile = event_target:ag_kae_ge_invasion_country
									}
									exists = controller
									controller = {
										is_hostile = event_target:ag_kae_ge_invasion_country
									}
									OR = {
										is_colony = yes
										is_under_colonization = yes
									}
									NOT = {
										any_fleet_in_orbit = {
											exists = owner
											owner = {
												is_same_value = event_target:ag_kae_ge_invasion_country
											}
											NOT = { is_same_value = root }
										}
									}
								}
							}
							random_system_planet = {
								limit = {
									exists = owner
									owner = {
										is_hostile = event_target:ag_kae_ge_invasion_country
									}
									exists = controller
									controller = {
										is_hostile = event_target:ag_kae_ge_invasion_country
									}
									OR = {
										is_colony = yes
										is_under_colonization = yes
									}
									NOT = {
										any_fleet_in_orbit = {
											exists = owner
											owner = {
												is_same_value = event_target:ag_kae_ge_invasion_country
											}
											NOT = { is_same_value = root }
										}
									}
								}
								random_list = {
									95 = {
										prevprev = {
											auto_move_to_planet = {
												target = prev
												clear_auto_move_on_arrival = yes
											}
										}
									}
									5 = {
										modifier = {
											factor = 0
											prevprev = {
												any_controlled_ship = {
													has_ship_flag = ag_jump_drive_cooldown
												}
											}
										}
										prevprev = { ag_kae_ge_jumpdrive_to_target = yes }
									}
								}
							}
						}
						else = {
							random_system_planet = {
								limit = {
									is_primary_star = yes
								}
								prevprev = {
									auto_move_to_planet = {
										target = prev
										clear_auto_move_on_arrival = yes
									}
								}
							}
						}
					}
				}
				else = {
					random_system = {
						limit = {
							NOT = { is_same_value = root.solar_system }
							distance = {
								source = root.solar_system
								type = hyperlane
								use_bypasses = yes
								min_jumps = 1
								max_jumps = 15
							}
							OR = {
								AND = {
									exists = starbase
									starbase = {
										exists = owner
										owner = {
											is_hostile = event_target:ag_kae_ge_invasion_country
										}
									}
								}
								any_system_planet = {
									exists = owner
									owner = {
										is_hostile = event_target:ag_kae_ge_invasion_country
									}
									exists = controller
									controller = {
										is_hostile = event_target:ag_kae_ge_invasion_country
									}
									OR = {
										is_colony = yes
										is_under_colonization = yes
									}
									NOT = {
										any_fleet_in_orbit = {
											exists = owner
											owner = {
												is_same_value = event_target:ag_kae_ge_invasion_country
											}
											NOT = { is_same_value = root }
										}
									}
								}
							}
						}
						save_event_target_as = ag_kae_ge_assault_fleet_action_target
					}
					if = {
						limit = {
							exists = event_target:ag_kae_ge_assault_fleet_action_target
						}
						random_list = {
							20 = {
								modifier = {
									factor = 0
									any_controlled_ship = {
										has_ship_flag = ag_jump_drive_cooldown
									}
								}
								event_target:ag_kae_ge_assault_fleet_action_target = {
									if = {
										limit = {
											any_system_planet = {
												exists = owner
												owner = {
													is_hostile = event_target:ag_kae_ge_invasion_country
												}
												exists = controller
												controller = {
													is_hostile = event_target:ag_kae_ge_invasion_country
												}
												OR = {
													is_colony = yes
													is_under_colonization = yes
												}
												NOT = {
													any_fleet_in_orbit = {
														exists = owner
														owner = {
															is_same_value = event_target:ag_kae_ge_invasion_country
														}
														NOT = { is_same_value = root }
													}
												}
											}
										}
										random_system_planet = {
											limit = {
												exists = owner
												owner = {
													is_hostile = event_target:ag_kae_ge_invasion_country
												}
												exists = controller
												controller = {
													is_hostile = event_target:ag_kae_ge_invasion_country
												}
												OR = {
													is_colony = yes
													is_under_colonization = yes
												}
												NOT = {
													any_fleet_in_orbit = {
														exists = owner
														owner = {
															is_same_value = event_target:ag_kae_ge_invasion_country
														}
														NOT = { is_same_value = root }
													}
												}
											}
											prevprev = { ag_kae_ge_jumpdrive_to_target = yes }
										}
									}
									else = {
										random_system_planet = {
											limit = {
												is_primary_star = yes
											}
											prevprev = { ag_kae_ge_jumpdrive_to_target = yes }
										}
									}
								}
							}
							80 = {
								fleet_event = { id = ag_kae_ge_invasion.241 days = 10 random = 10 }
							}
						}
					}
					else = {
						fleet_event = { id = ag_kae_ge_invasion.241 days = 10 random = 10 }
					}
				}
			}
			25 = {
				closest_system = {
					use_bypasses = yes
					max_steps = 15
					limit = {
						NOT = { is_same_value = root.solar_system }
						any_ship_in_system = {
							is_disabled = no
							is_ship_class = shipclass_military
							exists = owner
							owner = {
								is_hostile = event_target:ag_kae_ge_invasion_country
							}
						}
						prev = { can_access_system = prev }
					}
					save_event_target_as = ag_kae_ge_assault_fleet_action_target
				}
				if = {
					limit = {
						exists = event_target:ag_kae_ge_assault_fleet_action_target
					}
					event_target:ag_kae_ge_assault_fleet_action_target = {
						random_fleet_in_system = {
							limit = {
								exists = owner
								owner = {
									is_hostile = event_target:ag_kae_ge_invasion_country
								}
								any_controlled_ship = {
									is_disabled = no
									is_ship_class = shipclass_military
								}
							}
							random_list = {
								99 = {
									prevprev = {
										auto_follow_fleet = {
											target = prev
											attack_fleet = yes
										}
									}
								}
								1 = {
									modifier = {
										factor = 0
										prevprev = {
											any_controlled_ship = {
												has_ship_flag = ag_jump_drive_cooldown
											}
										}
									}
									prevprev = { ag_kae_ge_jumpdrive_to_target = yes }
								}
							}
						}
					}
				}
				else = {
					closest_system = {
						use_bypasses = yes
						max_steps = 15
						limit = {
							NOT = { is_same_value = root.solar_system }
							any_ship_in_system = {
								is_disabled = no
								is_ship_class = shipclass_military
								exists = owner
								owner = {
									is_hostile = event_target:ag_kae_ge_invasion_country
								}
							}
						}
						save_event_target_as = ag_kae_ge_assault_fleet_action_target
					}
					if = {
						limit = {
							exists = event_target:ag_kae_ge_assault_fleet_action_target
						}
						random_list = {
							20 = {
								modifier = {
									factor = 0
									any_controlled_ship = {
										has_ship_flag = ag_jump_drive_cooldown
									}
								}
								event_target:ag_kae_ge_assault_fleet_action_target = {
									random_fleet_in_system = {
										limit = {
											exists = owner
											owner = {
												is_hostile = event_target:ag_kae_ge_invasion_country
											}
											any_controlled_ship = {
												is_disabled = no
												is_ship_class = shipclass_military
											}
										}
										prevprev = { ag_kae_ge_jumpdrive_to_target = yes }
									}
								}
							}
							80 = {
								fleet_event = { id = ag_kae_ge_invasion.241 days = 10 random = 10 }
							}
						}
					}
					else = {
						fleet_event = { id = ag_kae_ge_invasion.241 days = 10 random = 10 }
					}
				}
			}
			25 = {
				random_system = {
					limit = {
						NOT = { is_same_value = root.solar_system }
						distance = {
							source = root.solar_system
							type = hyperlane
							use_bypasses = yes
							min_jumps = 1
							max_jumps = 15
						}
						any_ship_in_system = {
							is_disabled = no
							is_ship_class = shipclass_military
							exists = owner
							owner = {
								is_hostile = event_target:ag_kae_ge_invasion_country
							}
						}
						prev = { can_access_system = prev }
					}
					save_event_target_as = ag_kae_ge_assault_fleet_action_target
				}
				if = {
					limit = {
						exists = event_target:ag_kae_ge_assault_fleet_action_target
					}
					event_target:ag_kae_ge_assault_fleet_action_target = {
						random_fleet_in_system = {
							limit = {
								exists = owner
								owner = {
									is_hostile = event_target:ag_kae_ge_invasion_country
								}
								any_controlled_ship = {
									is_disabled = no
									is_ship_class = shipclass_military
								}
							}
							random_list = {
								99 = {
									prevprev = {
										auto_follow_fleet = {
											target = prev
											attack_fleet = yes
										}
									}
								}
								1 = {
									modifier = {
										factor = 0
										prevprev = {
											any_controlled_ship = {
												has_ship_flag = ag_jump_drive_cooldown
											}
										}
									}
									prevprev = { ag_kae_ge_jumpdrive_to_target = yes }
								}
							}
						}
					}
				}
				else = {
					random_system = {
						limit = {
							NOT = { is_same_value = root.solar_system }
							distance = {
								source = root.solar_system
								type = hyperlane
								use_bypasses = yes
								min_jumps = 1
								max_jumps = 15
							}
							any_ship_in_system = {
								is_disabled = no
								is_ship_class = shipclass_military
								exists = owner
								owner = {
									is_hostile = event_target:ag_kae_ge_invasion_country
								}
							}
						}
						save_event_target_as = ag_kae_ge_assault_fleet_action_target
					}
					if = {
						limit = {
							exists = event_target:ag_kae_ge_assault_fleet_action_target
						}
						random_list = {
							20 = {
								modifier = {
									factor = 0
									any_controlled_ship = {
										has_ship_flag = ag_jump_drive_cooldown
									}
								}
								event_target:ag_kae_ge_assault_fleet_action_target = {
									random_fleet_in_system = {
										limit = {
											exists = owner
											owner = {
												is_hostile = event_target:ag_kae_ge_invasion_country
											}
											any_controlled_ship = {
												is_disabled = no
												is_ship_class = shipclass_military
											}
										}
										prevprev = { ag_kae_ge_jumpdrive_to_target = yes }
									}
								}
							}
							80 = {
								fleet_event = { id = ag_kae_ge_invasion.241 days = 10 random = 10 }
							}
						}
					}
					else = {
						fleet_event = { id = ag_kae_ge_invasion.241 days = 10 random = 10 }
					}
				}
			}
		}
	}
}
